import{r as i,j as t}from"./react-C0aVURRx.js";import{a as Q,u as k,O as R}from"./index-BkTh5yT-.js";import{I as m,j as B,k as L,ag as O,g as p,n as h,i as T,ah as A,b as P,ai as q,a6 as M,a7 as U,B as F}from"./mui-BclYXUQz.js";import{u as w,a as _}from"./useCustomSnackbar-DfTFYAgI.js";import{u as N}from"./useReloadCart-DPnHWgVT.js";import{u as E}from"./i18n-react-BrGbUNw2.js";import{Z}from"./vendor-nhlcQtNt.js";import"./dayjs-DMyafwSS.js";import"./i18n-Bhc83OLH.js";import"./zustand-CIROGDhp.js";import"./axios-xsH4HHeE.js";import"./emotion-TDrrYjOY.js";import"./cookie-consent-CY00VeIR.js";function D(r,e){const c=i.useRef([]),{notify:s}=w(),{t:l}=E("cart");i.useEffect(()=>{if(!e){c.current=r;return}c.current.forEach(u=>{const n=r.find(d=>d.id===u.id);n?n.quantity<u.quantity&&s(l("cart.quantity_reduced",{name:n.name,count:n.quantity}),"warning"):s(l("cart.removed_unavailable",{name:u.name}),"warning")}),c.current=r},[r,e,s,l])}function ea(){const{t:r}=E(["common","cart"]),{notify:e}=w(),c=Q(a=>a.lang),{loading:s,hasError:l,reload:x,isReloading:u}=N(),n=k(a=>a.items);D(n,u);const d=k.getState().addItem,[y,f]=i.useState(null),j=!!y,v=j?"cart-popover":void 0,S=n.reduce((a,o)=>a+o.quantity,0),z=n.reduce((a,o)=>a+o.quantity*o.price,0),I=i.useCallback(a=>{f(a.currentTarget),x()},[x]),g=i.useCallback(()=>f(null),[]),b=i.useCallback(async(a,o)=>{const C=Math.max(0,a.quantity+o);if(C>a.availableQuantity){e(r("cart:cart.not_enough_stock",{count:a.availableQuantity}),"warning");return}try{await d(a.id,C,a.availableQuantity),o>0?e(r("cart:cart.add_success"),"success"):e(r("cart:cart.remove_success"),"success")}catch{e(r("cart:errors.error_update"),"error")}},[d,e,r]);return t.jsxs(t.Fragment,{children:[t.jsx(m,{"aria-describedby":v,onClick:I,color:"inherit","aria-label":r("common:navbar.cart"),children:t.jsx(B,{badgeContent:S,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(L,{})})}),t.jsx(O,{id:v,open:j,anchorEl:y,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{width:300,p:1}},children:s?t.jsx(p,{sx:{p:2,textAlign:"center"},children:t.jsx(R,{})}):l?t.jsx(h,{sx:{p:2},variant:"body2",children:r("cart:cart.unavailable")}):n.length===0?t.jsx(h,{sx:{p:2},variant:"body2",children:r("cart:cart.empty")}):t.jsxs(p,{children:[t.jsx(T,{dense:!0,"aria-live":"polite",children:n.map(a=>t.jsx(A,{secondaryAction:t.jsxs(p,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(q,{title:r("cart:cart.remove_one"),children:t.jsx("span",{children:t.jsx(m,{size:"small",onClick:()=>b(a,-1),disabled:a.quantity<=0||s,children:t.jsx(M,{fontSize:"small"})})})}),t.jsx(h,{sx:{mx:.5},children:a.quantity}),t.jsx(q,{title:a.quantity>=a.availableQuantity?r("cart:cart.max_reached",{count:a.availableQuantity}):r("cart:cart.add_one"),children:t.jsx("span",{children:t.jsx(m,{size:"small",onClick:()=>b(a,1),disabled:s||a.quantity>=a.availableQuantity,children:t.jsx(U,{fontSize:"small"})})})})]}),children:t.jsx(P,{primary:a.name,secondary:_(a.price,c,"EUR")})},a.id))}),t.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",p:1},children:[t.jsxs(h,{variant:"subtitle1",children:[r("cart:cart.total")," : ",_(z,c,"EUR")]}),t.jsx(F,{component:Z,to:"/cart",variant:"contained",size:"small",onClick:g,disabled:s,children:r("cart:cart.view")})]})]})})]})}export{ea as default};
