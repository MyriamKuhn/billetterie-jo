import{r as j,j as t}from"./react-C0aVURRx.js";import{q as n,I as w,a7 as $,a1 as F,a8 as H,a9 as P,v as c,W as m,aa as A,ab as y,B as R,ac as O,a6 as G,u as X,n as J,ad as K,ae as Y,af as Z,ag as tt}from"./mui-CUyLNCSY.js";import{a as rt,u as v,b as et,S as q,O as at,P as S}from"./index-CY5QxFiC.js";import{u as nt}from"./useReloadCart-DWkKaM0A.js";import{u as st}from"./useCustomSnackbar-Cbu9vsWE.js";import{E}from"./ErrorDisplay-CqpRduDy.js";import{f as z,a as f}from"./format-_gz818Hm.js";import{u as k}from"./i18n-react-DKLIrUu3.js";import{a1 as T,O as it}from"./vendor-DdBxgcTm.js";import"./dayjs-DMyafwSS.js";import"./emotion-3DDxC2qG.js";import"./axios-Dq7h7Pqt.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./helmet-D-y5f56R.js";import"./cookie-consent-h1U6JL3J.js";function B({item:r,adjustQty:a,debounceMs:p=500,disabled:o=!1}){const[u,s]=j.useState(r.quantity.toString()),i=j.useRef(null);j.useEffect(()=>{s(r.quantity.toString())},[r.quantity]),j.useEffect(()=>{o&&s(r.quantity.toString())},[o,r.quantity]),j.useEffect(()=>{if(o||u==="")return;const b=Number(u);if(!isNaN(b)&&b!==r.quantity)return i.current=window.setTimeout(()=>{let l=b;l<0&&(l=0),l>r.availableQuantity&&(l=r.availableQuantity),a(r,l),s(l.toString()),i.current=null},p),()=>{i.current&&(clearTimeout(i.current),i.current=null)}},[u,r,a,p,o]);const x=b=>{if(o){s(r.quantity.toString());return}const l=b.target.value;(l===""||/^[0-9]+$/.test(l))&&s(l)},h=()=>{a(r,Math.min(r.quantity+1,r.availableQuantity))},d=()=>{a(r,Math.max(r.quantity-1,0))};return t.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[t.jsx(w,{size:"small",onClick:d,disabled:o||r.quantity<=0,"aria-label":"decrement quantity",children:t.jsx($,{fontSize:"small"})}),t.jsx(F,{type:"text",size:"small",value:u,onChange:x,onBlur:()=>{!o&&u===""&&s(r.quantity.toString()),o&&s(r.quantity.toString())},slotProps:{input:{inputProps:{inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"center",width:40}}}},disabled:o}),t.jsx(w,{size:"small",onClick:h,"aria-label":"increment quantity",disabled:o||r.quantity>=r.availableQuantity,children:t.jsx(H,{fontSize:"small"})})]})}function I({item:r,lang:a,adjustQty:p,isMobile:o,disabled:u=!1}){const{t:s}=k("cart"),i=Math.round((r.discountRate??0)*100);return o?t.jsx(P,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:t.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[t.jsxs(n,{children:[t.jsx(c,{variant:"subtitle1",sx:{wordBreak:"break-word"},gutterBottom:!0,children:r.name}),t.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[t.jsx(m,{label:z(r.date,a,{day:"2-digit",month:"2-digit",year:"numeric"}),size:"small"}),r.time&&t.jsx(m,{label:r.time,size:"small"}),t.jsx(m,{label:r.location,size:"small"})]}),t.jsx(m,{label:s("cart.remaining",{count:r.availableQuantity}),size:"small",color:r.availableQuantity>0?"success":"error"})]}),t.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:[t.jsx(n,{sx:{textAlign:"center"},children:(r.discountRate??0)>0?t.jsxs(n,{children:[t.jsx(c,{variant:"body2",component:"span",sx:{textDecoration:"line-through",color:"text.secondary",mr:.5},children:f(r.originalPrice??0,a,"EUR")}),t.jsx(c,{variant:"body1",component:"span",sx:{fontWeight:"bold"},children:f(r.price,a,"EUR")}),t.jsx(m,{label:`-${i}%`,size:"small",color:"secondary",sx:{ml:1}})]}):t.jsx(c,{children:f(r.price,a,"EUR")})}),t.jsx(B,{item:r,adjustQty:p}),t.jsx(n,{sx:{textAlign:"right"},children:t.jsx(c,{variant:"body1",children:s("table.total_price",{total:f(r.quantity*r.price,a,"EUR")})})})]})]})},r.id):t.jsxs(A,{sx:{"&:last-child td":{borderBottom:"none"}},children:[t.jsx(y,{sx:{minWidth:200},children:t.jsx(n,{sx:{display:"flex",alignItems:"flex-start"},children:t.jsxs(n,{sx:{flexGrow:1},children:[t.jsx(c,{variant:"subtitle1",component:"div",sx:{wordBreak:"break-word"},children:r.name}),t.jsxs(n,{sx:{mt:.5,display:"flex",flexWrap:"wrap",gap:.5},children:[t.jsx(m,{label:z(r.date,a,{day:"2-digit",month:"2-digit",year:"numeric"}),size:"small"}),r.time&&t.jsx(m,{label:r.time,size:"small"}),t.jsx(m,{label:r.location,size:"small"})]}),t.jsx(n,{sx:{mt:.5},children:t.jsx(m,{label:s("cart.remaining",{count:r.availableQuantity}),size:"small",color:r.availableQuantity>0?"success":"error"})})]})})}),t.jsx(y,{align:"right",sx:{minWidth:120},children:(r.discountRate??0)>0?t.jsxs(n,{sx:{textAlign:"right"},children:[t.jsx(c,{variant:"body2",component:"span",sx:{textDecoration:"line-through",color:"text.secondary",mr:.5},children:f(r.originalPrice??0,a,"EUR")}),t.jsx(c,{variant:"body1",component:"span",sx:{fontWeight:"bold"},children:f(r.price,a,"EUR")}),t.jsx(m,{label:`-${i}%`,size:"small",color:"secondary",sx:{ml:1}})]}):t.jsx(c,{children:f(r.price,a,"EUR")})}),t.jsx(y,{align:"center",sx:{minWidth:160},children:t.jsx(B,{item:r,adjustQty:p,disabled:u})}),t.jsx(y,{align:"right",sx:{minWidth:120},children:t.jsx(c,{variant:"body1",children:f(r.quantity*r.price,a,"EUR")})})]},r.id)}function ot({total:r,acceptedCGV:a,onCgvChange:p,onPay:o,lang:u,isMobile:s,disabled:i=!1}){const{t:x}=k("cart");return t.jsxs(n,{sx:{mb:3},children:[t.jsx(n,{sx:{textAlign:"right",mb:2},children:t.jsx(c,{variant:"h6",children:x("table.total_price",{total:f(r,u,"EUR")})})}),t.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:0,mb:3},children:[t.jsx(R,{variant:"contained",color:"primary",disabled:!a||i,onClick:o,children:x("checkout.checkout")}),t.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:0,mt:0},children:[t.jsx(O,{checked:a,onChange:h=>p(h.target.checked),disabled:i,size:"small"}),t.jsxs(c,{variant:s?"caption":"body2",children:[x("checkout.accept_cgv_prefix")," ",t.jsx(G,{sx:{m:0},component:T,to:"/terms",target:"_blank",rel:"noopener noreferrer",children:x(s?"checkout.accept_cgv_link_text_mobile":"checkout.accept_cgv_link_text")})]})]}),i&&t.jsx(n,{sx:{mt:1},children:t.jsx(c,{variant:"caption",color:"warning.main",children:x("cart.payment_in_progress")})})]}),t.jsx(n,{sx:{textAlign:"right",mt:s?6:10},children:t.jsx(R,{component:T,to:"/tickets",variant:"outlined",size:"small",children:x("checkout.continue_shopping")})})]})}function Ct(){const{t:r}=k(["cart","common"]),a=rt(e=>e.lang),p=it(),{loading:o,hasError:u,reload:s}=nt(),i=v(e=>e.items),x=v.getState().addItem,h=v(e=>e.isLocked),{notify:d}=st(),b=et(e=>e.authToken),[l,W]=j.useState(!1),D=j.useMemo(()=>i.reduce((e,g)=>e+g.quantity*g.price,0),[i]);j.useEffect(()=>{s()},[s,a]);const U=X(),_=J(U.breakpoints.down("sm")),C=j.useCallback(async(e,g)=>{if(h){d(r("cart:errors.cart_locked"),"warning");return}if(g<0&&(g=0),g>e.availableQuantity){d(r("cart:cart.not_enough_stock",{count:e.availableQuantity}),"warning");return}try{await x(e.id,g,e.availableQuantity),g>e.quantity?d(r("cart:cart.add_success"),"success"):g<e.quantity?d(r("cart:cart.remove_success"),"success"):d(r("cart:cart.update_success"),"info")}catch(V){V.message==="CartLocked"?d(r("cart:errors.cart_locked"),"warning"):d(r("cart:errors.error_update"),"error")}},[x,d,r,h]),L=()=>{if(h){d(r("cart:errors.cart_locked"),"warning");return}if(!l){d(r("cart:cart.cgv_not_accepted"),"warning");return}if(!b){p("/login?next=/cart");return}p("/checkout")};if(o)return t.jsxs(t.Fragment,{children:[t.jsx(q,{title:r("cart:seo.title"),description:r("cart:seo.description")}),t.jsx(n,{sx:{textAlign:"center",py:4},children:t.jsx(at,{})})]});if(u)return t.jsx(S,{children:t.jsx(E,{title:r("cart:errors.error_loading"),message:r("cart:errors.error_loading_message"),showRetry:!0,retryButtonText:r("common:errors.retry"),onRetry:s,showHome:!0,homeButtonText:r("common:errors.home")})});if(i.length===0)return t.jsx(S,{children:t.jsx(E,{title:r("cart:cart.empty"),message:r("cart:errors.empty_message"),showRetry:!1,showHome:!0,homeButtonText:r("common:errors.home")})});const M=()=>h?t.jsx(n,{sx:{mb:2},children:t.jsx(c,{variant:"body2",color:"warning.main",children:r("cart:cart.payment_in_progress")})}):null,Q=()=>t.jsx(K,{component:P,sx:{mb:3,overflowX:"auto",border:"1px solid",borderColor:"divider",borderRadius:1},children:t.jsxs(Y,{children:[t.jsx(Z,{children:t.jsxs(A,{children:[t.jsx(y,{children:r("cart:table.product")}),t.jsx(y,{align:"right",children:r("cart:table.unit_price")}),t.jsx(y,{align:"center",children:r("cart:table.quantity")}),t.jsx(y,{align:"right",children:r("cart:cart.total")})]})}),t.jsx(tt,{children:i.map(e=>t.jsx(I,{item:e,lang:a,adjustQty:C,isMobile:!1,disabled:h},e.id))})]})}),N=()=>t.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:i.map(e=>t.jsx(I,{item:e,lang:a,adjustQty:C,isMobile:!0,disabled:h},e.id))});return t.jsxs(t.Fragment,{children:[t.jsx(q,{title:r("cart:seo.title"),description:r("cart:seo.description")}),t.jsxs(n,{sx:{p:{xs:2,md:4}},children:[t.jsx(c,{variant:"h4",gutterBottom:!0,children:r("cart:cart.title")}),M(),_?N():Q(),t.jsx(ot,{total:D,acceptedCGV:l,onCgvChange:e=>W(e),onPay:L,lang:a,isMobile:_,disabled:h})]})]})}export{Ct as default};
