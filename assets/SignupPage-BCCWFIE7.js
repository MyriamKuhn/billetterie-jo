import{r as t,j as r}from"./react-C0aVURRx.js";import{S as le}from"./Seo-DMFKsBC4.js";import{P as ue}from"./PageWrapper-Ct9UgNZL.js";import{l as ce}from"./jo_logo-toDFtw-C.js";import{a0 as me}from"./vendor-D9jJ6Kpb.js";import{a as de,R as pe,d as ge}from"./index-DXCM6E3X.js";import{A as O,g as o}from"./AlertMessage-CNaxI2wP.js";import{u as he,n as xe,q as u,t as v,B as H,ab as L,G as fe,J as _,V as Se,ah as je,C as be}from"./mui-7-KVGWFD.js";import{a as ve}from"./axios-xsH4HHeE.js";import{i as ye,a as K}from"./validation-491qobvS.js";import{P as Te}from"./PasswordWithConfirmation-DCGeVHHG.js";import{u as Ce}from"./i18n-react-BJpG_9Eh.js";import"./dayjs-DMyafwSS.js";import"./helmet-0WMJf2Lb.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./emotion-P9cj9Rdp.js";import"./cookie-consent-CRxe7e1g.js";function Ee({firstname:e,lastname:i,email:c,password:n,confirmPassword:m,firstnameTouched:y,lastnameTouched:d,emailTouched:T}){const p=y&&e.trim()==="",C=d&&i.trim()==="",g=T&&!K(c),E=t.useMemo(()=>ye(n),[n]),h=t.useMemo(()=>n===m,[n,m]);return{firstnameError:p,lastnameError:C,emailError:g,pwStrong:E,pwsMatch:h,isFirstnameValid:e.trim()!=="",isLastnameValid:i.trim()!=="",isEmailValid:K(c)}}function He(){const{t:e}=Ce("signup"),i=de(a=>a.lang),c=he(),n=xe(c.breakpoints.down("sm")),m=c.palette.mode==="dark",y=`${i}-${m?"dark":"light"}-${n?"compact":"normal"}`,[d,T]=t.useState(""),[p,C]=t.useState(""),[g,E]=t.useState(""),[h,G]=t.useState(""),[k,J]=t.useState(""),[l,N]=t.useState(!1),[Q,U]=t.useState(!1),[Y,X]=t.useState(!1),[Z,ee]=t.useState(!1),[re,te]=t.useState(!1),{firstnameError:A,lastnameError:P,emailError:R,pwStrong:q,pwsMatch:B,isFirstnameValid:se,isLastnameValid:ae,isEmailValid:oe}=Ee({firstname:d,lastname:p,email:g,password:h,confirmPassword:k,firstnameTouched:Q,lastnameTouched:Y,emailTouched:Z}),[x,j]=t.useState(null),w=t.useRef(null),[b,V]=t.useState(!1),[F,s]=t.useState(null),[W,$]=t.useState(null),ne=async a=>{var z,D,I;if(a.preventDefault(),s(null),$(null),!q){s(e("errors.passwordNotStrong"));return}if(!B){s(e("errors.passwordsDontMatch"));return}if(!l){s(e("errors.mustAgreeTOS"));return}if(!x){s(e("errors.captchaRequired"));return}V(!0);try{const{status:f}=await ge({firstname:d,lastname:p,email:g,password:h,password_confirmation:k,captcha_token:x,accept_terms:l},i);f===201&&($(e("signup.successMessage")),(z=w.current)==null||z.reset())}catch(f){if(V(!1),(D=w.current)==null||D.reset(),j(null),ve.isAxiosError(f)&&f.response){const{status:M,data:S}=f.response;if(M===429){s(o(e,"too_many_requests"));return}if(M===500){s(o(e,"internal_error"));return}if(M===422&&S.code==="validation_error"){const ie=((I=S.errors)==null?void 0:I.email)||[];s(o(e,S.code)),ie.includes("validation.unique")?s(o(e,"email_already_registered")):s(o(e,"validation_error"));return}S.code?s(o(e,S.code)):s(o(e,"generic_error"))}else s(o(e,"network_error"))}};return r.jsxs(r.Fragment,{children:[r.jsx(le,{title:e("seo.title"),description:e("seo.description")}),r.jsx(ue,{disableCard:!0,children:r.jsxs(u,{component:"form",onSubmit:ne,sx:{maxWidth:400,mx:"auto",mt:{xs:0,sm:1,md:1},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:a=>`1px solid ${a.palette.divider}`},children:[r.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:r.jsx(u,{component:"img",src:ce,alt:e("signup.logoAlt"),sx:{height:150,width:"auto"}})}),r.jsx(v,{variant:"h4",gutterBottom:!0,align:"center",children:e("signup.pageTitle")}),F&&r.jsx(O,{message:F,severity:"error"}),W&&r.jsxs(r.Fragment,{children:[r.jsx(O,{message:W,severity:"success"}),r.jsx(u,{sx:{textAlign:"center",my:2},children:r.jsx(H,{component:L,href:"/login",variant:"outlined",children:e("signup.goToLogin")})})]}),r.jsxs(fe,{spacing:2,children:[r.jsx(_,{required:!0,fullWidth:!0,id:"firstname",label:e("signup.firstnameLabel"),value:d,onChange:a=>T(a.target.value),onBlur:()=>U(!0),autoComplete:"given-name",error:A,helperText:A?e("errors.firstnameRequired"):""}),r.jsx(_,{required:!0,fullWidth:!0,id:"lastname",label:e("signup.lastnameLabel"),value:p,onChange:a=>C(a.target.value),onBlur:()=>X(!0),autoComplete:"family-name",error:P,helperText:P?e("errors.lastnameRequired"):""}),r.jsx(_,{required:!0,fullWidth:!0,id:"email",label:e("signup.emailLabel"),type:"email",value:g,onChange:a=>E(a.target.value),onBlur:()=>ee(!0),autoComplete:"email",error:R,helperText:R?e("errors.invalidEmail"):""}),r.jsx(Te,{password:h,onPasswordChange:G,confirmPassword:k,onConfirmChange:J,touched:re,onBlur:()=>te(!0)}),r.jsx(Se,{control:r.jsx(je,{checked:l,onChange:a=>N(a.target.checked)}),label:r.jsxs(v,{variant:"body2",sx:{fontSize:"0.875rem"},children:[e("signup.agreeTOS")," ",r.jsx(L,{href:"/privacy-policy",target:"_blank",underline:"hover",children:e("signup.termsLink")})]})}),r.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:1},children:r.jsx(me,{ref:w,sitekey:pe,size:n?"compact":"normal",theme:m?"dark":"light",hl:i,onChange:j,onExpired:()=>j(null),onErrored:()=>j(null)},y)}),r.jsx(H,{type:"submit",variant:"contained",fullWidth:!0,disabled:b||!x||!l||!B||!q||!se||!ae||!oe,sx:{mt:2},startIcon:b?r.jsx(be,{color:"inherit",size:16}):void 0,children:b?`${e("signup.signupButtonLoad")}â€¦`:e("signup.signupButton")}),!b&&(!x||!l)&&r.jsxs(v,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1,textAlign:"center"},children:[!x&&e("signup.hintCaptchaRequired"),!l&&e("signup.hintMustAgreeTOS")]}),r.jsx(u,{sx:{mt:1,textAlign:"center"},children:r.jsxs(v,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e("signup.alreadyHaveAccount")," ",r.jsx(L,{href:"/login",underline:"hover",variant:"body2",children:e("signup.loginLink")})]})})]})]})})]})}export{He as default};
