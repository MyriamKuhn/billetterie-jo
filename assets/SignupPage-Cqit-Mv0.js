import{r as t,j as r}from"./react-C0aVURRx.js";import{a as le,S as ue,P as ce,R as me,d as de}from"./index-CY5QxFiC.js";import{l as pe}from"./jo_logo-toDFtw-C.js";import{a2 as ge}from"./vendor-DdBxgcTm.js";import{A as I,g as n}from"./AlertMessage-BDwJJZE0.js";import{u as he,n as xe,q as u,v as b,B as H,a6 as L,O as fe,a1 as _,ak as Se,ac as je,r as ve}from"./mui-CUyLNCSY.js";import{a as be}from"./axios-Dq7h7Pqt.js";import{i as ye,a as K}from"./validation-491qobvS.js";import{P as Te}from"./PasswordWithConfirmation-fPFCWCsA.js";import{u as Ce}from"./i18n-react-DKLIrUu3.js";import"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-3DDxC2qG.js";import"./helmet-D-y5f56R.js";import"./cookie-consent-h1U6JL3J.js";function Ee({firstname:e,lastname:i,email:c,password:o,confirmPassword:m,firstnameTouched:y,lastnameTouched:d,emailTouched:T}){const p=y&&e.trim()==="",C=d&&i.trim()==="",g=T&&!K(c),E=t.useMemo(()=>ye(o),[o]),h=t.useMemo(()=>o===m,[o,m]);return{firstnameError:p,lastnameError:C,emailError:g,pwStrong:E,pwsMatch:h,isFirstnameValid:e.trim()!=="",isLastnameValid:i.trim()!=="",isEmailValid:K(c)}}function De(){const{t:e}=Ce("signup"),i=le(a=>a.lang),c=he(),o=xe(c.breakpoints.down("sm")),m=c.palette.mode==="dark",y=`${i}-${m?"dark":"light"}-${o?"compact":"normal"}`,[d,T]=t.useState(""),[p,C]=t.useState(""),[g,E]=t.useState(""),[h,N]=t.useState(""),[k,Q]=t.useState(""),[l,U]=t.useState(!1),[Y,G]=t.useState(!1),[J,X]=t.useState(!1),[Z,ee]=t.useState(!1),[re,te]=t.useState(!1),{firstnameError:A,lastnameError:P,emailError:R,pwStrong:q,pwsMatch:B,isFirstnameValid:se,isLastnameValid:ae,isEmailValid:ne}=Ee({firstname:d,lastname:p,email:g,password:h,confirmPassword:k,firstnameTouched:Y,lastnameTouched:J,emailTouched:Z}),[x,j]=t.useState(null),w=t.useRef(null),[v,F]=t.useState(!1),[V,s]=t.useState(null),[W,$]=t.useState(null),oe=async a=>{var z,O,D;if(a.preventDefault(),s(null),$(null),!q){s(e("errors.passwordNotStrong"));return}if(!B){s(e("errors.passwordsDontMatch"));return}if(!l){s(e("errors.mustAgreeTOS"));return}if(!x){s(e("errors.captchaRequired"));return}F(!0);try{const{status:f}=await de({firstname:d,lastname:p,email:g,password:h,password_confirmation:k,captcha_token:x,accept_terms:l},i);f===201&&($(e("signup.successMessage")),(z=w.current)==null||z.reset())}catch(f){if(F(!1),(O=w.current)==null||O.reset(),j(null),be.isAxiosError(f)&&f.response){const{status:M,data:S}=f.response;if(M===429){s(n(e,"too_many_requests"));return}if(M===500){s(n(e,"internal_error"));return}if(M===422&&S.code==="validation_error"){const ie=((D=S.errors)==null?void 0:D.email)||[];s(n(e,S.code)),ie.includes("validation.unique")?s(n(e,"email_already_registered")):s(n(e,"validation_error"));return}S.code?s(n(e,S.code)):s(n(e,"generic_error"))}else s(n(e,"network_error"))}};return r.jsxs(r.Fragment,{children:[r.jsx(ue,{title:e("seo.title"),description:e("seo.description")}),r.jsx(ce,{disableCard:!0,children:r.jsxs(u,{component:"form",onSubmit:oe,sx:{maxWidth:400,mx:"auto",mt:{xs:0,sm:1,md:1},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:a=>`1px solid ${a.palette.divider}`},children:[r.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:r.jsx(u,{component:"img",src:pe,alt:e("signup.logoAlt"),sx:{height:150,width:"auto"}})}),r.jsx(b,{variant:"h4",gutterBottom:!0,align:"center",children:e("signup.pageTitle")}),V&&r.jsx(I,{message:V,severity:"error"}),W&&r.jsxs(r.Fragment,{children:[r.jsx(I,{message:W,severity:"success"}),r.jsx(u,{sx:{textAlign:"center",my:2},children:r.jsx(H,{component:L,href:"/login",variant:"outlined",children:e("signup.goToLogin")})})]}),r.jsxs(fe,{spacing:2,children:[r.jsx(_,{required:!0,fullWidth:!0,id:"firstname",label:e("signup.firstnameLabel"),value:d,onChange:a=>T(a.target.value),onBlur:()=>G(!0),autoComplete:"given-name",error:A,helperText:A?e("errors.firstnameRequired"):""}),r.jsx(_,{required:!0,fullWidth:!0,id:"lastname",label:e("signup.lastnameLabel"),value:p,onChange:a=>C(a.target.value),onBlur:()=>X(!0),autoComplete:"family-name",error:P,helperText:P?e("errors.lastnameRequired"):""}),r.jsx(_,{required:!0,fullWidth:!0,id:"email",label:e("signup.emailLabel"),type:"email",value:g,onChange:a=>E(a.target.value),onBlur:()=>ee(!0),autoComplete:"email",error:R,helperText:R?e("errors.invalidEmail"):""}),r.jsx(Te,{password:h,onPasswordChange:N,confirmPassword:k,onConfirmChange:Q,touched:re,onBlur:()=>te(!0)}),r.jsx(Se,{control:r.jsx(je,{checked:l,onChange:a=>U(a.target.checked)}),label:r.jsxs(b,{variant:"body2",sx:{fontSize:"0.875rem"},children:[e("signup.agreeTOS")," ",r.jsx(L,{href:"/privacy-policy",target:"_blank",underline:"hover",children:e("signup.termsLink")})]})}),r.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:1},children:r.jsx(ge,{ref:w,sitekey:me,size:o?"compact":"normal",theme:m?"dark":"light",hl:i,onChange:j,onExpired:()=>j(null),onErrored:()=>j(null)},y)}),r.jsx(H,{type:"submit",variant:"contained",fullWidth:!0,disabled:v||!x||!l||!B||!q||!se||!ae||!ne,sx:{mt:2},startIcon:v?r.jsx(ve,{color:"inherit",size:16}):void 0,children:v?`${e("signup.signupButtonLoad")}â€¦`:e("signup.signupButton")}),!v&&(!x||!l)&&r.jsxs(b,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1,textAlign:"center"},children:[!x&&e("signup.hintCaptchaRequired"),!l&&e("signup.hintMustAgreeTOS")]}),r.jsx(u,{sx:{mt:1,textAlign:"center"},children:r.jsxs(b,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e("signup.alreadyHaveAccount")," ",r.jsx(L,{href:"/login",underline:"hover",variant:"body2",children:e("signup.loginLink")})]})})]})]})})]})}export{De as default};
