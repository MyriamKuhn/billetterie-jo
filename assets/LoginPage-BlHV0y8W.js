import{j as t,r as n}from"./react-C0aVURRx.js";import{S as ee}from"./Seo-D7Cjjq6F.js";import{P as te}from"./PageWrapper-CLrKOvtn.js";import{b as I,u as v,l as re,a as M,o as se,r as oe,c as ne}from"./index-DffXxGKG.js";import{a as R}from"./axios-xsH4HHeE.js";import{t as g,q as c,G as C,J as A,am as ie,I as ae,an as le,ao as de,V as ce,ah as ue,B as q,ab as h,i as ge}from"./mui-B8Hl5INf.js";import{u as me}from"./i18n-react-BRaxkKkI.js";import{O as fe}from"./vendor-DjmZx-rl.js";import"./dayjs-DMyafwSS.js";import"./helmet-DExn6ifA.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./emotion-B2P3BLFp.js";import"./cookie-consent-CEVRZwh7.js";const xe="/assets/jo_logo-OOELB3jV.png";function z(e,l){switch(l){case"invalid_credentials":return e("errors.invalidCredentials");case"account_disabled":return e("errors.accountDisabled");case"twofa_invalid":return e("errors.twofaInvalid");case"user_not_found":return e("errors.userNotFound");case"already_verified":return e("errors.alreadyVerified");case"too_many_requests":return e("errors.tooManyRequests");default:return e("errors.genericError")}}function W({message:e,severity:l}){return t.jsx(g,{color:l==="error"?"error":"success.main",variant:"body2",sx:{mb:2,textAlign:"center"},role:l==="error"?"alert":void 0,children:e})}function Te(){const{t:e}=me("login"),l=fe(),[m,N]=n.useState(""),[k,D]=n.useState(""),[p,O]=n.useState(!1),[b,j]=n.useState(!1),[L,$]=n.useState(""),[f,x]=n.useState(!1),[E,i]=n.useState(null),[G,w]=n.useState(!1),[F,T]=n.useState(!1),[H,_]=n.useState(!1),[y,J]=n.useState(!1),U=()=>J(r=>!r),K=I(r=>r.setToken),Q=I(r=>r.clearToken),B=v(r=>r.setGuestCartId),X=v(r=>r.guestCartId),P=v(r=>r.loadCart),V=async(r,u)=>{var d,o;r.preventDefault(),i(null),u||j(!1),w(!1),_(!1),x(!0);try{const a=await re(m,k,p,u?L:"",M.getState().lang,X);if(a.token&&a.user){await se(a.token,a.user.role,p,K,B,P,l);return}}catch(a){if(R.isAxiosError(a)){const S=(d=a.response)==null?void 0:d.status,s=(o=a.response)==null?void 0:o.data;if(S===400&&(s==null?void 0:s.code)==="twofa_required"){j(!0),x(!1);return}if(S===400&&(s==null?void 0:s.code)==="email_not_verified"){i(e("errors.emailNotVerifiedSent")),w(!0),x(!1);return}S===404||s!=null&&s.code?i(z(e,s==null?void 0:s.code)):i(e("errors.genericError"))}else i(e("errors.networkError"))}finally{x(!1)}},Y=async r=>{var u;r.preventDefault(),T(!0),i(null);try{const{status:d,data:o}=await oe(m,M.getState().lang);if(d===200&&o.message){_(!0),w(!1);return}}catch(d){if(R.isAxiosError(d)){const o=(u=d.response)==null?void 0:u.data;o!=null&&o.code?i(z(e,o==null?void 0:o.code)):i(e("errors.genericError"))}else i(e("errors.networkError"))}finally{T(!1)}},Z=async()=>{j(!1),await ne(Q,B,P,l,"/login")};return t.jsxs(t.Fragment,{children:[t.jsx(ee,{title:e("seo.title"),description:e("seo.description")}),t.jsx(te,{disableCard:!0,children:t.jsxs(c,{component:"form",onSubmit:b?r=>V(r,!0):r=>V(r,!1),sx:{maxWidth:400,mx:"auto",mt:{xs:2,sm:4,md:8},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:r=>`1px solid ${r.palette.divider}`},children:[t.jsx(c,{sx:{display:"flex",justifyContent:"center",mb:2},children:t.jsx(c,{component:"img",src:xe,alt:e("login.logoAlt"),sx:{height:150,width:"auto"}})}),t.jsx(g,{variant:"h4",gutterBottom:!0,align:"center",children:e("login.pageTitle")}),E&&t.jsx(W,{message:E,severity:"error"}),H&&t.jsx(W,{message:e("login.verificationEmailResent"),severity:"success"}),!b&&t.jsxs(C,{spacing:2,children:[t.jsx(A,{required:!0,fullWidth:!0,id:"email",label:e("login.emailLabel"),type:"email",value:m,onChange:r=>N(r.target.value),autoComplete:"email"}),t.jsx(A,{required:!0,fullWidth:!0,id:"password",label:e("login.passwordLabel"),type:y?"text":"password",value:k,onChange:r=>D(r.target.value),autoComplete:"current-password",slotProps:{input:{endAdornment:t.jsx(ie,{position:"end",children:t.jsx(ae,{"aria-label":e(y?"login.hidePassword":"login.showPassword"),onClick:U,edge:"end",children:y?t.jsx(le,{}):t.jsx(de,{})})})}}}),t.jsx(c,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(ce,{control:t.jsx(ue,{checked:p,onChange:r=>O(r.target.checked),color:"primary"}),label:e("login.rememberMe"),sx:{".MuiFormControlLabel-label":{fontSize:"0.875rem"}}})}),t.jsx(q,{type:"submit",variant:"contained",fullWidth:!0,disabled:f,children:f?`${e("login.loginButton")}…`:e("login.loginButton")}),t.jsx(c,{sx:{mt:1,textAlign:"center"},children:t.jsxs(C,{direction:"row",spacing:1,justifyContent:"center",children:[t.jsx(h,{href:"/forgot-password",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:e("login.forgotPassword")}),t.jsx(g,{variant:"body2",sx:{fontSize:"0.8rem",mx:.5},children:"|"}),t.jsx(h,{href:"/signup",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:e("login.noAccount")})]})}),G&&t.jsx(c,{sx:{mt:2,textAlign:"center"},children:t.jsxs(g,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e("login.emailNotVerifiedHint")," ",t.jsx(h,{component:"button",variant:"body2",onClick:Y,disabled:F||!/.+@.+\..+/.test(m),sx:{fontSize:"0.8rem"},children:F?`${e("login.resendLinkText")}…`:e("login.resendLinkText")})]})})]}),b&&t.jsxs(c,{children:[t.jsx(g,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:e("login.twoFATitle")}),t.jsx(A,{required:!0,fullWidth:!0,id:"twoFACode",label:e("login.twoFACodeLabel"),type:"text",value:L,onChange:r=>$(r.target.value),autoComplete:"one-time-code"}),t.jsx(q,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:3},disabled:f,children:f?`${e("login.verify2FAButton")}…`:e("login.verify2FAButton")}),t.jsx(ge,{sx:{my:3}}),t.jsx(C,{direction:"row",justifyContent:"end",children:t.jsx(h,{component:"button",variant:"body2",onClick:Z,sx:{fontSize:"0.8rem"},children:e("login.cancelLogin")})})]})]})})]})}export{Te as default};
