import{j as t,r as h}from"./react-C0aVURRx.js";import{A as w,u as C,O as L,a as O,P as I,S as Y}from"./index-BWBY9c3A.js";import{O as H,Q,U,V as G,W as N,X as J,u as X,q as m,t as x,N as K,Y as Z,B as v,I as F,p as V,r as tt,_ as et,x as st,$ as at,a0 as ot,a1 as T,a2 as S,a3 as E,a4 as rt,a5 as it,a6 as nt}from"./mui-CaMhj-nn.js";import{d as ct}from"./dayjs-DMyafwSS.js";import{F as lt}from"./FilterSelect-BJweXNQg.js";import{S as dt}from"./SortControl-C5Ar46m_.js";import{u as b}from"./i18n-react-2P1mIwau.js";import{a as M}from"./axios-xsH4HHeE.js";import{u as ut}from"./useProductDetails-CL3b9Tf6.js";import{E as W}from"./ErrorDisplay-DSDP25z1.js";import{f as A,a as R}from"./format-BP4WpB1S.js";import{u as xt}from"./useCustomSnackbar-KNVcHHHt.js";import"./zustand-DgaMZn_z.js";import"./vendor-CknGL9X_.js";import"./i18n-Bhc83OLH.js";import"./emotion-VhTkku_q.js";import"./helmet-BJ5MjdLa.js";import"./cookie-consent-BKvNUUg0.js";function P({label:e,value:r,onChange:s,type:l}){return t.jsx(H,{label:e,type:l,size:"small",fullWidth:!0,value:r,onChange:i=>s(i.target.value),slotProps:{inputLabel:{shrink:!0}}})}function mt({legend:e,value:r,options:s,onChange:l}){return t.jsxs(Q,{component:"fieldset",children:[t.jsx(U,{component:"legend",children:e}),t.jsx(G,{row:!0,value:r,onChange:(i,n)=>l(n),children:s.map(i=>t.jsx(N,{value:i.value,control:t.jsx(J,{size:"small"}),label:i.label},i.value))})]})}function pt({filters:e,onChange:r}){const{t:s}=b("ticket"),l=X(),[i,n]=h.useState(!1),d=[{value:"name",label:s("filters.name")},{value:"price",label:s("filters.price")},{value:"date",label:s("filters.date")}],o=t.jsxs(m,{sx:{width:260,py:2,px:1},children:[t.jsx(x,{variant:"h6",gutterBottom:!0,children:s("filters.title")}),t.jsxs(K,{spacing:2,sx:{mx:1},children:[t.jsx(P,{label:s("filters.name"),value:e.name,onChange:c=>r({name:c,page:1})}),t.jsx(P,{label:s("filters.category"),value:e.category,onChange:c=>r({category:c,page:1})}),t.jsx(P,{label:s("filters.location"),value:e.location,onChange:c=>r({location:c,page:1})}),t.jsx(Z,{label:s("filters.date"),value:e.date?ct(e.date):null,onChange:c=>r({date:(c==null?void 0:c.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(mt,{legend:s("filters.places"),value:e.places.toString(),options:[{value:"0",label:s("filters.all_places")},{value:"1",label:s("filters.one_place")},{value:"2",label:s("filters.two_places")},{value:"4",label:s("filters.four_places")}],onChange:c=>r({places:Number(c),page:1})}),t.jsx(dt,{fields:d,sortBy:e.sortBy,order:e.order,onSortChange:(c,g)=>r({sortBy:c,order:g,page:1}),label:s("filters.sort_by")}),t.jsx(lt,{label:s("filters.offers_per_page"),value:e.perPage,options:[1,5,10,15,25,50,100],onChange:c=>r({perPage:c,page:1})}),t.jsx(v,{variant:"outlined",fullWidth:!0,onClick:()=>r({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),children:s("filters.reset")})]})]});return t.jsxs(t.Fragment,{children:[t.jsx(m,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:l.mixins.toolbar.minHeight,bgcolor:"background.paper",border:c=>`1px solid ${c.palette.divider}`,borderRadius:1,width:260},children:o}),t.jsxs(m,{sx:{display:{xs:"block",md:"none"},mb:2},children:[t.jsx(F,{onClick:()=>n(!0),"aria-label":s("filters.title"),children:t.jsx(V,{})}),t.jsx(tt,{open:i,onClose:()=>n(!1),keepMounted:!0,children:t.jsxs(m,{sx:{position:"relative"},children:[t.jsx(F,{onClick:()=>n(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":s("filters.close"),children:t.jsx(et,{})}),o]})})]})]})}const $="/assets/placeholder-CcHesTJP.png";function ht({product:e,fmtCur:r,fmtDate:s,onViewDetails:l,onBuy:i}){const{t:n}=b(["common","ticket"]),d=e.stock_quantity===0,o=e.price*(1-e.sale);return t.jsx(m,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:t.jsxs(st,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[t.jsx(at,{component:"img",image:e.product_details.image?`${w}/products/images/${e.product_details.image}`:$,alt:e.name,loading:"lazy",sx:{width:{xs:"100%",md:320},height:180,objectFit:"cover",alignSelf:{xs:"auto",md:"center"}}}),t.jsxs(ot,{sx:{flexGrow:1},children:[t.jsx(x,{variant:"h6",children:e.name}),t.jsxs(x,{variant:"body2",children:[s(e.product_details.date),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.product_details.location}),t.jsx(x,{variant:"body2",color:"text.secondary",children:n("ticket:tickets.places",{count:e.product_details.places})}),t.jsxs(m,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[e.sale>0&&t.jsx(x,{variant:"body2",sx:{textDecoration:"line-through"},children:r(e.price)}),t.jsx(x,{variant:"subtitle1",fontWeight:"bold",children:r(o)}),e.sale>0&&t.jsx(T,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]}),t.jsx(x,{variant:"body2",color:d?"error.main":"text.secondary",sx:{mt:1},children:d?n("ticket:tickets.out_of_stock"):n("ticket:tickets.available",{count:e.stock_quantity})})]}),t.jsxs(m,{sx:{display:"flex",flexDirection:{xs:"row",md:"column"},justifyContent:"center",alignItems:"center",gap:1,"& .MuiButton-root":{whiteSpace:"nowrap"}},children:[t.jsx(v,{size:"small",variant:"outlined",onClick:()=>l(e.id),children:n("ticket:tickets.more_info")}),t.jsx(v,{size:"small",variant:"contained",disabled:d,onClick:i,children:n(d?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})})}function gt({products:e,fmtCur:r,fmtDate:s,onViewDetails:l,onBuy:i}){const{t:n}=b("ticket");return e.length===0?t.jsx(x,{variant:"h4",sx:{textAlign:"center"},children:n("tickets.not_found")}):t.jsx(m,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:e.map(d=>t.jsx(ht,{product:d,fmtCur:r,fmtDate:s,onViewDetails:l,onBuy:()=>i(d)},d.id))})}function ft(e,r){const[s,l]=h.useState([]),[i,n]=h.useState(0),[d,o]=h.useState(!1),[c,g]=h.useState(null),[p,f]=h.useState(null);return h.useEffect(()=>{o(!0),g(null),f(null);const y={name:"name",price:"price",date:"product_details->date"}[e.sortBy],_={per_page:Math.max(1,e.perPage),page:e.page,sort_by:y,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};M.get(`${w}/api/products`,{params:_,headers:{"Accept-Language":r}}).then(a=>{l(a.data.data),n(a.data.pagination.total)}).catch(a=>{var u;if(M.isAxiosError(a)){const j=(u=a.response)==null?void 0:u.status;if(j===422){f(a.response.data.errors);return}if(j===404){l([]),n(0);return}}g(a.code)}).finally(()=>o(!1))},[e,r]),{products:s,total:i,loading:d,error:c,validationErrors:p}}function z(){const e=C.getState().addItem,{notify:r}=xt(),{t:s}=b("cart");return async(l,i,n)=>{try{return C.getState().isLocked?(r(s("errors.cart_locked"),"warning"),!1):(await e(l,i,n),r(s("cart.add_success"),"success"),!0)}catch(d){return d.message.includes("exceeds")?r(s("cart.not_enough_stock",{count:n}),"warning"):r(s("errors.error_update"),"error"),!1}}}function yt({open:e,productId:r,lang:s,onClose:l}){const{t:i}=b(["ticket","cart"]),n=C(u=>u.items),d=z(),{product:o,loading:c,error:g}=ut(e?r:null,s),p="product-title";if(c)return t.jsx(S,{open:e,onClose:l,children:t.jsx(E,{sx:{textAlign:"center",py:4},children:t.jsx(L,{})})});if(g||!o)return t.jsx(S,{open:e,onClose:l,children:t.jsx(W,{title:i("ticket:errors.title"),message:i("ticket:errors.not_found"),showRetry:!1,showHome:!1})});const f=u=>R(u,s,"EUR"),k=A(o.product_details.date,s),y=o.stock_quantity===0,_=o.price*(1-o.sale),a=async()=>{const u=n.find(B=>B.id===o.id.toString()),j=((u==null?void 0:u.quantity)??0)+1;await d(o.id.toString(),j,o.stock_quantity)&&l()};return t.jsxs(S,{open:e,onClose:l,maxWidth:"sm",fullWidth:!0,"aria-labelledby":p,children:[t.jsx(rt,{id:p,children:o.name}),t.jsx(E,{dividers:!0,children:o&&t.jsxs(m,{component:"div",children:[t.jsx(m,{component:"img",src:o.product_details.image?`${w}/products/images/${o.product_details.image}`:$,alt:o.name,loading:"lazy",sx:{width:"100%",height:200,objectFit:"cover",mb:2}}),t.jsxs(x,{variant:"body1",children:[k,o.product_details.time&&` – ${o.product_details.time}`]}),t.jsx(x,{variant:"body1",color:"text.secondary",sx:{mb:1},children:o.product_details.location}),t.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:1},children:i("tickets.category",{category:o.product_details.category})}),t.jsx(x,{variant:"body2",sx:{mb:1},children:o.product_details.description}),t.jsx(x,{variant:"body1",color:"text.secondary",children:i("ticket:tickets.places",{count:o.product_details.places})}),t.jsxs(m,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[o.sale>0&&t.jsx(x,{variant:"body2",sx:{textDecoration:"line-through"},children:f(o.price)}),t.jsx(x,{variant:"subtitle1",fontWeight:"bold",children:f(_)}),o.sale>0&&t.jsx(T,{label:`–${Math.round(o.sale*100)}%`,size:"small"})]}),t.jsx(x,{variant:"body2",color:y?"error.main":"text.secondary",sx:{mt:1},children:y?i("ticket:tickets.out_of_stock"):i("ticket:tickets.available",{count:o.stock_quantity})})]})}),t.jsxs(it,{children:[t.jsx(v,{onClick:l,children:i("ticket:tickets.close")}),t.jsx(v,{variant:"contained",onClick:a,disabled:y,children:i(y?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})}function At(){const{t:e}=b("ticket"),r=O(a=>a.lang),s=C(a=>a.items),l=z(),[i,n]=h.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:d,total:o,loading:c,error:g,validationErrors:p}=ft(i,r),[f,k]=h.useState(null);h.useEffect(()=>{if(p){const a={};p.sort_by&&(a.sortBy="name",a.order="asc"),p.date&&(a.date=""),p.name&&(a.name=""),p.category&&(a.category=""),p.location&&(a.location=""),p.places&&(a.places=0),n(u=>({...u,...a}))}},[p]);const y=a=>R(a,r,"EUR"),_=a=>A(a,r);return g?t.jsx(I,{children:t.jsx(W,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>n(a=>({...a})),showHome:!0,homeButtonText:e("errors.home")})}):t.jsxs(t.Fragment,{children:[t.jsx(Y,{title:e("tickets.seo_title"),description:e("tickets.seo_description")}),t.jsxs(I,{disableCard:!0,children:[t.jsx(x,{variant:"h4",sx:{px:2},children:e("tickets.title")}),t.jsxs(m,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(pt,{filters:i,onChange:a=>n(u=>({...u,...a}))}),t.jsxs(m,{component:"main",flex:1,children:[c?t.jsx(m,{textAlign:"center",py:8,children:t.jsx(L,{})}):t.jsx(gt,{products:d,fmtCur:y,fmtDate:_,onViewDetails:k,onBuy:async a=>{const u=s.find(q=>q.id===a.id.toString()),D=((u==null?void 0:u.quantity)??0)+1;await l(a.id.toString(),D,a.stock_quantity)&&k(null)}}),!c&&d.length>0&&t.jsx(m,{textAlign:"center",mt:4,children:t.jsx(nt,{count:Math.ceil(o/i.perPage)||1,page:i.page,onChange:(a,u)=>n(j=>({...j,page:u}))})})]})]})]}),t.jsx(yt,{open:f!==null,productId:f,lang:r,onClose:()=>k(null)})]})}export{At as default};
