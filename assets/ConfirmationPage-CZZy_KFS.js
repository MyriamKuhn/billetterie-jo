import{r as m,j as t}from"./react-C0aVURRx.js";import{b as w,a as P,u as U,S as _,O as E,P as S}from"./index-CD9-jRb9.js";import{g as L,l as b}from"./paymentService-DAnMWV2x.js";import{E as B}from"./ErrorDisplay-CATvfXnP.js";import{u as R}from"./i18n-react-CHYEX_9Z.js";import{q as d,t as f,B as p}from"./mui-BBaOU7V-.js";import{S as T,O as D}from"./vendor-1UMx7qFY.js";import"./dayjs-DMyafwSS.js";import"./axios-xsH4HHeE.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-BKoPsIBf.js";import"./helmet-DqAb31yQ.js";import"./cookie-consent-DYVQHhqE.js";function V(){const{t:e}=R("checkout"),o=T(),n=D(),u=w(r=>r.authToken),h=P(r=>r.lang),x=U(r=>r.unlockCart),[k,i]=m.useState(!0),[g,a]=m.useState(null),[s,v]=m.useState(null);m.useEffect(()=>{x();const r=o.state;let c=r==null?void 0:r.paymentUuid;const y=new URLSearchParams(o.search);if(!c&&y.get("paymentUuid")&&(c=y.get("paymentUuid")),!c){a(e("errors.no_uuid")),i(!1);return}if(!u){a(e("errors.not_authenticated")),i(!1),n(`/login?next=${encodeURIComponent(o.pathname+o.search)}`);return}(async()=>{i(!0),a(null);try{const{status:j,data:l}=await L(c,u);j===200&&l?v(l):(b("Unexpected status getPaymentStatus:",l),a(e("errors.fetch_error")))}catch{a(e("errors.fetch_error"))}finally{i(!1)}})()},[o,u,h,n,e,x]);const C=s!=null&&s.paid_at?new Date(s.paid_at).toLocaleString(h,{year:"numeric",month:"long",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return k?t.jsxs(t.Fragment,{children:[t.jsx(_,{title:e("seo.confirmation_title"),description:e("seo.confirmation_description")}),t.jsx(d,{sx:{textAlign:"center",py:4},children:t.jsx(E,{})})]}):g?t.jsx(S,{children:t.jsx(B,{title:e("errors.error_confirmation"),message:g,showRetry:!1,showHome:!0,homeButtonText:e("confirmation.go_home")})}):t.jsxs(t.Fragment,{children:[t.jsx(_,{title:e("seo.confirmation_title"),description:e("seo.confirmation_description")}),t.jsx(S,{children:t.jsxs(d,{sx:{maxWidth:600,mx:"auto",mt:4,p:2},children:[t.jsx(f,{variant:"h4",gutterBottom:!0,children:e("confirmation.thank_you")}),t.jsx(f,{variant:"body1",sx:{mb:2},children:e("confirmation.see_mail")}),t.jsx(f,{variant:"body2",sx:{mb:2},children:e("confirmation.paid_at",{date:C})}),t.jsxs(d,{sx:{mt:3},children:[t.jsx(p,{variant:"outlined",onClick:()=>n("/"),children:e("confirmation.continue_shopping")}),t.jsx(p,{variant:"text",sx:{ml:2},onClick:()=>n("/user/orders"),children:e("confirmation.view_orders")}),t.jsx(p,{variant:"text",sx:{ml:2},onClick:()=>n("/user/tickets"),children:e("confirmation.view_tickets")})]})]})})]})}export{V as default};
