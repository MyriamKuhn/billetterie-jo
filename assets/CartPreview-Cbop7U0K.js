import{r as x,j as r}from"./react-C0aVURRx.js";import{a as B,b as O,u as m,O as A}from"./index-CY5QxFiC.js";import{I as y,aH as T,aI as P,aJ as M,q as h,v as p,e as U,aK as F,h as H,al as w,a7 as J,a8 as K,B as N}from"./mui-CUyLNCSY.js";import{a as S}from"./format-_gz818Hm.js";import{u as D}from"./useReloadCart-DWkKaM0A.js";import{u as E}from"./useCustomSnackbar-Cbu9vsWE.js";import{u as I}from"./i18n-react-DKLIrUu3.js";import{a1 as G}from"./vendor-DdBxgcTm.js";import"./dayjs-DMyafwSS.js";import"./axios-Dq7h7Pqt.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-3DDxC2qG.js";import"./helmet-D-y5f56R.js";import"./cookie-consent-h1U6JL3J.js";function V(t,e){const i=x.useRef([]),{notify:l}=E(),{t:n}=I("cart");x.useEffect(()=>{if(!e){i.current=t;return}i.current.forEach(d=>{const u=t.find(o=>o.id===d.id);u?u.quantity<d.quantity&&l(n("cart.quantity_reduced",{name:u.name,count:u.quantity}),"warning"):l(n("cart.removed_unavailable",{name:d.name}),"warning")}),i.current=t},[t,e,l,n])}function da(){const{t}=I(["common","cart"]),{notify:e}=E(),i=B(a=>a.lang),l=O(a=>a.role),{loading:n,hasError:f,reload:d,isReloading:u}=D(),o=m(a=>a.items);V(o,u);const v=m.getState().addItem,s=m(a=>a.isLocked),[j,g]=x.useState(null),b=!!j,C=b?"cart-popover":void 0,L=o.reduce((a,c)=>a+c.quantity,0),z=o.reduce((a,c)=>a+c.quantity*c.price,0),Q=x.useCallback(a=>{g(a.currentTarget),d()},[d]),_=x.useCallback(()=>g(null),[]),k=x.useCallback(async(a,c)=>{if(s){e(t("cart:errors.cart_locked"),"warning");return}const q=Math.max(0,a.quantity+c);if(q>a.availableQuantity){e(t("cart:cart.not_enough_stock",{count:a.availableQuantity}),"warning");return}try{await v(a.id,q,a.availableQuantity),c>0?e(t("cart:cart.add_success"),"success"):e(t("cart:cart.remove_success"),"success")}catch(R){R.message==="CartLocked"?e(t("cart:errors.cart_locked"),"warning"):e(t("cart:errors.error_update"),"error")}},[v,e,t,s]);return r.jsxs(r.Fragment,{children:[r.jsx(y,{"aria-describedby":C,onClick:Q,color:"inherit","aria-label":t("common:navbar.cart"),children:r.jsx(T,{badgeContent:L,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:r.jsx(P,{})})}),r.jsxs(M,{id:C,open:b,anchorEl:j,onClose:_,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{width:300,p:1}},children:[s&&r.jsx(h,{sx:{p:1},children:r.jsx(p,{variant:"body2",color:"warning.main",children:t("cart:cart.payment_in_progress")})}),n?r.jsx(h,{sx:{p:2,textAlign:"center"},children:r.jsx(A,{})}):f?r.jsx(p,{sx:{p:2},variant:"body2",children:t("cart:cart.unavailable")}):l==="admin"||l==="employee"?r.jsx(p,{sx:{p:2},variant:"body2",children:t("cart:cart.no_items_for_admin")}):o.length===0?r.jsx(p,{sx:{p:2},variant:"body2",children:t("cart:cart.empty")}):r.jsxs(h,{children:[r.jsx(U,{dense:!0,"aria-live":"polite",children:o.map(a=>r.jsx(F,{secondaryAction:r.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(w,{title:t(s?"cart:errors.cart_locked":"cart:cart.remove_one"),children:r.jsx("span",{children:r.jsx(y,{size:"small",onClick:()=>k(a,-1),disabled:n||a.quantity<=0,sx:s?{opacity:.5}:void 0,children:r.jsx(J,{fontSize:"small"})})})}),r.jsx(p,{sx:{mx:.5},children:a.quantity}),r.jsx(w,{title:s?t("cart:errors.cart_locked"):a.quantity>=a.availableQuantity?t("cart:cart.max_reached",{count:a.availableQuantity}):t("cart:cart.add_one"),children:r.jsx("span",{children:r.jsx(y,{size:"small",onClick:()=>k(a,1),disabled:n||a.quantity>=a.availableQuantity,sx:s?{opacity:.5}:void 0,children:r.jsx(K,{fontSize:"small"})})})})]}),children:r.jsx(H,{primary:a.name,secondary:S(a.price,i,"EUR")})},a.id))}),r.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",p:1},children:[r.jsxs(p,{variant:"subtitle1",children:[t("cart:cart.total")," : ",S(z,i,"EUR")]}),r.jsx(N,{component:G,to:"/cart",variant:"contained",size:"small",onClick:_,disabled:n,children:t("cart:cart.view")})]})]})]})]})}export{da as default};
