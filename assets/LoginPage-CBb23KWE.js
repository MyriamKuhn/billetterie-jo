import{j as t,r as a}from"./react-C0aVURRx.js";import{S as te}from"./Seo-D7Cjjq6F.js";import{P as re}from"./PageWrapper-CLrKOvtn.js";import{A as G,b as z,u as E,a as W,o as se,l as oe}from"./index-DtI_Kdfn.js";import{a as S}from"./axios-xsH4HHeE.js";import{t as p,q as u,G as T,J as _,am as ne,I as ae,an as ie,ao as le,V as ce,ah as de,B as N,ab as w,i as ue}from"./mui-B8Hl5INf.js";import{u as ge}from"./i18n-react-BRaxkKkI.js";import{O as me}from"./vendor-DjmZx-rl.js";import"./dayjs-DMyafwSS.js";import"./helmet-DExn6ifA.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./emotion-B2P3BLFp.js";import"./cookie-consent-CEVRZwh7.js";const fe="/assets/jo_logo-OOELB3jV.png";async function pe(e,o,l,g,x,h){const m={"Content-Type":"application/json","Accept-Language":x};h&&(m["X-Guest-Cart-Id"]=h);const v={email:e,password:o,remember:l,twofa_code:g};return(await S.post(`${G}/api/auth/login`,v,{headers:m})).data}async function xe(e,o){const l={"Content-Type":"application/json","Accept-Language":o},g=await S.post(`${G}/api/auth/email/resend`,{email:e},{headers:l});return{status:g.status,data:g.data}}function $(e,o){switch(o){case"invalid_credentials":return e("errors.invalidCredentials");case"account_disabled":return e("errors.accountDisabled");case"twofa_invalid":return e("errors.twofaInvalid");case"user_not_found":return e("errors.userNotFound");case"already_verified":return e("errors.alreadyVerified");case"too_many_requests":return e("errors.tooManyRequests");default:return e("errors.genericError")}}function D({message:e,severity:o}){return t.jsx(p,{color:o==="error"?"error":"success.main",variant:"body2",sx:{mb:2,textAlign:"center"},role:o==="error"?"alert":void 0,children:e})}function Fe(){const{t:e}=ge("login"),o=me(),[l,g]=a.useState(""),[x,h]=a.useState(""),[m,v]=a.useState(!1),[j,C]=a.useState(!1),[F,O]=a.useState(""),[b,y]=a.useState(!1),[B,i]=a.useState(null),[U,A]=a.useState(!1),[P,I]=a.useState(!1),[H,V]=a.useState(!1),[k,J]=a.useState(!1),X=()=>J(r=>!r),K=z(r=>r.setToken),Q=z(r=>r.clearToken),M=E(r=>r.setGuestCartId),Y=E(r=>r.guestCartId),R=E(r=>r.loadCart),q=async(r,f)=>{var d,n;r.preventDefault(),i(null),f||C(!1),A(!1),V(!1),y(!0);try{const c=await pe(l,x,m,f?F:"",W.getState().lang,Y);if(c.token&&c.user){await se(c.token,c.user.role,m,K,M,R,o);return}}catch(c){if(S.isAxiosError(c)){const L=(d=c.response)==null?void 0:d.status,s=(n=c.response)==null?void 0:n.data;if(L===400&&(s==null?void 0:s.code)==="twofa_required"){C(!0),y(!1);return}if(L===400&&(s==null?void 0:s.code)==="email_not_verified"){i(e("errors.emailNotVerifiedSent")),A(!0),y(!1);return}L===404||s!=null&&s.code?i($(e,s==null?void 0:s.code)):i(e("errors.genericError"))}else i(e("errors.networkError"))}finally{y(!1)}},Z=async r=>{var f;r.preventDefault(),I(!0),i(null);try{const{status:d,data:n}=await xe(l,W.getState().lang);if(d===200&&n.message){V(!0),A(!1);return}}catch(d){if(S.isAxiosError(d)){const n=(f=d.response)==null?void 0:f.data;n!=null&&n.code?i($(e,n==null?void 0:n.code)):i(e("errors.genericError"))}else i(e("errors.networkError"))}finally{I(!1)}},ee=async()=>{C(!1),await oe(Q,M,R,o,"/login")};return t.jsxs(t.Fragment,{children:[t.jsx(te,{title:e("seo.title"),description:e("seo.description")}),t.jsx(re,{disableCard:!0,children:t.jsxs(u,{component:"form",onSubmit:j?r=>q(r,!0):r=>q(r,!1),sx:{maxWidth:400,mx:"auto",mt:{xs:2,sm:4,md:8},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:r=>`1px solid ${r.palette.divider}`},children:[t.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:t.jsx(u,{component:"img",src:fe,alt:e("login.logoAlt"),sx:{height:150,width:"auto"}})}),t.jsx(p,{variant:"h4",gutterBottom:!0,align:"center",children:e("login.pageTitle")}),B&&t.jsx(D,{message:B,severity:"error"}),H&&t.jsx(D,{message:e("login.verificationEmailResent"),severity:"success"}),!j&&t.jsxs(T,{spacing:2,children:[t.jsx(_,{required:!0,fullWidth:!0,id:"email",label:e("login.emailLabel"),type:"email",value:l,onChange:r=>g(r.target.value),autoComplete:"email"}),t.jsx(_,{required:!0,fullWidth:!0,id:"password",label:e("login.passwordLabel"),type:k?"text":"password",value:x,onChange:r=>h(r.target.value),autoComplete:"current-password",slotProps:{input:{endAdornment:t.jsx(ne,{position:"end",children:t.jsx(ae,{"aria-label":e(k?"login.hidePassword":"login.showPassword"),onClick:X,edge:"end",children:k?t.jsx(ie,{}):t.jsx(le,{})})})}}}),t.jsx(u,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(ce,{control:t.jsx(de,{checked:m,onChange:r=>v(r.target.checked),color:"primary"}),label:e("login.rememberMe"),sx:{".MuiFormControlLabel-label":{fontSize:"0.875rem"}}})}),t.jsx(N,{type:"submit",variant:"contained",fullWidth:!0,disabled:b,children:b?`${e("login.loginButton")}…`:e("login.loginButton")}),t.jsx(u,{sx:{mt:1,textAlign:"center"},children:t.jsxs(T,{direction:"row",spacing:1,justifyContent:"center",children:[t.jsx(w,{href:"/forgot-password",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:e("login.forgotPassword")}),t.jsx(p,{variant:"body2",sx:{fontSize:"0.8rem",mx:.5},children:"|"}),t.jsx(w,{href:"/signup",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:e("login.noAccount")})]})}),U&&t.jsx(u,{sx:{mt:2,textAlign:"center"},children:t.jsxs(p,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e("login.emailNotVerifiedHint")," ",t.jsx(w,{component:"button",variant:"body2",onClick:Z,disabled:P||!/.+@.+\..+/.test(l),sx:{fontSize:"0.8rem"},children:P?`${e("login.resendLinkText")}…`:e("login.resendLinkText")})]})})]}),j&&t.jsxs(u,{children:[t.jsx(p,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:e("login.twoFATitle")}),t.jsx(_,{required:!0,fullWidth:!0,id:"twoFACode",label:e("login.twoFACodeLabel"),type:"text",value:F,onChange:r=>O(r.target.value),autoComplete:"one-time-code"}),t.jsx(N,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:3},disabled:b,children:b?`${e("login.verify2FAButton")}…`:e("login.verify2FAButton")}),t.jsx(ue,{sx:{my:3}}),t.jsx(T,{direction:"row",justifyContent:"end",children:t.jsx(w,{component:"button",variant:"body2",onClick:ee,sx:{fontSize:"0.8rem"},children:e("login.cancelLogin")})})]})]})})]})}export{Fe as default};
