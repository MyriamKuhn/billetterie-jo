import{r as j,j as e}from"./react-C0aVURRx.js";import{q as s,I as C,ac as M,J as Q,ad as L,ae as S,t as l,a5 as u,af as B,ag as g,B as _,ah as N,ab as V,u as $,n as H,ai as O,aj as F,ak as G,al as J}from"./mui-Dl6HORPF.js";import{a as X,u as R,b as K,O as Y,S as Z}from"./index-JrA3fJ57.js";import{u as ee}from"./useReloadCart-P54pFwdc.js";import{u as te}from"./useCustomSnackbar-CwD0a6HH.js";import{E as w}from"./ErrorDisplay-0QdYUOL9.js";import{f as z,a as m}from"./format-BP4WpB1S.js";import{u as y}from"./i18n-react-ZsqOCTOc.js";import{a0 as E,O as re}from"./vendor-B9PkVD2_.js";import"./dayjs-DMyafwSS.js";import"./emotion-QUM7EFga.js";import"./axios-xsH4HHeE.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./helmet-DwkNRAhC.js";import"./cookie-consent-BI82O-I0.js";function T({item:t,adjustQty:r,debounceMs:d=500}){const[x,c]=j.useState(t.quantity.toString()),n=j.useRef(null);j.useEffect(()=>{c(t.quantity.toString())},[t.quantity]),j.useEffect(()=>{if(x==="")return;const f=Number(x);if(!isNaN(f)&&f!==t.quantity)return n.current=window.setTimeout(()=>{let o=f;o<0&&(o=0),o>t.availableQuantity&&(o=t.availableQuantity),r(t,o),c(o.toString()),n.current=null},d),()=>{n.current&&(clearTimeout(n.current),n.current=null)}},[x,t,r,d]);const i=f=>{const o=f.target.value;(o===""||/^[0-9]+$/.test(o))&&c(o)},b=()=>{r(t,Math.min(t.quantity+1,t.availableQuantity))},h=()=>{r(t,Math.max(t.quantity-1,0))};return e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(C,{size:"small",onClick:h,disabled:t.quantity<=0,children:e.jsx(M,{fontSize:"small"})}),e.jsx(Q,{type:"text",size:"small",value:x,onChange:i,slotProps:{input:{inputProps:{inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"center",width:40}}}}}),e.jsx(C,{size:"small",onClick:b,disabled:t.quantity>=t.availableQuantity,children:e.jsx(L,{fontSize:"small"})})]})}function q({item:t,lang:r,adjustQty:d,isMobile:x}){const{t:c}=y("cart"),n=Math.round((t.discountRate??0)*100);return x?e.jsx(S,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(s,{children:[e.jsx(l,{variant:"subtitle1",sx:{wordBreak:"break-word"},gutterBottom:!0,children:t.name}),e.jsxs(s,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[e.jsx(u,{label:z(t.date,r,{day:"2-digit",month:"2-digit",year:"numeric"}),size:"small"}),t.time&&e.jsx(u,{label:t.time,size:"small"}),e.jsx(u,{label:t.location,size:"small"})]}),e.jsx(u,{label:c("cart.remaining",{count:t.availableQuantity}),size:"small",color:t.availableQuantity>0?"success":"error"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(s,{sx:{textAlign:"center"},children:(t.discountRate??0)>0?e.jsxs(s,{children:[e.jsx(l,{variant:"body2",component:"span",sx:{textDecoration:"line-through",color:"text.secondary",mr:.5},children:m(t.originalPrice??0,r,"EUR")}),e.jsx(l,{variant:"body1",component:"span",sx:{fontWeight:"bold"},children:m(t.price,r,"EUR")}),e.jsx(u,{label:`-${n}%`,size:"small",color:"secondary",sx:{ml:1}})]}):e.jsx(l,{children:m(t.price,r,"EUR")})}),e.jsx(T,{item:t,adjustQty:d}),e.jsx(s,{sx:{textAlign:"right"},children:e.jsx(l,{variant:"body1",children:c("table.total_price",{total:m(t.quantity*t.price,r,"EUR")})})})]})]})},t.id):e.jsxs(B,{sx:{"&:last-child td":{borderBottom:"none"}},children:[e.jsx(g,{sx:{minWidth:200},children:e.jsx(s,{sx:{display:"flex",alignItems:"flex-start"},children:e.jsxs(s,{sx:{flexGrow:1},children:[e.jsx(l,{variant:"subtitle1",component:"div",sx:{wordBreak:"break-word"},children:t.name}),e.jsxs(s,{sx:{mt:.5,display:"flex",flexWrap:"wrap",gap:.5},children:[e.jsx(u,{label:z(t.date,r,{day:"2-digit",month:"2-digit",year:"numeric"}),size:"small"}),t.time&&e.jsx(u,{label:t.time,size:"small"}),e.jsx(u,{label:t.location,size:"small"})]}),e.jsx(s,{sx:{mt:.5},children:e.jsx(u,{label:c("cart.remaining",{count:t.availableQuantity}),size:"small",color:t.availableQuantity>0?"success":"error"})})]})})}),e.jsx(g,{align:"right",sx:{minWidth:120},children:(t.discountRate??0)>0?e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsx(l,{variant:"body2",component:"span",sx:{textDecoration:"line-through",color:"text.secondary",mr:.5},children:m(t.originalPrice??0,r,"EUR")}),e.jsx(l,{variant:"body1",component:"span",sx:{fontWeight:"bold"},children:m(t.price,r,"EUR")}),e.jsx(u,{label:`-${n}%`,size:"small",color:"secondary",sx:{ml:1}})]}):e.jsx(l,{children:m(t.price,r,"EUR")})}),e.jsx(g,{align:"center",sx:{minWidth:160},children:e.jsx(T,{item:t,adjustQty:d})}),e.jsx(g,{align:"right",sx:{minWidth:120},children:e.jsx(l,{variant:"body1",children:m(t.quantity*t.price,r,"EUR")})})]},t.id)}function ae({total:t,acceptedCGV:r,onCgvChange:d,onPay:x,lang:c,isMobile:n}){const{t:i}=y("cart");return e.jsxs(s,{sx:{mb:3},children:[e.jsx(s,{sx:{textAlign:"right",mb:2},children:e.jsx(l,{variant:"h6",children:i("table.total_price",{total:m(t,c,"EUR")})})}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:0,mb:3},children:[e.jsx(_,{variant:"contained",color:"primary",disabled:!r,onClick:x,children:i("checkout.checkout")}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:0,mt:0},children:[e.jsx(N,{checked:r,onChange:b=>d(b.target.checked),size:"small"}),e.jsxs(l,{variant:n?"caption":"body2",children:[i("checkout.accept_cgv_prefix")," ",e.jsx(V,{sx:{m:0},component:E,to:"/terms",target:"_blank",rel:"noopener noreferrer",children:i(n?"checkout.accept_cgv_link_text_mobile":"checkout.accept_cgv_link_text")})]})]})]}),e.jsx(s,{sx:{textAlign:"right",mt:n?6:10},children:e.jsx(_,{component:E,to:"/tickets",variant:"outlined",size:"small",children:i("checkout.continue_shopping")})})]})}function ye(){const{t}=y(["cart","common"]),r=X(a=>a.lang),d=re(),{loading:x,hasError:c,reload:n}=ee(),i=R(a=>a.items),b=R.getState().addItem,{notify:h}=te(),f=K(a=>a.authToken),[o,I]=j.useState(!1),A=j.useMemo(()=>i.reduce((a,p)=>a+p.quantity*p.price,0),[i]);j.useEffect(()=>{n()},[n,r]);const D=$(),v=H(D.breakpoints.down("sm")),k=j.useCallback(async(a,p)=>{if(p<0&&(p=0),p>a.availableQuantity){h(t("cart:cart.not_enough_stock",{count:a.availableQuantity}),"warning");return}try{await b(a.id,p,a.availableQuantity),p>a.quantity?h(t("cart:cart.add_success"),"success"):p<a.quantity?h(t("cart:cart.remove_success"),"success"):h(t("cart:cart.update_success"),"info")}catch{h(t("cart:errors.error_update"),"error")}},[b,h,t]),P=()=>{if(!o){h(t("cart:cart.cgv_not_accepted"),"warning");return}if(!f){d("/login?next=/cart");return}d("/checkout")};if(x)return e.jsx(s,{sx:{textAlign:"center",py:4},children:e.jsx(Y,{})});if(c)return e.jsx(w,{title:t("cart:errors.error_loading"),message:t("cart:errors.error_loading_message"),showRetry:!0,retryButtonText:t("common:errors.retry"),onRetry:n,showHome:!0,homeButtonText:t("common:errors.home")});if(i.length===0)return e.jsx(w,{title:t("cart:cart.empty"),message:t("cart:errors.empty_message"),showRetry:!1,showHome:!0,homeButtonText:t("common:errors.home")});const U=()=>e.jsx(O,{component:S,sx:{mb:3,overflowX:"auto",border:"1px solid",borderColor:"divider",borderRadius:1},children:e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(B,{children:[e.jsx(g,{children:t("cart:table.product")}),e.jsx(g,{align:"right",children:t("cart:table.unit_price")}),e.jsx(g,{align:"center",children:t("cart:table.quantity")}),e.jsx(g,{align:"right",children:t("cart:cart.total")})]})}),e.jsx(J,{children:i.map(a=>e.jsx(q,{item:a,lang:r,adjustQty:k,isMobile:!1},a.id))})]})}),W=()=>e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:i.map(a=>e.jsx(q,{item:a,lang:r,adjustQty:k,isMobile:!0},a.id))});return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:t("cart:seo.title"),description:t("cart:seo.description")}),e.jsxs(s,{sx:{p:{xs:2,md:4}},children:[e.jsx(l,{variant:"h4",gutterBottom:!0,children:t("cart:cart.title")}),v?W():U(),e.jsx(ae,{total:A,acceptedCGV:o,onCgvChange:a=>I(a),onPay:P,lang:r,isMobile:v})]})]})}export{ye as default};
