import{j as t,r as g}from"./react-C0aVURRx.js";import{A as M,u as D,O as W,a as U}from"./index-Q-gZHGuk.js";import{S as Y}from"./Seo-CkXwJOyJ.js";import{J as Q,N as B,O as H,j as N,M as J,Q as T,U as X,V as K,W as Z,q as h,X as F,Y as C,_ as V,$ as tt,u as et,t as m,G as at,a0 as st,B as v,I as z,p as rt,r as ot,a1 as nt,a2 as it,a3 as lt,a4 as ct,a5 as L,a6 as w,a7 as A,a8 as dt,a9 as ut,aa as xt}from"./mui-BwUJxCPm.js";import{d as mt}from"./dayjs-DMyafwSS.js";import{u as b}from"./i18n-react-u0paBAQg.js";import{a as S}from"./axios-xsH4HHeE.js";import{P as pt}from"./PageWrapper-otroOoLH.js";import{E as R}from"./ErrorDisplay-poHB1oJI.js";import{u as ht,f as q,a as $}from"./useCustomSnackbar-Bw6Yz6b3.js";import"./vendor-JT0P6-Ac.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./emotion-Dvs1mEHu.js";import"./cookie-consent-B6r0YzHB.js";import"./helmet-8QjG9zRw.js";function P({label:e,value:r,onChange:a,type:c}){return t.jsx(Q,{label:e,type:c,size:"small",fullWidth:!0,value:r,onChange:s=>a(s.target.value),slotProps:{inputLabel:{shrink:!0}}})}function gt({label:e,value:r,options:a,onChange:c}){return t.jsxs(B,{size:"small",fullWidth:!0,children:[t.jsx(H,{children:e}),t.jsx(N,{label:e,value:r,onChange:s=>c(s.target.value),children:a.map(s=>t.jsx(J,{value:s,children:s},s))})]})}function ft({legend:e,value:r,options:a,onChange:c}){return t.jsxs(B,{component:"fieldset",children:[t.jsx(T,{component:"legend",children:e}),t.jsx(X,{row:!0,value:r,onChange:(s,i)=>c(i),children:a.map(s=>t.jsx(K,{value:s.value,control:t.jsx(Z,{size:"small"}),label:s.label},s.value))})]})}function jt({fields:e,sortBy:r,order:a,onSortChange:c,label:s}){const{t:i}=b(),d=(n,x)=>{x&&c(x,a)},o=(n,x)=>{x&&c(r,x)};return t.jsxs(B,{component:"fieldset",fullWidth:!0,children:[t.jsx(T,{component:"legend",sx:{mb:1},children:s}),t.jsxs(h,{sx:{display:"flex",gap:1},children:[t.jsx(F,{value:r,exclusive:!0,size:"small",onChange:d,"aria-label":i("sorting.title"),sx:{flex:1},children:e.map(({value:n,label:x})=>t.jsx(C,{value:n,"aria-label":String(n),children:x},n))}),t.jsxs(F,{value:a,exclusive:!0,size:"small",onChange:o,"aria-label":i("sorting.order"),children:[t.jsx(C,{value:"asc","aria-label":i("sorting.ascendant"),children:t.jsx(V,{fontSize:"small"})}),t.jsx(C,{value:"desc","aria-label":i("sorting.descendant"),children:t.jsx(tt,{fontSize:"small"})})]})]})]})}function yt({filters:e,onChange:r}){const{t:a}=b("ticket"),c=et(),[s,i]=g.useState(!1),d=[{value:"name",label:a("filters.name")},{value:"price",label:a("filters.price")},{value:"date",label:a("filters.date")}],o=t.jsxs(h,{sx:{width:260,py:2,px:1},children:[t.jsx(m,{variant:"h6",gutterBottom:!0,children:a("filters.title")}),t.jsxs(at,{spacing:2,sx:{mx:1},children:[t.jsx(P,{label:a("filters.name"),value:e.name,onChange:n=>r({name:n,page:1})}),t.jsx(P,{label:a("filters.category"),value:e.category,onChange:n=>r({category:n,page:1})}),t.jsx(P,{label:a("filters.location"),value:e.location,onChange:n=>r({location:n,page:1})}),t.jsx(st,{label:a("filters.date"),value:e.date?mt(e.date):null,onChange:n=>r({date:(n==null?void 0:n.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(ft,{legend:a("filters.places"),value:e.places.toString(),options:[{value:"0",label:a("filters.all_places")},{value:"1",label:a("filters.one_place")},{value:"2",label:a("filters.two_places")},{value:"4",label:a("filters.four_places")}],onChange:n=>r({places:Number(n),page:1})}),t.jsx(jt,{fields:d,sortBy:e.sortBy,order:e.order,onSortChange:(n,x)=>r({sortBy:n,order:x,page:1}),label:a("filters.sort_by")}),t.jsx(gt,{label:a("filters.offers_per_page"),value:e.perPage,options:[1,5,10,15,25,50,100],onChange:n=>r({perPage:n,page:1})}),t.jsx(v,{variant:"outlined",fullWidth:!0,onClick:()=>r({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),children:a("filters.reset")})]})]});return t.jsxs(t.Fragment,{children:[t.jsx(h,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:c.mixins.toolbar.minHeight,bgcolor:"background.paper",border:n=>`1px solid ${n.palette.divider}`,borderRadius:1,width:260},children:o}),t.jsxs(h,{sx:{display:{xs:"block",md:"none"},mb:2},children:[t.jsx(z,{onClick:()=>i(!0),"aria-label":a("filters.title"),children:t.jsx(rt,{})}),t.jsx(ot,{open:s,onClose:()=>i(!1),keepMounted:!0,children:t.jsxs(h,{sx:{position:"relative"},children:[t.jsx(z,{onClick:()=>i(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":a("filters.close"),children:t.jsx(nt,{})}),o]})})]})]})}function bt({product:e,fmtCur:r,fmtDate:a,onViewDetails:c,onBuy:s}){const{t:i}=b(["common","ticket"]),d=e.stock_quantity===0,o=e.price*(1-e.sale);return t.jsx(h,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:t.jsxs(it,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[t.jsx(lt,{component:"img",image:e.product_details.image,alt:e.name,loading:"lazy",sx:{width:{xs:"100%",md:320},height:180,objectFit:"cover",alignSelf:{xs:"auto",md:"center"}}}),t.jsxs(ct,{sx:{flexGrow:1},children:[t.jsx(m,{variant:"h6",children:e.name}),t.jsxs(m,{variant:"body2",children:[a(e.product_details.date),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.product_details.location}),t.jsx(m,{variant:"body2",color:"text.secondary",children:i("ticket:tickets.places",{count:e.product_details.places})}),t.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[e.sale>0&&t.jsx(m,{variant:"body2",sx:{textDecoration:"line-through"},children:r(e.price)}),t.jsx(m,{variant:"subtitle1",fontWeight:"bold",children:r(o)}),e.sale>0&&t.jsx(L,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]}),t.jsx(m,{variant:"body2",color:d?"error.main":"text.secondary",sx:{mt:1},children:d?i("ticket:tickets.out_of_stock"):i("ticket:tickets.available",{count:e.stock_quantity})})]}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"row",md:"column"},justifyContent:"center",alignItems:"center",gap:1,"& .MuiButton-root":{whiteSpace:"nowrap"}},children:[t.jsx(v,{size:"small",variant:"outlined",onClick:()=>c(e.id),children:i("ticket:tickets.more_info")}),t.jsx(v,{size:"small",variant:"contained",disabled:d,onClick:s,children:i(d?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})})}function kt({products:e,fmtCur:r,fmtDate:a,onViewDetails:c,onBuy:s}){const{t:i}=b("ticket");return e.length===0?t.jsx(m,{variant:"h4",sx:{textAlign:"center"},children:i("tickets.not_found")}):t.jsx(h,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:e.map(d=>t.jsx(bt,{product:d,fmtCur:r,fmtDate:a,onViewDetails:c,onBuy:()=>s(d)},d.id))})}function _t(e,r){const[a,c]=g.useState([]),[s,i]=g.useState(0),[d,o]=g.useState(!1),[n,x]=g.useState(null),[p,f]=g.useState(null);return g.useEffect(()=>{o(!0),x(null),f(null);const j={name:"name",price:"price",date:"product_details->date"}[e.sortBy],_={per_page:Math.max(1,e.perPage),page:e.page,sort_by:j,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};S.get(`${M}/api/products`,{params:_,headers:{"Accept-Language":r}}).then(l=>{c(l.data.data),i(l.data.pagination.total)}).catch(l=>{var u;if(S.isAxiosError(l)){const y=(u=l.response)==null?void 0:u.status;if(y===422){f(l.response.data.errors);return}if(y===404){c([]),i(0);return}}x(l.code)}).finally(()=>o(!1))},[e,r]),{products:a,total:s,loading:d,error:n,validationErrors:p}}function vt(e,r){const[a,c]=g.useState(null),[s,i]=g.useState(!1),[d,o]=g.useState(null);return g.useEffect(()=>{if(e==null){c(null),o(null),i(!1);return}i(!0),o(null),c(null),S.get(`${M}/api/products/${e}`,{headers:{"Accept-Language":r}}).then(n=>{c(n.data.data)}).catch(n=>{var p,f;const x=S.isAxiosError(n)&&((f=(p=n.response)==null?void 0:p.data)!=null&&f.message)?n.response.data.message:n.message;o(x)}).finally(()=>{i(!1)})},[e,r]),{product:a,loading:s,error:d}}function O(){const e=D.getState().addItem,{notify:r}=ht(),{t:a}=b("cart");return async(c,s,i)=>{try{return await e(c,s,i),r(a("cart.add_success"),"success"),!0}catch(d){return d.message.includes("exceeds")?r(a("cart.not_enough_stock",{count:i}),"warning"):r(a("errors.error_update"),"error"),!1}}}function St({open:e,productId:r,lang:a,onClose:c}){const{t:s}=b(["ticket","cart"]),i=D(u=>u.items),d=O(),{product:o,loading:n,error:x}=vt(e?r:null,a),p="product-title";if(n)return t.jsx(w,{open:e,onClose:c,children:t.jsx(A,{sx:{textAlign:"center",py:4},children:t.jsx(W,{})})});if(x||!o)return t.jsx(w,{open:e,onClose:c,children:t.jsx(R,{title:s("ticket:errors.title"),message:s("ticket:errors.not_found"),showRetry:!1,showHome:!1})});const f=u=>$(u,a,"EUR"),k=q(o.product_details.date,a),j=o.stock_quantity===0,_=o.price*(1-o.sale),l=async()=>{const u=i.find(E=>E.id===o.id.toString()),y=((u==null?void 0:u.quantity)??0)+1;await d(o.id.toString(),y,o.stock_quantity)&&c()};return t.jsxs(w,{open:e,onClose:c,maxWidth:"sm",fullWidth:!0,"aria-labelledby":p,children:[t.jsx(dt,{id:p,children:o.name}),t.jsx(A,{dividers:!0,children:o&&t.jsxs(h,{component:"div",children:[t.jsx(h,{component:"img",src:o.product_details.image,alt:o.name,loading:"lazy",sx:{width:"100%",height:200,objectFit:"cover",mb:2}}),t.jsxs(m,{variant:"body1",children:[k,o.product_details.time&&` – ${o.product_details.time}`]}),t.jsx(m,{variant:"body1",color:"text.secondary",sx:{mb:1},children:o.product_details.location}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:s("tickets.category",{category:o.product_details.category})}),t.jsx(m,{variant:"body2",sx:{mb:1},children:o.product_details.description}),t.jsx(m,{variant:"body1",color:"text.secondary",children:s("ticket:tickets.places",{count:o.product_details.places})}),t.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[o.sale>0&&t.jsx(m,{variant:"body2",sx:{textDecoration:"line-through"},children:f(o.price)}),t.jsx(m,{variant:"subtitle1",fontWeight:"bold",children:f(_)}),o.sale>0&&t.jsx(L,{label:`–${Math.round(o.sale*100)}%`,size:"small"})]}),t.jsx(m,{variant:"body2",color:j?"error.main":"text.secondary",sx:{mt:1},children:j?s("ticket:tickets.out_of_stock"):s("ticket:tickets.available",{count:o.stock_quantity})})]})}),t.jsxs(ut,{children:[t.jsx(v,{onClick:c,children:s("ticket:tickets.close")}),t.jsx(v,{variant:"contained",onClick:l,disabled:j,children:s(j?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})}function $t(){const{t:e}=b("ticket"),r=U(l=>l.lang),a=D(l=>l.items),c=O(),[s,i]=g.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:d,total:o,loading:n,error:x,validationErrors:p}=_t(s,r),[f,k]=g.useState(null);g.useEffect(()=>{if(p){const l={};p.sort_by&&(l.sortBy="name",l.order="asc"),p.date&&(l.date=""),p.name&&(l.name=""),p.category&&(l.category=""),p.location&&(l.location=""),p.places&&(l.places=0),i(u=>({...u,...l}))}},[p]);const j=l=>$(l,r,"EUR"),_=l=>q(l,r);return x?t.jsx(R,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>i(l=>({...l})),showHome:!0,homeButtonText:e("errors.home")}):t.jsxs(t.Fragment,{children:[t.jsx(Y,{title:e("tickets.seo_title"),description:e("tickets.seo_description")}),t.jsxs(pt,{disableCard:!0,children:[t.jsx(m,{variant:"h4",sx:{px:2},children:e("tickets.title")}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(yt,{filters:s,onChange:l=>i(u=>({...u,...l}))}),t.jsxs(h,{component:"main",flex:1,children:[n?t.jsx(h,{textAlign:"center",py:8,children:t.jsx(W,{})}):t.jsx(kt,{products:d,fmtCur:j,fmtDate:_,onViewDetails:k,onBuy:async l=>{const u=a.find(G=>G.id===l.id.toString()),I=((u==null?void 0:u.quantity)??0)+1;await c(l.id.toString(),I,l.stock_quantity)&&k(null)}}),!n&&d.length>0&&t.jsx(h,{textAlign:"center",mt:4,children:t.jsx(xt,{count:Math.ceil(o/s.perPage)||1,page:s.page,onChange:(l,u)=>i(y=>({...y,page:u}))})})]})]})]}),t.jsx(St,{open:f!==null,productId:f,lang:r,onClose:()=>k(null)})]})}export{$t as default};
