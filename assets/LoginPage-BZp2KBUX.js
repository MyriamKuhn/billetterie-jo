import{r as n,j as e}from"./react-C0aVURRx.js";import{b as R,u as v,S as oe,l as re,a as W,o as ne,r as ie,c as ae}from"./index-BUXUlOD7.js";import{P as le}from"./PageWrapper-BZs1h3P6.js";import{l as ce}from"./jo_logo-toDFtw-C.js";import{a as _}from"./axios-xsH4HHeE.js";import{q as c,t as h,G as k,J as A,am as de,I as ue,an as me,ao as ge,V as xe,ah as fe,B as q,C as L,ab as p,i as he}from"./mui-Bv5YL-XP.js";import{A as N,g as u}from"./AlertMessage-gDVkVQCd.js";import{u as pe}from"./useCustomSnackbar-CsToXno5.js";import{u as je}from"./i18n-react-DsoMXUU6.js";import{O as be,S as Se}from"./vendor-CluA6s6b.js";import"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-BXBuUsh5.js";import"./helmet-BXAee230.js";import"./cookie-consent-Eepg6n4_.js";function Re(){const{t}=je("login"),P=be(),$=Se(),{notify:D}=pe(),[g,G]=n.useState(""),[F,U]=n.useState(""),[j,O]=n.useState(!1),[b,S]=n.useState(!1),[T,H]=n.useState(""),[d,x]=n.useState(!1),[I,i]=n.useState(null),[J,w]=n.useState(!1),[y,z]=n.useState(!1),[K,E]=n.useState(!1),[C,Q]=n.useState(!1),X=()=>Q(s=>!s),Y=R(s=>s.setToken),Z=R(s=>s.clearToken),B=v(s=>s.setGuestCartId),ee=v(s=>s.guestCartId),V=v(s=>s.loadCart),M=async(s,m)=>{var l,r;s.preventDefault(),i(null),m||S(!1),w(!1),E(!1),x(!0);try{const a=await re(g,F,j,m?T:"",W.getState().lang,ee);if(a.token&&a.user){D(t("login.welcomeUser",{name:a.user.firstname}),"success");const o=new URLSearchParams($.search).get("next")??void 0;await ne(a.token,a.user.role,j,Y,B,V,P,o);return}}catch(a){if(_.isAxiosError(a)){const f=(l=a.response)==null?void 0:l.status,o=(r=a.response)==null?void 0:r.data;if(f===400&&(o==null?void 0:o.code)==="twofa_required"){S(!0),x(!1);return}if(f===400&&(o==null?void 0:o.code)==="email_not_verified"){i(t("errors.emailNotVerifiedSent")),w(!0),x(!1);return}f===404||o!=null&&o.code?i(u(t,o==null?void 0:o.code)):i(u(t,"generic_error"))}else i(u(t,"network_error"))}finally{x(!1)}},te=async s=>{var m;s.preventDefault(),z(!0),i(null);try{const{status:l,data:r}=await ie(g,W.getState().lang);if(l===200&&r.message){E(!0),w(!1);return}}catch(l){if(_.isAxiosError(l)){const r=(m=l.response)==null?void 0:m.data;r!=null&&r.code?i(u(t,r==null?void 0:r.code)):i(u(t,"generic_error"))}else i(u(t,"network_error"))}finally{z(!1)}},se=async()=>{S(!1),await ae(Z,B,V,P,"/login")};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:t("seo.title"),description:t("seo.description")}),e.jsx(le,{disableCard:!0,children:e.jsxs(c,{component:"form",onSubmit:b?s=>M(s,!0):s=>M(s,!1),sx:{maxWidth:400,mx:"auto",mt:{xs:1,sm:4,md:8},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:s=>`1px solid ${s.palette.divider}`},children:[e.jsx(c,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(c,{component:"img",src:ce,alt:t("login.logoAlt"),sx:{height:150,width:"auto"}})}),e.jsx(h,{variant:"h4",gutterBottom:!0,align:"center",children:t("login.pageTitle")}),I&&e.jsx(N,{message:I,severity:"error"}),K&&e.jsx(N,{message:t("login.verificationEmailResent"),severity:"success"}),!b&&e.jsxs(k,{spacing:2,children:[e.jsx(A,{required:!0,fullWidth:!0,id:"email",label:t("login.emailLabel"),type:"email",value:g,onChange:s=>G(s.target.value),autoComplete:"email"}),e.jsx(A,{required:!0,fullWidth:!0,id:"password",label:t("login.passwordLabel"),type:C?"text":"password",value:F,onChange:s=>U(s.target.value),autoComplete:"current-password",slotProps:{input:{endAdornment:e.jsx(de,{position:"end",children:e.jsx(ue,{"aria-label":t(C?"login.hidePassword":"login.showPassword"),onClick:X,edge:"end",children:C?e.jsx(me,{}):e.jsx(ge,{})})})}}}),e.jsx(c,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(xe,{control:e.jsx(fe,{checked:j,onChange:s=>O(s.target.checked),color:"primary"}),label:t("login.rememberMe"),sx:{".MuiFormControlLabel-label":{fontSize:"0.875rem"}}})}),e.jsx(q,{type:"submit",variant:"contained",fullWidth:!0,disabled:d,startIcon:d?e.jsx(L,{color:"inherit",size:16}):void 0,children:d?`${t("login.loginButtonLoad")}…`:t("login.loginButton")}),e.jsx(c,{sx:{mt:1,textAlign:"center"},children:e.jsxs(k,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(p,{href:"/forgot-password",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:t("login.forgotPassword")}),e.jsx(h,{variant:"body2",sx:{fontSize:"0.8rem",mx:.5},children:"|"}),e.jsx(p,{href:"/signup",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:t("login.noAccount")})]})}),J&&e.jsx(c,{sx:{mt:2,textAlign:"center"},children:e.jsxs(h,{variant:"body2",sx:{fontSize:"0.8rem"},children:[t("login.emailNotVerifiedHint")," ",e.jsxs(p,{component:"button",variant:"body2",onClick:te,disabled:y||!/.+@.+\..+/.test(g),sx:{fontSize:"0.8rem"},children:[y?`${t("login.resendLinkText")}…`:t("login.resendLinkText"),y&&e.jsx(L,{color:"inherit",size:12,sx:{mr:.5}})]})]})})]}),b&&e.jsxs(c,{children:[e.jsx(h,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:t("login.twoFATitle")}),e.jsx(A,{required:!0,fullWidth:!0,id:"twoFACode",label:t("login.twoFACodeLabel"),type:"text",value:T,onChange:s=>H(s.target.value),autoComplete:"one-time-code"}),e.jsx(q,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:3},disabled:d,startIcon:d?e.jsx(L,{color:"inherit",size:16}):void 0,children:d?`${t("login.verify2FALoad")}…`:t("login.verify2FAButton")}),e.jsx(he,{sx:{my:3}}),e.jsx(k,{direction:"row",justifyContent:"end",children:e.jsx(p,{component:"button",variant:"body2",onClick:se,sx:{fontSize:"0.8rem"},children:t("login.cancelLogin")})})]})]})})]})}export{Re as default};
