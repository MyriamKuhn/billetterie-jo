import{j as t,r as g}from"./react-C0aVURRx.js";import{A as w,u as S,O as T,a as H,P as z,S as Q}from"./index-0-ZpxhMj.js";import{O as N,Q as B,U as J,j as X,M as K,V as W,W as Z,X as V,Y as tt,q as h,_ as A,$ as P,a0 as et,a1 as st,u as at,t as m,N as rt,a2 as ot,B as v,I as L,p as nt,r as it,a3 as lt,x as ct,a4 as dt,a5 as ut,a6 as $,a7 as D,a8 as M,a9 as xt,aa as mt,ab as pt}from"./mui-Ci1l0Ows.js";import{d as ht}from"./dayjs-DMyafwSS.js";import{u as b}from"./i18n-react-Cm5iFQwB.js";import{a as C}from"./axios-xsH4HHeE.js";import{E as R}from"./ErrorDisplay-Cr9dJZSt.js";import{f as q,a as O}from"./format-BP4WpB1S.js";import{u as gt}from"./useCustomSnackbar-CmxjmyMH.js";import"./zustand-DgaMZn_z.js";import"./vendor-DEk3LB1x.js";import"./i18n-Bhc83OLH.js";import"./emotion-DNCOdpxi.js";import"./helmet-MDiytzVa.js";import"./cookie-consent-CxSVcpKG.js";function I({label:e,value:r,onChange:s,type:c}){return t.jsx(N,{label:e,type:c,size:"small",fullWidth:!0,value:r,onChange:a=>s(a.target.value),slotProps:{inputLabel:{shrink:!0}}})}function ft({label:e,value:r,options:s,onChange:c}){return t.jsxs(B,{size:"small",fullWidth:!0,children:[t.jsx(J,{children:e}),t.jsx(X,{label:e,value:r,onChange:a=>c(a.target.value),children:s.map(a=>t.jsx(K,{value:a,children:a},a))})]})}function jt({legend:e,value:r,options:s,onChange:c}){return t.jsxs(B,{component:"fieldset",children:[t.jsx(W,{component:"legend",children:e}),t.jsx(Z,{row:!0,value:r,onChange:(a,i)=>c(i),children:s.map(a=>t.jsx(V,{value:a.value,control:t.jsx(tt,{size:"small"}),label:a.label},a.value))})]})}function yt({fields:e,sortBy:r,order:s,onSortChange:c,label:a}){const{t:i}=b(),d=(n,x)=>{x&&c(x,s)},o=(n,x)=>{x&&c(r,x)};return t.jsxs(B,{component:"fieldset",fullWidth:!0,children:[t.jsx(W,{component:"legend",sx:{mb:1},children:a}),t.jsxs(h,{sx:{display:"flex",gap:1},children:[t.jsx(A,{value:r,exclusive:!0,size:"small",onChange:d,"aria-label":i("sorting.title"),sx:{flex:1},children:e.map(({value:n,label:x})=>t.jsx(P,{value:n,"aria-label":String(n),children:x},n))}),t.jsxs(A,{value:s,exclusive:!0,size:"small",onChange:o,"aria-label":i("sorting.order"),children:[t.jsx(P,{value:"asc","aria-label":i("sorting.ascendant"),children:t.jsx(et,{fontSize:"small"})}),t.jsx(P,{value:"desc","aria-label":i("sorting.descendant"),children:t.jsx(st,{fontSize:"small"})})]})]})]})}function bt({filters:e,onChange:r}){const{t:s}=b("ticket"),c=at(),[a,i]=g.useState(!1),d=[{value:"name",label:s("filters.name")},{value:"price",label:s("filters.price")},{value:"date",label:s("filters.date")}],o=t.jsxs(h,{sx:{width:260,py:2,px:1},children:[t.jsx(m,{variant:"h6",gutterBottom:!0,children:s("filters.title")}),t.jsxs(rt,{spacing:2,sx:{mx:1},children:[t.jsx(I,{label:s("filters.name"),value:e.name,onChange:n=>r({name:n,page:1})}),t.jsx(I,{label:s("filters.category"),value:e.category,onChange:n=>r({category:n,page:1})}),t.jsx(I,{label:s("filters.location"),value:e.location,onChange:n=>r({location:n,page:1})}),t.jsx(ot,{label:s("filters.date"),value:e.date?ht(e.date):null,onChange:n=>r({date:(n==null?void 0:n.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(jt,{legend:s("filters.places"),value:e.places.toString(),options:[{value:"0",label:s("filters.all_places")},{value:"1",label:s("filters.one_place")},{value:"2",label:s("filters.two_places")},{value:"4",label:s("filters.four_places")}],onChange:n=>r({places:Number(n),page:1})}),t.jsx(yt,{fields:d,sortBy:e.sortBy,order:e.order,onSortChange:(n,x)=>r({sortBy:n,order:x,page:1}),label:s("filters.sort_by")}),t.jsx(ft,{label:s("filters.offers_per_page"),value:e.perPage,options:[1,5,10,15,25,50,100],onChange:n=>r({perPage:n,page:1})}),t.jsx(v,{variant:"outlined",fullWidth:!0,onClick:()=>r({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),children:s("filters.reset")})]})]});return t.jsxs(t.Fragment,{children:[t.jsx(h,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:c.mixins.toolbar.minHeight,bgcolor:"background.paper",border:n=>`1px solid ${n.palette.divider}`,borderRadius:1,width:260},children:o}),t.jsxs(h,{sx:{display:{xs:"block",md:"none"},mb:2},children:[t.jsx(L,{onClick:()=>i(!0),"aria-label":s("filters.title"),children:t.jsx(nt,{})}),t.jsx(it,{open:a,onClose:()=>i(!1),keepMounted:!0,children:t.jsxs(h,{sx:{position:"relative"},children:[t.jsx(L,{onClick:()=>i(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":s("filters.close"),children:t.jsx(lt,{})}),o]})})]})]})}const U="/assets/placeholder-CcHesTJP.png";function kt({product:e,fmtCur:r,fmtDate:s,onViewDetails:c,onBuy:a}){const{t:i}=b(["common","ticket"]),d=e.stock_quantity===0,o=e.price*(1-e.sale);return t.jsx(h,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:t.jsxs(ct,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[t.jsx(dt,{component:"img",image:e.product_details.image?`${w}/products/images/${e.product_details.image}`:U,alt:e.name,loading:"lazy",sx:{width:{xs:"100%",md:320},height:180,objectFit:"cover",alignSelf:{xs:"auto",md:"center"}}}),t.jsxs(ut,{sx:{flexGrow:1},children:[t.jsx(m,{variant:"h6",children:e.name}),t.jsxs(m,{variant:"body2",children:[s(e.product_details.date),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.product_details.location}),t.jsx(m,{variant:"body2",color:"text.secondary",children:i("ticket:tickets.places",{count:e.product_details.places})}),t.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[e.sale>0&&t.jsx(m,{variant:"body2",sx:{textDecoration:"line-through"},children:r(e.price)}),t.jsx(m,{variant:"subtitle1",fontWeight:"bold",children:r(o)}),e.sale>0&&t.jsx($,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]}),t.jsx(m,{variant:"body2",color:d?"error.main":"text.secondary",sx:{mt:1},children:d?i("ticket:tickets.out_of_stock"):i("ticket:tickets.available",{count:e.stock_quantity})})]}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"row",md:"column"},justifyContent:"center",alignItems:"center",gap:1,"& .MuiButton-root":{whiteSpace:"nowrap"}},children:[t.jsx(v,{size:"small",variant:"outlined",onClick:()=>c(e.id),children:i("ticket:tickets.more_info")}),t.jsx(v,{size:"small",variant:"contained",disabled:d,onClick:a,children:i(d?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})})}function _t({products:e,fmtCur:r,fmtDate:s,onViewDetails:c,onBuy:a}){const{t:i}=b("ticket");return e.length===0?t.jsx(m,{variant:"h4",sx:{textAlign:"center"},children:i("tickets.not_found")}):t.jsx(h,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:e.map(d=>t.jsx(kt,{product:d,fmtCur:r,fmtDate:s,onViewDetails:c,onBuy:()=>a(d)},d.id))})}function vt(e,r){const[s,c]=g.useState([]),[a,i]=g.useState(0),[d,o]=g.useState(!1),[n,x]=g.useState(null),[p,f]=g.useState(null);return g.useEffect(()=>{o(!0),x(null),f(null);const j={name:"name",price:"price",date:"product_details->date"}[e.sortBy],_={per_page:Math.max(1,e.perPage),page:e.page,sort_by:j,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};C.get(`${w}/api/products`,{params:_,headers:{"Accept-Language":r}}).then(l=>{c(l.data.data),i(l.data.pagination.total)}).catch(l=>{var u;if(C.isAxiosError(l)){const y=(u=l.response)==null?void 0:u.status;if(y===422){f(l.response.data.errors);return}if(y===404){c([]),i(0);return}}x(l.code)}).finally(()=>o(!1))},[e,r]),{products:s,total:a,loading:d,error:n,validationErrors:p}}function St(e,r){const[s,c]=g.useState(null),[a,i]=g.useState(!1),[d,o]=g.useState(null);return g.useEffect(()=>{if(e==null){c(null),o(null),i(!1);return}i(!0),o(null),c(null),C.get(`${w}/api/products/${e}`,{headers:{"Accept-Language":r}}).then(n=>{c(n.data.data)}).catch(n=>{var p,f;const x=C.isAxiosError(n)&&((f=(p=n.response)==null?void 0:p.data)!=null&&f.message)?n.response.data.message:n.message;o(x)}).finally(()=>{i(!1)})},[e,r]),{product:s,loading:a,error:d}}function Y(){const e=S.getState().addItem,{notify:r}=gt(),{t:s}=b("cart");return async(c,a,i)=>{try{return S.getState().isLocked?(r(s("errors.cart_locked"),"warning"),!1):(await e(c,a,i),r(s("cart.add_success"),"success"),!0)}catch(d){return d.message.includes("exceeds")?r(s("cart.not_enough_stock",{count:i}),"warning"):r(s("errors.error_update"),"error"),!1}}}function Ct({open:e,productId:r,lang:s,onClose:c}){const{t:a}=b(["ticket","cart"]),i=S(u=>u.items),d=Y(),{product:o,loading:n,error:x}=St(e?r:null,s),p="product-title";if(n)return t.jsx(D,{open:e,onClose:c,children:t.jsx(M,{sx:{textAlign:"center",py:4},children:t.jsx(T,{})})});if(x||!o)return t.jsx(D,{open:e,onClose:c,children:t.jsx(R,{title:a("ticket:errors.title"),message:a("ticket:errors.not_found"),showRetry:!1,showHome:!1})});const f=u=>O(u,s,"EUR"),k=q(o.product_details.date,s),j=o.stock_quantity===0,_=o.price*(1-o.sale),l=async()=>{const u=i.find(F=>F.id===o.id.toString()),y=((u==null?void 0:u.quantity)??0)+1;await d(o.id.toString(),y,o.stock_quantity)&&c()};return t.jsxs(D,{open:e,onClose:c,maxWidth:"sm",fullWidth:!0,"aria-labelledby":p,children:[t.jsx(xt,{id:p,children:o.name}),t.jsx(M,{dividers:!0,children:o&&t.jsxs(h,{component:"div",children:[t.jsx(h,{component:"img",src:o.product_details.image?`${w}/products/images/${o.product_details.image}`:U,alt:o.name,loading:"lazy",sx:{width:"100%",height:200,objectFit:"cover",mb:2}}),t.jsxs(m,{variant:"body1",children:[k,o.product_details.time&&` – ${o.product_details.time}`]}),t.jsx(m,{variant:"body1",color:"text.secondary",sx:{mb:1},children:o.product_details.location}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:a("tickets.category",{category:o.product_details.category})}),t.jsx(m,{variant:"body2",sx:{mb:1},children:o.product_details.description}),t.jsx(m,{variant:"body1",color:"text.secondary",children:a("ticket:tickets.places",{count:o.product_details.places})}),t.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[o.sale>0&&t.jsx(m,{variant:"body2",sx:{textDecoration:"line-through"},children:f(o.price)}),t.jsx(m,{variant:"subtitle1",fontWeight:"bold",children:f(_)}),o.sale>0&&t.jsx($,{label:`–${Math.round(o.sale*100)}%`,size:"small"})]}),t.jsx(m,{variant:"body2",color:j?"error.main":"text.secondary",sx:{mt:1},children:j?a("ticket:tickets.out_of_stock"):a("ticket:tickets.available",{count:o.stock_quantity})})]})}),t.jsxs(mt,{children:[t.jsx(v,{onClick:c,children:a("ticket:tickets.close")}),t.jsx(v,{variant:"contained",onClick:l,disabled:j,children:a(j?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})}function qt(){const{t:e}=b("ticket"),r=H(l=>l.lang),s=S(l=>l.items),c=Y(),[a,i]=g.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:d,total:o,loading:n,error:x,validationErrors:p}=vt(a,r),[f,k]=g.useState(null);g.useEffect(()=>{if(p){const l={};p.sort_by&&(l.sortBy="name",l.order="asc"),p.date&&(l.date=""),p.name&&(l.name=""),p.category&&(l.category=""),p.location&&(l.location=""),p.places&&(l.places=0),i(u=>({...u,...l}))}},[p]);const j=l=>O(l,r,"EUR"),_=l=>q(l,r);return x?t.jsx(z,{children:t.jsx(R,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>i(l=>({...l})),showHome:!0,homeButtonText:e("errors.home")})}):t.jsxs(t.Fragment,{children:[t.jsx(Q,{title:e("tickets.seo_title"),description:e("tickets.seo_description")}),t.jsxs(z,{disableCard:!0,children:[t.jsx(m,{variant:"h4",sx:{px:2},children:e("tickets.title")}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(bt,{filters:a,onChange:l=>i(u=>({...u,...l}))}),t.jsxs(h,{component:"main",flex:1,children:[n?t.jsx(h,{textAlign:"center",py:8,children:t.jsx(T,{})}):t.jsx(_t,{products:d,fmtCur:j,fmtDate:_,onViewDetails:k,onBuy:async l=>{const u=s.find(G=>G.id===l.id.toString()),E=((u==null?void 0:u.quantity)??0)+1;await c(l.id.toString(),E,l.stock_quantity)&&k(null)}}),!n&&d.length>0&&t.jsx(h,{textAlign:"center",mt:4,children:t.jsx(pt,{count:Math.ceil(o/a.perPage)||1,page:a.page,onChange:(l,u)=>i(y=>({...y,page:u}))})})]})]})]}),t.jsx(Ct,{open:f!==null,productId:f,lang:r,onClose:()=>k(null)})]})}export{qt as default};
