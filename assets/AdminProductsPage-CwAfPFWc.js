import{r as x,j as t}from"./react-C0aVURRx.js";import{A as w,b as z,F as H,O as W,a as V,P as R,S as X}from"./index-CY5QxFiC.js";import{P as K}from"./ProductsFilters-Cok8Lvlk.js";import{f as Q,a as A}from"./format-_gz818Hm.js";import{u as E}from"./useCustomSnackbar-Cbu9vsWE.js";import{u as P}from"./i18n-react-DKLIrUu3.js";import{y as U,V as O,v as b,q as j,a1 as S,W as F,B as $,r as Y,Y as Z,a2 as tt,a3 as et,a4 as at,$ as st,X as I,_ as q,a0 as rt}from"./mui-CUyLNCSY.js";import{a as D}from"./axios-Dq7h7Pqt.js";import{E as T}from"./ErrorDisplay-CqpRduDy.js";import{a0 as nt}from"./vendor-DdBxgcTm.js";import{d as ot}from"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-3DDxC2qG.js";import"./helmet-D-y5f56R.js";import"./cookie-consent-h1U6JL3J.js";import"./FilterField-pDWxjenY.js";import"./FilterSelect-BlR2P65X.js";import"./FilterRadios-CXY-oyuw.js";import"./SortControl-Cbk5ScMT.js";function it({product:e,lang:r,onViewDetails:h,onSave:f,onRefresh:n,onDuplicate:o}){const{t:l}=P("adminProducts"),{notify:c}=E(),[p,y]=x.useState(e.price),[i,v]=x.useState(e.sale),[_,d]=x.useState(e.sale*100),[u,g]=x.useState(e.stock_quantity),[s,a]=x.useState(!1),m=p*(1-i),C=x.useMemo(()=>p!==e.price||i!==e.sale||u!==e.stock_quantity,[p,i,u,e]),J=async()=>{a(!0);const k=await f(e.id,{price:p,sale:i,stock_quantity:u});a(!1),k?(c(l("products.success"),"success"),n()):c(l("errors.save_failed"),"error")};return t.jsxs(U,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:[t.jsxs(O,{children:[t.jsxs(b,{variant:"h6",children:["ID ",e.id," - ",e.name]}),t.jsxs(b,{variant:"body2",children:[Q(e.product_details.date,r),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsxs(b,{variant:"body2",color:"text.secondary",children:[e.product_details.location," - ",l("products.places",{count:e.product_details.places})]})]}),t.jsxs(j,{sx:{display:"flex",gap:2,flexWrap:"wrap",px:2},children:[t.jsx(S,{label:l("products.price"),type:"number",value:p,onChange:k=>y(parseFloat(k.target.value)),size:"small",slotProps:{input:{endAdornment:t.jsx(F,{label:"€",size:"small"})}}}),t.jsx(S,{label:l("products.sale"),type:"number",value:_,onChange:k=>{const B=parseFloat(k.target.value)||0;d(B),v(B/100)},slotProps:{input:{endAdornment:t.jsx(F,{label:"%",size:"small"})}},size:"small"}),t.jsx(S,{label:l("products.stock"),type:"number",value:u,onChange:k=>g(parseInt(k.target.value,10)),size:"small"})]}),t.jsxs(j,{sx:{px:2,display:"flex",alignItems:"baseline",justifyContent:{xs:"flex-start",md:"space-between"},flexDirection:{xs:"column",md:"row"},gap:1},children:[t.jsxs(j,{sx:{display:"flex",alignItems:"start",flexDirection:"column"},children:[t.jsxs(b,{variant:"body2",children:[l("products.currentPrice")," :"]}),t.jsx(b,{variant:"body2",sx:{textDecoration:e.sale>0?"line-through":"none"},children:A(e.price,r,"EUR")}),e.sale>0&&t.jsxs(j,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[t.jsx(b,{variant:"body2",fontWeight:"bold",children:A(e.price*(1-e.sale),r,"EUR")}),t.jsx(F,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]})]}),t.jsxs(j,{sx:{display:"flex",alignItems:"start",flexDirection:"column"},children:[t.jsxs(b,{variant:"subtitle1",fontWeight:"bold",children:[l("products.newPrice")," :"]}),t.jsx(b,{variant:"body2",sx:{textDecoration:i>0?"line-through":"none"},children:A(p,r,"EUR")}),i>0&&t.jsxs(j,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[t.jsx(b,{variant:"subtitle1",fontWeight:"bold",children:A(m,r,"EUR")}),t.jsx(F,{label:`–${Math.round(i*100)}%`,size:"small"})]})]})]}),t.jsxs(j,{sx:{display:"flex",justifyContent:"center",flexDirection:{xs:"column",md:"row"},gap:1,mt:2},children:[t.jsx($,{size:"small",variant:"outlined",onClick:()=>h(e.id),children:l("products.updateDetails")}),t.jsx($,{size:"small",variant:"outlined",onClick:()=>o(e.id),children:l("products.duplicate")}),t.jsx($,{size:"small",variant:"contained",disabled:s||!C,onClick:J,startIcon:s?t.jsx(Y,{color:"inherit",size:16}):void 0,children:l(s?"products.saving":"products.save")})]})]})}function lt({onCreate:e}){const{t:r}=P("adminProducts");return t.jsxs(U,{sx:{p:2,minWidth:240,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[t.jsxs(O,{children:[t.jsx(b,{variant:"h6",gutterBottom:!0,children:r("products.create_new")}),t.jsx(b,{variant:"body2",color:"text.secondary",children:r("products.create_intro")})]}),t.jsx(j,{sx:{p:2,pt:0},children:t.jsx($,{fullWidth:!0,variant:"contained",onClick:e,children:r("products.create_button")})})]})}function ct({products:e,lang:r,onViewDetails:h,onSave:f,onRefresh:n,onDuplicate:o,onCreate:l}){const{t:c}=P("adminProducts");return e.length===0?t.jsx(b,{variant:"h4",sx:{textAlign:"center"},children:c("errors.not_found")}):t.jsxs(j,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:[t.jsx(lt,{onCreate:l}),e.map(p=>t.jsx(it,{product:p,lang:r,onViewDetails:h,onSave:f,onRefresh:n,onDuplicate:o},p.id))]})}function dt(e,r,h){const[f,n]=x.useState([]),[o,l]=x.useState(0),[c,p]=x.useState(!1),[y,i]=x.useState(null),[v,_]=x.useState(null);return x.useEffect(()=>{p(!0),i(null),_(null);const u={name:"name",price:"price",date:"product_details->date"}[e.sortBy],g={per_page:Math.max(1,e.perPage),page:e.page,sort_by:u,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};D.get(`${w}/api/products/all`,{params:g,headers:{Authorization:`Bearer ${h}`,"Accept-Language":r}}).then(s=>{n(s.data.data),l(s.data.pagination.total)}).catch(s=>{var a;if(D.isAxiosError(s)){const m=(a=s.response)==null?void 0:a.status;if(m===422){_(s.response.data.errors);return}if(m===404){n([]),l(0);return}}i(s.code)}).finally(()=>p(!1))},[e,r]),{products:f,total:o,loading:c,error:y,validationErrors:v}}function N(e,r){const[h,f]=x.useState(null),[n,o]=x.useState(!1),[l,c]=x.useState(null);return x.useEffect(()=>{if(e==null){f(null),c(null),o(!1);return}o(!0),c(null),Promise.all(r.map(p=>D.get(`${w}/api/products/${e}`,{headers:{"Accept-Language":p}}).then(y=>y.data.data))).then(p=>{const y=r.reduce((i,v,_)=>(i[v]=p[_],i),{});f(y)}).catch(p=>{var i,v;const y=D.isAxiosError(p)&&((v=(i=p.response)==null?void 0:i.data)!=null&&v.message)?p.response.data.message:p.message;c(y)}).finally(()=>o(!1))},[e,JSON.stringify(r)]),{data:h,loading:n,error:l}}function ut(){const e=z(r=>r.authToken);return async function(h,f){try{return await D.post(`${w}/api/products/${h}`,f,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),!0}catch{return!1}}}function pt({previewUrl:e,onFileSelected:r,label:h}){const{t:f}=P("adminProducts"),{getRootProps:n,getInputProps:o,isDragActive:l}=nt({onDrop:([c])=>r(c??null),accept:{"image/*":[]},multiple:!1});return t.jsxs(j,{sx:{textAlign:"center",mb:2},children:[e?t.jsx(j,{component:"img",src:e,sx:{maxWidth:"100%",maxHeight:200,objectFit:"cover",mb:1}}):t.jsx(b,{color:"text.secondary",sx:{mb:1},children:f("products.no_image")}),t.jsxs(j,{...n(),sx:{p:2,border:"2px dashed",borderColor:l?"primary.main":"grey.500",borderRadius:1,cursor:"pointer",bgcolor:l?"grey.100":"transparent"},children:[t.jsx("input",{...o()}),t.jsx(b,{children:l?f("products.image_here"):h})]})]})}const L=[{code:"fr",country:"FR"},{code:"en",country:"US"},{code:"de",country:"DE"}];function M({initialValues:e,saving:r,onSubmit:h,onCancel:f}){const{t:n}=P("adminProducts"),[o,l]=x.useState(e),[c,p]=x.useState(0),y=x.useMemo(()=>L[c].code,[c]);x.useEffect(()=>{l(e),p(0)},[e]);const[i,v]=x.useState(!1);x.useEffect(()=>{v(JSON.stringify(o)!==JSON.stringify(e))},[o,e]);const _=x.useMemo(()=>{if(!(!!o.imageFile||!!o.translations.en.product_details.image)||o.price<=0||o.stock_quantity<0)return!1;for(const s of["fr","en","de"]){const a=o.translations[s];if(!a.name||!a.product_details.date||!a.product_details.time||!a.product_details.location||!a.product_details.category||a.product_details.places<=0||!a.product_details.description)return!1}return!0},[o]),d=(g,s)=>{p(s)},u=async()=>{await h(o)&&f()};return t.jsxs(t.Fragment,{children:[t.jsxs(Z,{dividers:!0,children:[t.jsxs(j,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[t.jsx(S,{label:n("products.price"),type:"number",value:o.price,onChange:g=>l(s=>({...s,price:parseFloat(g.target.value)})),slotProps:{input:{endAdornment:t.jsx(F,{label:"€",size:"small"})}},size:"small"}),t.jsx(S,{label:n("products.sale"),type:"number",value:o.sale*100,onChange:g=>l(s=>({...s,sale:(parseFloat(g.target.value)||0)/100})),slotProps:{input:{endAdornment:t.jsx(F,{label:"%",size:"small"})}},size:"small"}),t.jsx(S,{label:n("products.stock"),type:"number",value:o.stock_quantity,onChange:g=>l(s=>({...s,stock_quantity:parseInt(g.target.value,10)})),size:"small"})]}),t.jsx(j,{sx:{mb:2},children:t.jsx(pt,{previewUrl:o.imageFile?URL.createObjectURL(o.imageFile):o.translations.en.product_details.image?`${w}/products/images/${o.translations.en.product_details.image}`:void 0,label:n("products.image_here"),onFileSelected:g=>l(s=>({...s,imageFile:g??void 0}))})}),t.jsx(tt,{value:c,onChange:d,variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,children:L.map(g=>t.jsx(et,{icon:t.jsx(H,{code:g.country,width:24,height:16}),"aria-label":g.code.toUpperCase()},g.code))}),(()=>{const g=y,s=o.translations[g];return t.jsxs(j,{component:"form",noValidate:!0,sx:{mt:2},children:[t.jsx(S,{fullWidth:!0,label:n("products.name"),value:s.name,onChange:a=>l(m=>({...m,translations:{...m.translations,[g]:{...s,name:a.target.value}}})),sx:{mb:2}}),t.jsx(S,{fullWidth:!0,multiline:!0,minRows:3,label:n("products.description"),value:s.product_details.description,onChange:a=>l(m=>({...m,translations:{...m.translations,[g]:{...s,product_details:{...s.product_details,description:a.target.value}}}})),sx:{mb:2}}),t.jsxs(j,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[t.jsx(S,{label:n("products.place"),type:"number",fullWidth:!0,value:s.product_details.places,onChange:a=>l(m=>({...m,translations:{...m.translations,[g]:{...s,product_details:{...s.product_details,places:parseInt(a.target.value,10)}}}})),size:"small"}),t.jsx(at,{label:n("products.date"),value:s.product_details.date?ot(s.product_details.date):null,onChange:a=>{const m=a?a.format("YYYY-MM-DD"):"";l(C=>({...C,translations:{...C.translations,[g]:{...s,product_details:{...s.product_details,date:m}}}}))},slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(S,{label:n("products.time"),value:s.product_details.time,fullWidth:!0,onChange:a=>l(m=>({...m,translations:{...m.translations,[g]:{...s,product_details:{...s.product_details,time:a.target.value}}}})),slotProps:{inputLabel:{shrink:!0}},size:"small"})]}),t.jsx(S,{fullWidth:!0,label:n("products.location"),value:s.product_details.location,onChange:a=>l(m=>({...m,translations:{...m.translations,[g]:{...s,product_details:{...s.product_details,location:a.target.value}}}})),sx:{mb:2}}),t.jsx(S,{fullWidth:!0,label:n("products.category"),value:s.product_details.category,onChange:a=>l(m=>({...m,translations:{...m.translations,[g]:{...s,product_details:{...s.product_details,category:a.target.value}}}}))})]})})()]}),t.jsxs(st,{children:[t.jsx($,{onClick:f,children:n("products.close")}),t.jsx($,{variant:"contained",onClick:u,disabled:!_||!i||r,startIcon:r?t.jsx(Y,{size:16}):void 0,children:n(r?"products.saving":"products.save")})]})]})}function mt({open:e,productId:r,onClose:h,onRefresh:f}){const{t:n}=P("adminProducts"),{notify:o}=E(),l=ut(),{data:c,loading:p,error:y}=N(e?r:null,["fr","en","de"]),i=x.useMemo(()=>{if(!c)return null;const d=c.en;return{price:d.price,sale:d.sale,stock_quantity:d.stock_quantity,imageFile:void 0,translations:{fr:{name:c.fr.name,product_details:{...c.fr.product_details,imageFile:void 0}},en:{name:c.en.name,product_details:{...c.en.product_details,imageFile:void 0}},de:{name:c.de.name,product_details:{...c.de.product_details,imageFile:void 0}}}}},[c]),[v,_]=x.useState(!1);return t.jsxs(I,{open:e,onClose:h,maxWidth:"sm",fullWidth:!0,children:[t.jsx(q,{children:n("products.modification",{id:r})}),p&&t.jsx(j,{textAlign:"center",py:4,children:t.jsx(W,{})}),y&&t.jsx(T,{title:n("errors.title"),message:n("errors.not_found")}),!p&&!y&&i&&t.jsx(M,{initialValues:i,saving:v,onSubmit:async d=>{_(!0);const u=new FormData;u.append("price",d.price.toString()),u.append("sale",d.sale.toString()),u.append("stock_quantity",d.stock_quantity.toString()),["fr","en","de"].forEach(s=>{const a=d.translations[s];u.append(`translations[${s}][name]`,a.name),u.append(`translations[${s}][product_details][places]`,a.product_details.places.toString()),u.append(`translations[${s}][product_details][description]`,a.product_details.description),u.append(`translations[${s}][product_details][date]`,a.product_details.date),u.append(`translations[${s}][product_details][time]`,a.product_details.time),u.append(`translations[${s}][product_details][location]`,a.product_details.location),u.append(`translations[${s}][product_details][category]`,a.product_details.category)}),d.imageFile&&u.append("image",d.imageFile,d.imageFile.name);const g=await l(r,u);return _(!1),g?(o(n("products.success"),"success"),f(),!0):(o(n("errors.save_failed"),"error"),!1)},onCancel:h})]})}function xt(){const e=z(r=>r.authToken);return async function(h,f){try{return await D.patch(`${w}/api/products/${h}/pricing`,f,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),!0}catch{return!1}}}function G(){const e=z(r=>r.authToken);return async function(h){try{return await D.post(`${w}/api/products`,h,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),!0}catch{return!1}}}function gt({open:e,productId:r,onClose:h,onRefresh:f}){const{t:n}=P("adminProducts"),{notify:o}=E(),l=G(),{data:c,loading:p,error:y}=N(e?r:null,["fr","en","de"]),i=x.useMemo(()=>{if(!c)return null;const d=c.en;return{price:d.price,sale:d.sale,stock_quantity:d.stock_quantity,imageFile:void 0,translations:{fr:{name:c.fr.name,product_details:{...c.fr.product_details,image:"",imageFile:void 0}},en:{name:c.en.name,product_details:{...c.en.product_details,image:"",imageFile:void 0}},de:{name:c.de.name,product_details:{...c.de.product_details,image:"",imageFile:void 0}}}}},[c]),[v,_]=x.useState(!1);return t.jsxs(I,{open:e,onClose:h,maxWidth:"sm",fullWidth:!0,children:[t.jsx(q,{children:n("products.duplication",{id:r})}),p&&t.jsx(j,{textAlign:"center",py:4,children:t.jsx(W,{})}),y&&t.jsx(T,{title:n("errors.title"),message:n("errors.not_found")}),!p&&!y&&i&&t.jsx(M,{initialValues:i,saving:v,onSubmit:async d=>{_(!0);const u=new FormData;u.append("price",d.price.toString()),u.append("sale",d.sale.toString()),u.append("stock_quantity",d.stock_quantity.toString()),["fr","en","de"].forEach(s=>{const a=d.translations[s];u.append(`translations[${s}][name]`,a.name),u.append(`translations[${s}][product_details][places]`,a.product_details.places.toString()),u.append(`translations[${s}][product_details][description]`,a.product_details.description),u.append(`translations[${s}][product_details][date]`,a.product_details.date),u.append(`translations[${s}][product_details][time]`,a.product_details.time),u.append(`translations[${s}][product_details][location]`,a.product_details.location),u.append(`translations[${s}][product_details][category]`,a.product_details.category)}),d.imageFile&&u.append("image",d.imageFile,d.imageFile.name);const g=await l(u);return _(!1),g?(o(n("products.success"),"success"),f(),!0):(o(n("errors.save_failed"),"error"),!1)},onCancel:h})]})}function ft({open:e,onClose:r,onRefresh:h}){const{t:f}=P("adminProducts"),{notify:n}=E(),o=G(),[l,c]=x.useState(!1),p=x.useMemo(()=>({price:0,sale:0,stock_quantity:0,imageFile:void 0,translations:{fr:{name:"",product_details:{places:0,description:"",date:"",time:"",location:"",category:"",image:"",imageFile:void 0}},en:{name:"",product_details:{places:0,description:"",date:"",time:"",location:"",category:"",image:"",imageFile:void 0}},de:{name:"",product_details:{places:0,description:"",date:"",time:"",location:"",category:"",image:"",imageFile:void 0}}}}),[]);return t.jsxs(I,{open:e,onClose:r,maxWidth:"sm",fullWidth:!0,children:[t.jsx(q,{children:f("products.create_new")}),t.jsx(M,{initialValues:p,saving:l,onSubmit:async y=>{c(!0);const i=new FormData;i.append("price",y.price.toString()),i.append("sale",y.sale.toString()),i.append("stock_quantity",y.stock_quantity.toString()),["fr","en","de"].forEach(_=>{const d=y.translations[_];i.append(`translations[${_}][name]`,d.name),i.append(`translations[${_}][product_details][places]`,d.product_details.places.toString()),i.append(`translations[${_}][product_details][description]`,d.product_details.description),i.append(`translations[${_}][product_details][date]`,d.product_details.date),i.append(`translations[${_}][product_details][time]`,d.product_details.time),i.append(`translations[${_}][product_details][location]`,d.product_details.location),i.append(`translations[${_}][product_details][category]`,d.product_details.category)}),y.imageFile&&i.append("image",y.imageFile,y.imageFile.name);const v=await o(i);return c(!1),v?(n(f("products.success"),"success"),h(),!0):(n(f("errors.save_failed"),"error"),!1)},onCancel:r})]})}function Tt(){const{t:e}=P("adminProducts"),r=V(a=>a.lang),h=z(a=>a.authToken),f=xt(),[n,o]=x.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:l,total:c,loading:p,error:y,validationErrors:i}=dt(n,r,h),[v,_]=x.useState(null),[d,u]=x.useState(null),[g,s]=x.useState(!1);return x.useEffect(()=>{if(i){const a={};i.sort_by&&(a.sortBy="name",a.order="asc"),i.date&&(a.date=""),i.name&&(a.name=""),i.category&&(a.category=""),i.location&&(a.location=""),i.places&&(a.places=0),o(m=>({...m,...a}))}},[i]),y?t.jsx(R,{children:t.jsx(T,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>o(a=>({...a})),showHome:!0,homeButtonText:e("errors.home")})}):t.jsxs(t.Fragment,{children:[t.jsx(X,{title:e("seo.title"),description:e("seo.description")}),t.jsxs(R,{disableCard:!0,children:[t.jsx(b,{variant:"h4",sx:{px:2},children:e("products.title")}),t.jsxs(j,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(K,{filters:n,onChange:a=>o(m=>({...m,...a}))}),t.jsxs(j,{component:"main",flex:1,children:[p?t.jsx(j,{textAlign:"center",py:8,children:t.jsx(W,{})}):t.jsx(ct,{products:l,lang:r,onViewDetails:_,onSave:async(a,m)=>await f(a,{price:m.price,sale:m.sale,stock_quantity:m.stock_quantity}),onRefresh:()=>o(a=>({...a})),onDuplicate:u,onCreate:()=>s(!0)}),!p&&l.length>0&&t.jsx(j,{textAlign:"center",mt:4,children:t.jsx(rt,{count:Math.ceil(c/n.perPage)||1,page:n.page,onChange:(a,m)=>o(C=>({...C,page:m}))})})]})]})]}),t.jsx(mt,{open:v!==null,productId:v,lang:r,onClose:()=>_(null),onRefresh:()=>o(a=>({...a}))}),t.jsx(gt,{open:d!==null,productId:d,lang:r,onClose:()=>u(null),onRefresh:()=>o(a=>({...a}))}),t.jsx(ft,{open:g,lang:r,onClose:()=>s(!1),onRefresh:()=>o(a=>({...a}))})]})}export{Tt as default};
