import{r as s,j as t}from"./react-C0aVURRx.js";import{S as pe}from"./Seo-CkXwJOyJ.js";import{P as ge}from"./PageWrapper-otroOoLH.js";import{l as he,A as K,g as h}from"./AlertMessage-DMKOtRGk.js";import{a0 as xe}from"./vendor-JT0P6-Ac.js";import{a as fe,R as je,d as be}from"./index-Q-gZHGuk.js";import{q as u,J as T,am as U,I as Z,an as G,ao as J,ap as Se,aq as we,t as y,u as Ce,n as ve,B as N,ab as _,G as ye,V as Te,ah as ke,C as Ee}from"./mui-BwUJxCPm.js";import{a as Pe}from"./axios-xsH4HHeE.js";import{u as Y}from"./i18n-react-u0paBAQg.js";import"./dayjs-DMyafwSS.js";import"./helmet-8QjG9zRw.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./emotion-Dvs1mEHu.js";import"./cookie-consent-B6r0YzHB.js";function Me(e){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{15,}$/.test(e)}function Q(e){return/^[\w-.]+@([\w-]+\.)+[\w-]{2,}$/.test(e)}function Ae({firstname:e,lastname:c,email:d,password:l,confirmPassword:o,firstnameTouched:j,lastnameTouched:r,emailTouched:m}){const x=j&&e.trim()==="",p=r&&c.trim()==="",f=m&&!Q(d),b=s.useMemo(()=>Me(l),[l]),g=s.useMemo(()=>l===o,[l,o]);return{firstnameError:x,lastnameError:p,emailError:f,pwStrong:b,pwsMatch:g,isFirstnameValid:e.trim()!=="",isLastnameValid:c.trim()!=="",isEmailValid:Q(d)}}function Le({password:e,onPasswordChange:c,confirmPassword:d,onConfirmChange:l,touched:o,onBlur:j}){const{t:r}=Y("signup"),[m,x]=s.useState(!1),[p,f]=s.useState(!1),b=s.useMemo(()=>({length:e.length>=15,upper:/[A-Z]/.test(e),lower:/[a-z]/.test(e),number:/\d/.test(e),special:/[\W_]/.test(e)}),[e]),g=Object.values(b).every(Boolean),k=e===d;return t.jsxs(u,{children:[t.jsx(T,{required:!0,fullWidth:!0,type:m?"text":"password",label:r("signup.passwordLabel"),value:e,onChange:i=>c(i.target.value),onBlur:j,autoComplete:"new-password",error:o&&!g,helperText:o&&!g?r("signup.hintPasswordCriteria"):"",slotProps:{input:{endAdornment:t.jsx(U,{position:"end",children:t.jsx(Z,{"aria-label":r(m?"signup.hidePassword":"signup.showPassword"),onClick:()=>x(!m),edge:"end",children:m?t.jsx(G,{}):t.jsx(J,{})})})}}}),t.jsx(u,{sx:{pl:1,mt:1},children:Object.entries(b).map(([i,M])=>t.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:.5},children:[M?t.jsx(Se,{fontSize:"small",sx:{color:"success.main",mr:1}}):t.jsx(we,{fontSize:"small",sx:{color:"text.disabled",mr:1}}),t.jsx(y,{variant:"body2",children:r(`passwordCriteria.${i}`)})]},i))}),t.jsx(T,{required:!0,fullWidth:!0,sx:{mt:2},type:p?"text":"password",label:r("signup.confirmPasswordLabel"),value:d,onChange:i=>l(i.target.value),onBlur:j,autoComplete:"new-password",error:o&&!k,helperText:o&&!k?r("signup.hintPasswordsDontMatch"):"",slotProps:{input:{endAdornment:t.jsx(U,{position:"end",children:t.jsx(Z,{"aria-label":r(p?"signup.hidePassword":"signup.showPassword"),onClick:()=>f(!p),edge:"end",children:p?t.jsx(G,{}):t.jsx(J,{})})})}}})]})}function Ze(){const{t:e}=Y("signup"),c=fe(n=>n.lang),d=Ce(),l=ve(d.breakpoints.down("sm")),o=d.palette.mode==="dark",j=`${c}-${o?"dark":"light"}-${l?"compact":"normal"}`,[r,m]=s.useState(""),[x,p]=s.useState(""),[f,b]=s.useState(""),[g,k]=s.useState(""),[i,M]=s.useState(""),[S,X]=s.useState(!1),[ee,te]=s.useState(!1),[se,re]=s.useState(!1),[ae,ne]=s.useState(!1),[oe,ie]=s.useState(!1),{firstnameError:q,lastnameError:B,emailError:R,pwStrong:W,pwsMatch:V,isFirstnameValid:le,isLastnameValid:ue,isEmailValid:ce}=Ae({firstname:r,lastname:x,email:f,password:g,confirmPassword:i,firstnameTouched:ee,lastnameTouched:se,emailTouched:ae}),[w,E]=s.useState(null),A=s.useRef(null),[P,I]=s.useState(!1),[z,a]=s.useState(null),[F,$]=s.useState(null),de=async n=>{var O,D,H;if(n.preventDefault(),a(null),$(null),!W){a(e("errors.passwordNotStrong"));return}if(!V){a(e("errors.passwordsDontMatch"));return}if(!S){a(e("errors.mustAgreeTOS"));return}if(!w){a(e("errors.captchaRequired"));return}I(!0);try{const{status:C}=await be({firstname:r,lastname:x,email:f,password:g,password_confirmation:i,captcha_token:w,accept_terms:S},c);C===201&&($(e("signup.successMessage")),(O=A.current)==null||O.reset())}catch(C){if(I(!1),(D=A.current)==null||D.reset(),E(null),Pe.isAxiosError(C)&&C.response){const{status:L,data:v}=C.response;if(L===429){a(h(e,"too_many_requests"));return}if(L===500){a(h(e,"internal_error"));return}if(L===422&&v.code==="validation_error"){const me=((H=v.errors)==null?void 0:H.email)||[];a(h(e,v.code)),me.includes("validation.unique")?a(h(e,"email_already_registered")):a(h(e,"validation_error"));return}v.code?a(h(e,v.code)):a(h(e,"generic_error"))}else a(h(e,"network_error"))}};return t.jsxs(t.Fragment,{children:[t.jsx(pe,{title:e("seo.title"),description:e("seo.description")}),t.jsx(ge,{disableCard:!0,children:t.jsxs(u,{component:"form",onSubmit:de,sx:{maxWidth:400,mx:"auto",mt:{xs:0,sm:1,md:1},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:n=>`1px solid ${n.palette.divider}`},children:[t.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:t.jsx(u,{component:"img",src:he,alt:e("signup.logoAlt"),sx:{height:150,width:"auto"}})}),t.jsx(y,{variant:"h4",gutterBottom:!0,align:"center",children:e("signup.pageTitle")}),z&&t.jsx(K,{message:z,severity:"error"}),F&&t.jsxs(t.Fragment,{children:[t.jsx(K,{message:F,severity:"success"}),t.jsx(u,{sx:{textAlign:"center",mt:2},children:t.jsx(N,{component:_,href:"/login",variant:"outlined",children:e("signup.goToLogin")})})]}),t.jsxs(ye,{spacing:2,children:[t.jsx(T,{required:!0,fullWidth:!0,id:"firstname",label:e("signup.firstnameLabel"),value:r,onChange:n=>m(n.target.value),onBlur:()=>te(!0),autoComplete:"given-name",error:q,helperText:q?e("errors.firstnameRequired"):""}),t.jsx(T,{required:!0,fullWidth:!0,id:"lastname",label:e("signup.lastnameLabel"),value:x,onChange:n=>p(n.target.value),onBlur:()=>re(!0),autoComplete:"family-name",error:B,helperText:B?e("errors.lastnameRequired"):""}),t.jsx(T,{required:!0,fullWidth:!0,id:"email",label:e("signup.emailLabel"),type:"email",value:f,onChange:n=>b(n.target.value),onBlur:()=>ne(!0),autoComplete:"email",error:R,helperText:R?e("errors.invalidEmail"):""}),t.jsx(Le,{password:g,onPasswordChange:k,confirmPassword:i,onConfirmChange:M,touched:oe,onBlur:()=>ie(!0)}),t.jsx(Te,{control:t.jsx(ke,{checked:S,onChange:n=>X(n.target.checked)}),label:t.jsxs(y,{variant:"body2",sx:{fontSize:"0.875rem"},children:[e("signup.agreeTOS")," ",t.jsx(_,{href:"/privacy-policy",target:"_blank",underline:"hover",children:e("signup.termsLink")})]})}),t.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:1},children:t.jsx(xe,{ref:A,sitekey:je,size:l?"compact":"normal",theme:o?"dark":"light",hl:c,onChange:E,onExpired:()=>E(null),onErrored:()=>E(null)},j)}),t.jsx(N,{type:"submit",variant:"contained",fullWidth:!0,disabled:P||!w||!S||!V||!W||!le||!ue||!ce,sx:{mt:2},startIcon:P?t.jsx(Ee,{color:"inherit",size:16}):void 0,children:P?`${e("signup.signupButtonLoad")}â€¦`:e("signup.signupButton")}),!P&&(!w||!S)&&t.jsxs(y,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1,textAlign:"center"},children:[!w&&e("signup.hintCaptchaRequired"),!S&&e("signup.hintMustAgreeTOS")]}),t.jsx(u,{sx:{mt:1,textAlign:"center"},children:t.jsxs(y,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e("signup.alreadyHaveAccount")," ",t.jsx(_,{href:"/login",underline:"hover",variant:"body2",children:e("signup.loginLink")})]})})]})]})})]})}export{Ze as default};
