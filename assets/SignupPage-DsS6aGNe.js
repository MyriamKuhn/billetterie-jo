import{r,j as t}from"./react-C0aVURRx.js";import{a as le,S as ue,P as ce,R as me,d as de}from"./index-0-ZpxhMj.js";import{l as pe}from"./jo_logo-toDFtw-C.js";import{a1 as ge}from"./vendor-DEk3LB1x.js";import{A as I,g as n}from"./AlertMessage-BhcuUp15.js";import{u as he,n as xe,q as u,t as v,B as H,ac as L,N as fe,O as _,X as Se,ai as je,C as be}from"./mui-Ci1l0Ows.js";import{a as ve}from"./axios-xsH4HHeE.js";import{i as ye,a as K}from"./validation-491qobvS.js";import{P as Te}from"./PasswordWithConfirmation-CN-JjBmA.js";import{u as Ce}from"./i18n-react-Cm5iFQwB.js";import"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-DNCOdpxi.js";import"./helmet-MDiytzVa.js";import"./cookie-consent-CxSVcpKG.js";function Ee({firstname:e,lastname:i,email:c,password:o,confirmPassword:m,firstnameTouched:y,lastnameTouched:d,emailTouched:T}){const p=y&&e.trim()==="",C=d&&i.trim()==="",g=T&&!K(c),E=r.useMemo(()=>ye(o),[o]),h=r.useMemo(()=>o===m,[o,m]);return{firstnameError:p,lastnameError:C,emailError:g,pwStrong:E,pwsMatch:h,isFirstnameValid:e.trim()!=="",isLastnameValid:i.trim()!=="",isEmailValid:K(c)}}function De(){const{t:e}=Ce("signup"),i=le(a=>a.lang),c=he(),o=xe(c.breakpoints.down("sm")),m=c.palette.mode==="dark",y=`${i}-${m?"dark":"light"}-${o?"compact":"normal"}`,[d,T]=r.useState(""),[p,C]=r.useState(""),[g,E]=r.useState(""),[h,N]=r.useState(""),[k,Q]=r.useState(""),[l,U]=r.useState(!1),[X,Y]=r.useState(!1),[G,J]=r.useState(!1),[Z,ee]=r.useState(!1),[te,re]=r.useState(!1),{firstnameError:A,lastnameError:P,emailError:R,pwStrong:q,pwsMatch:B,isFirstnameValid:se,isLastnameValid:ae,isEmailValid:ne}=Ee({firstname:d,lastname:p,email:g,password:h,confirmPassword:k,firstnameTouched:X,lastnameTouched:G,emailTouched:Z}),[x,j]=r.useState(null),w=r.useRef(null),[b,F]=r.useState(!1),[V,s]=r.useState(null),[W,$]=r.useState(null),oe=async a=>{var z,O,D;if(a.preventDefault(),s(null),$(null),!q){s(e("errors.passwordNotStrong"));return}if(!B){s(e("errors.passwordsDontMatch"));return}if(!l){s(e("errors.mustAgreeTOS"));return}if(!x){s(e("errors.captchaRequired"));return}F(!0);try{const{status:f}=await de({firstname:d,lastname:p,email:g,password:h,password_confirmation:k,captcha_token:x,accept_terms:l},i);f===201&&($(e("signup.successMessage")),(z=w.current)==null||z.reset())}catch(f){if(F(!1),(O=w.current)==null||O.reset(),j(null),ve.isAxiosError(f)&&f.response){const{status:M,data:S}=f.response;if(M===429){s(n(e,"too_many_requests"));return}if(M===500){s(n(e,"internal_error"));return}if(M===422&&S.code==="validation_error"){const ie=((D=S.errors)==null?void 0:D.email)||[];s(n(e,S.code)),ie.includes("validation.unique")?s(n(e,"email_already_registered")):s(n(e,"validation_error"));return}S.code?s(n(e,S.code)):s(n(e,"generic_error"))}else s(n(e,"network_error"))}};return t.jsxs(t.Fragment,{children:[t.jsx(ue,{title:e("seo.title"),description:e("seo.description")}),t.jsx(ce,{disableCard:!0,children:t.jsxs(u,{component:"form",onSubmit:oe,sx:{maxWidth:400,mx:"auto",mt:{xs:0,sm:1,md:1},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:a=>`1px solid ${a.palette.divider}`},children:[t.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:t.jsx(u,{component:"img",src:pe,alt:e("signup.logoAlt"),sx:{height:150,width:"auto"}})}),t.jsx(v,{variant:"h4",gutterBottom:!0,align:"center",children:e("signup.pageTitle")}),V&&t.jsx(I,{message:V,severity:"error"}),W&&t.jsxs(t.Fragment,{children:[t.jsx(I,{message:W,severity:"success"}),t.jsx(u,{sx:{textAlign:"center",my:2},children:t.jsx(H,{component:L,href:"/login",variant:"outlined",children:e("signup.goToLogin")})})]}),t.jsxs(fe,{spacing:2,children:[t.jsx(_,{required:!0,fullWidth:!0,id:"firstname",label:e("signup.firstnameLabel"),value:d,onChange:a=>T(a.target.value),onBlur:()=>Y(!0),autoComplete:"given-name",error:A,helperText:A?e("errors.firstnameRequired"):""}),t.jsx(_,{required:!0,fullWidth:!0,id:"lastname",label:e("signup.lastnameLabel"),value:p,onChange:a=>C(a.target.value),onBlur:()=>J(!0),autoComplete:"family-name",error:P,helperText:P?e("errors.lastnameRequired"):""}),t.jsx(_,{required:!0,fullWidth:!0,id:"email",label:e("signup.emailLabel"),type:"email",value:g,onChange:a=>E(a.target.value),onBlur:()=>ee(!0),autoComplete:"email",error:R,helperText:R?e("errors.invalidEmail"):""}),t.jsx(Te,{password:h,onPasswordChange:N,confirmPassword:k,onConfirmChange:Q,touched:te,onBlur:()=>re(!0)}),t.jsx(Se,{control:t.jsx(je,{checked:l,onChange:a=>U(a.target.checked)}),label:t.jsxs(v,{variant:"body2",sx:{fontSize:"0.875rem"},children:[e("signup.agreeTOS")," ",t.jsx(L,{href:"/privacy-policy",target:"_blank",underline:"hover",children:e("signup.termsLink")})]})}),t.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:1},children:t.jsx(ge,{ref:w,sitekey:me,size:o?"compact":"normal",theme:m?"dark":"light",hl:i,onChange:j,onExpired:()=>j(null),onErrored:()=>j(null)},y)}),t.jsx(H,{type:"submit",variant:"contained",fullWidth:!0,disabled:b||!x||!l||!B||!q||!se||!ae||!ne,sx:{mt:2},startIcon:b?t.jsx(be,{color:"inherit",size:16}):void 0,children:b?`${e("signup.signupButtonLoad")}â€¦`:e("signup.signupButton")}),!b&&(!x||!l)&&t.jsxs(v,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1,textAlign:"center"},children:[!x&&e("signup.hintCaptchaRequired"),!l&&e("signup.hintMustAgreeTOS")]}),t.jsx(u,{sx:{mt:1,textAlign:"center"},children:t.jsxs(v,{variant:"body2",sx:{fontSize:"0.8rem"},children:[e("signup.alreadyHaveAccount")," ",t.jsx(L,{href:"/login",underline:"hover",variant:"body2",children:e("signup.loginLink")})]})})]})]})})]})}export{De as default};
