import{r as j,j as e}from"./react-C0aVURRx.js";import{q as a,I as C,ac as U,J as W,ad as M,ae as S,t as o,a5 as u,af as B,ag as f,B as _,ah as Q,ab as $,u as L,n as V,ai as H,aj as N,ak as F,al as G}from"./mui-B8Hl5INf.js";import{a as O,u as R,O as J}from"./index-DffXxGKG.js";import{S as X}from"./Seo-D7Cjjq6F.js";import{u as K}from"./useReloadCart-jXnmO71N.js";import{f as w,a as m,u as Y}from"./useCustomSnackbar-B4BtZA1e.js";import{E as z}from"./ErrorDisplay-DB3xkX8n.js";import{u as y}from"./i18n-react-BRaxkKkI.js";import{$ as E}from"./vendor-DjmZx-rl.js";import"./dayjs-DMyafwSS.js";import"./emotion-B2P3BLFp.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./axios-xsH4HHeE.js";import"./cookie-consent-CEVRZwh7.js";import"./helmet-DExn6ifA.js";function T({item:t,adjustQty:r,debounceMs:h=500}){const[x,i]=j.useState(t.quantity.toString()),n=j.useRef(null);j.useEffect(()=>{i(t.quantity.toString())},[t.quantity]),j.useEffect(()=>{if(x==="")return;const g=Number(x);if(!isNaN(g)&&g!==t.quantity)return n.current=window.setTimeout(()=>{let l=g;l<0&&(l=0),l>t.availableQuantity&&(l=t.availableQuantity),r(t,l),i(l.toString()),n.current=null},h),()=>{n.current&&(clearTimeout(n.current),n.current=null)}},[x,t,r,h]);const c=g=>{const l=g.target.value;(l===""||/^[0-9]+$/.test(l))&&i(l)},d=()=>{r(t,Math.min(t.quantity+1,t.availableQuantity))},b=()=>{r(t,Math.max(t.quantity-1,0))};return e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(C,{size:"small",onClick:b,disabled:t.quantity<=0,children:e.jsx(U,{fontSize:"small"})}),e.jsx(W,{type:"text",size:"small",value:x,onChange:c,slotProps:{input:{inputProps:{inputMode:"numeric",pattern:"[0-9]*",style:{textAlign:"center",width:40}}}}}),e.jsx(C,{size:"small",onClick:d,disabled:t.quantity>=t.availableQuantity,children:e.jsx(M,{fontSize:"small"})})]})}function q({item:t,lang:r,adjustQty:h,isMobile:x}){const{t:i}=y("cart"),n=Math.round((t.discountRate??0)*100);return x?e.jsx(S,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle1",sx:{wordBreak:"break-word"},gutterBottom:!0,children:t.name}),e.jsxs(a,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[e.jsx(u,{label:w(t.date,r,{day:"2-digit",month:"2-digit",year:"numeric"}),size:"small"}),t.time&&e.jsx(u,{label:t.time,size:"small"}),e.jsx(u,{label:t.location,size:"small"})]}),e.jsx(u,{label:i("cart.remaining",{count:t.availableQuantity}),size:"small",color:t.availableQuantity>0?"success":"error"})]}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(a,{sx:{textAlign:"center"},children:(t.discountRate??0)>0?e.jsxs(a,{children:[e.jsx(o,{variant:"body2",component:"span",sx:{textDecoration:"line-through",color:"text.secondary",mr:.5},children:m(t.originalPrice??0,r,"EUR")}),e.jsx(o,{variant:"body1",component:"span",sx:{fontWeight:"bold"},children:m(t.price,r,"EUR")}),e.jsx(u,{label:`-${n}%`,size:"small",color:"secondary",sx:{ml:1}})]}):e.jsx(o,{children:m(t.price,r,"EUR")})}),e.jsx(T,{item:t,adjustQty:h}),e.jsx(a,{sx:{textAlign:"right"},children:e.jsx(o,{variant:"body1",children:i("table.total_price",{total:m(t.quantity*t.price,r,"EUR")})})})]})]})},t.id):e.jsxs(B,{sx:{"&:last-child td":{borderBottom:"none"}},children:[e.jsx(f,{sx:{minWidth:200},children:e.jsx(a,{sx:{display:"flex",alignItems:"flex-start"},children:e.jsxs(a,{sx:{flexGrow:1},children:[e.jsx(o,{variant:"subtitle1",component:"div",sx:{wordBreak:"break-word"},children:t.name}),e.jsxs(a,{sx:{mt:.5,display:"flex",flexWrap:"wrap",gap:.5},children:[e.jsx(u,{label:w(t.date,r,{day:"2-digit",month:"2-digit",year:"numeric"}),size:"small"}),t.time&&e.jsx(u,{label:t.time,size:"small"}),e.jsx(u,{label:t.location,size:"small"})]}),e.jsx(a,{sx:{mt:.5},children:e.jsx(u,{label:i("cart.remaining",{count:t.availableQuantity}),size:"small",color:t.availableQuantity>0?"success":"error"})})]})})}),e.jsx(f,{align:"right",sx:{minWidth:120},children:(t.discountRate??0)>0?e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(o,{variant:"body2",component:"span",sx:{textDecoration:"line-through",color:"text.secondary",mr:.5},children:m(t.originalPrice??0,r,"EUR")}),e.jsx(o,{variant:"body1",component:"span",sx:{fontWeight:"bold"},children:m(t.price,r,"EUR")}),e.jsx(u,{label:`-${n}%`,size:"small",color:"secondary",sx:{ml:1}})]}):e.jsx(o,{children:m(t.price,r,"EUR")})}),e.jsx(f,{align:"center",sx:{minWidth:160},children:e.jsx(T,{item:t,adjustQty:h})}),e.jsx(f,{align:"right",sx:{minWidth:120},children:e.jsx(o,{variant:"body1",children:m(t.quantity*t.price,r,"EUR")})})]},t.id)}function Z({total:t,acceptedCGV:r,onCgvChange:h,onPay:x,lang:i,isMobile:n}){const{t:c}=y("cart");return e.jsxs(a,{sx:{mb:3},children:[e.jsx(a,{sx:{textAlign:"right",mb:2},children:e.jsx(o,{variant:"h6",children:c("table.total_price",{total:m(t,i,"EUR")})})}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:0,mb:3},children:[e.jsx(_,{variant:"contained",color:"primary",disabled:!r,onClick:x,children:c("checkout.checkout")}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:0,mt:0},children:[e.jsx(Q,{checked:r,onChange:d=>h(d.target.checked),size:"small"}),e.jsxs(o,{variant:n?"caption":"body2",children:[c("checkout.accept_cgv_prefix")," ",e.jsx($,{sx:{m:0},component:E,to:"/terms",target:"_blank",rel:"noopener noreferrer",children:c(n?"checkout.accept_cgv_link_text_mobile":"checkout.accept_cgv_link_text")})]})]})]}),e.jsx(a,{sx:{textAlign:"right",mt:n?6:10},children:e.jsx(_,{component:E,to:"/tickets",variant:"outlined",size:"small",children:c("checkout.continue_shopping")})})]})}function je(){const{t}=y(["cart","common"]),r=O(s=>s.lang),{loading:h,hasError:x,reload:i}=K(),n=R(s=>s.items),c=R.getState().addItem,{notify:d}=Y(),[b,g]=j.useState(!1),l=j.useMemo(()=>n.reduce((s,p)=>s+p.quantity*p.price,0),[n]);j.useEffect(()=>{i()},[i,r]);const I=L(),v=V(I.breakpoints.down("sm")),k=j.useCallback(async(s,p)=>{if(p<0&&(p=0),p>s.availableQuantity){d(t("cart:cart.not_enough_stock",{count:s.availableQuantity}),"warning");return}try{await c(s.id,p,s.availableQuantity),p>s.quantity?d(t("cart:cart.add_success"),"success"):p<s.quantity?d(t("cart:cart.remove_success"),"success"):d(t("cart:cart.update_success"),"info")}catch{d(t("cart:errors.error_update"),"error")}},[c,d,t]),A=()=>{d(t("cart:checkout_not_implemented"),"info")};if(h)return e.jsx(a,{sx:{textAlign:"center",py:4},children:e.jsx(J,{})});if(x)return e.jsx(z,{title:t("cart:errors.error_loading"),message:t("cart:errors.error_loading_message"),showRetry:!0,retryButtonText:t("common:errors.retry"),onRetry:i,showHome:!0,homeButtonText:t("common:errors.home")});if(n.length===0)return e.jsx(z,{title:t("cart:cart.empty"),message:t("cart:errors.empty_message"),showRetry:!1,showHome:!0,homeButtonText:t("common:errors.home")});const D=()=>e.jsx(H,{component:S,sx:{mb:3,overflowX:"auto",border:"1px solid",borderColor:"divider",borderRadius:1},children:e.jsxs(N,{children:[e.jsx(F,{children:e.jsxs(B,{children:[e.jsx(f,{children:t("cart:table.product")}),e.jsx(f,{align:"right",children:t("cart:table.unit_price")}),e.jsx(f,{align:"center",children:t("cart:table.quantity")}),e.jsx(f,{align:"right",children:t("cart:cart.total")})]})}),e.jsx(G,{children:n.map(s=>e.jsx(q,{item:s,lang:r,adjustQty:k,isMobile:!1},s.id))})]})}),P=()=>e.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:n.map(s=>e.jsx(q,{item:s,lang:r,adjustQty:k,isMobile:!0},s.id))});return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:t("cart:seo.title"),description:t("cart:seo.description")}),e.jsxs(a,{sx:{p:{xs:2,md:4}},children:[e.jsx(o,{variant:"h4",gutterBottom:!0,children:t("cart:cart.title")}),v?P():D(),e.jsx(Z,{total:l,acceptedCGV:b,onCgvChange:s=>g(s),onPay:A,lang:r,isMobile:v})]})]})}export{je as default};
