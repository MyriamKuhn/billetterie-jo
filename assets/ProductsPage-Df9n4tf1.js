import{j as t,r as p}from"./react-C0aVURRx.js";import{A as C,u as v,O as A,a as z,P as E,S as F}from"./index-CY5QxFiC.js";import{P as O}from"./ProductsFilters-Cok8Lvlk.js";import{u as b}from"./i18n-react-DKLIrUu3.js";import{q as m,y as U,U as H,V as Q,v as d,W as T,B as w,X as S,Y as I,_ as V,$ as G,a0 as J}from"./mui-CUyLNCSY.js";import{a as B}from"./axios-Dq7h7Pqt.js";import{u as X}from"./useProductDetails-DbU5D4k4.js";import{E as $}from"./ErrorDisplay-CqpRduDy.js";import{f as q,a as M}from"./format-_gz818Hm.js";import{u as Y}from"./useCustomSnackbar-Cbu9vsWE.js";import"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./vendor-DdBxgcTm.js";import"./i18n-Bhc83OLH.js";import"./emotion-3DDxC2qG.js";import"./helmet-D-y5f56R.js";import"./cookie-consent-h1U6JL3J.js";import"./FilterField-pDWxjenY.js";import"./FilterSelect-BlR2P65X.js";import"./FilterRadios-CXY-oyuw.js";import"./SortControl-Cbk5ScMT.js";const W="/assets/placeholder-CcHesTJP.png";function K({product:e,fmtCur:n,fmtDate:l,onViewDetails:u,onBuy:o}){const{t:r}=b(["common","ticket"]),c=e.stock_quantity===0,a=e.price*(1-e.sale);return t.jsx(m,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:t.jsxs(U,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[t.jsx(H,{component:"img",image:e.product_details.image?`${C}/products/images/${e.product_details.image}`:W,alt:e.name,loading:"lazy",sx:{width:{xs:"100%",md:320},height:180,objectFit:"cover",alignSelf:{xs:"auto",md:"center"}}}),t.jsxs(Q,{sx:{flexGrow:1},children:[t.jsx(d,{variant:"h6",children:e.name}),t.jsxs(d,{variant:"body2",children:[l(e.product_details.date),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.product_details.location}),t.jsx(d,{variant:"body2",color:"text.secondary",children:r("ticket:tickets.places",{count:e.product_details.places})}),t.jsxs(m,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[e.sale>0&&t.jsx(d,{variant:"body2",sx:{textDecoration:"line-through"},children:n(e.price)}),t.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:n(a)}),e.sale>0&&t.jsx(T,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]}),t.jsx(d,{variant:"body2",color:c?"error.main":"text.secondary",sx:{mt:1},children:c?r("ticket:tickets.out_of_stock"):r("ticket:tickets.available",{count:e.stock_quantity})})]}),t.jsxs(m,{sx:{display:"flex",flexDirection:{xs:"row",md:"column"},justifyContent:"center",alignItems:"center",gap:1,"& .MuiButton-root":{whiteSpace:"nowrap"}},children:[t.jsx(w,{size:"small",variant:"outlined",onClick:()=>u(e.id),children:r("ticket:tickets.more_info")}),t.jsx(w,{size:"small",variant:"contained",disabled:c,onClick:o,children:r(c?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})})}function N({products:e,fmtCur:n,fmtDate:l,onViewDetails:u,onBuy:o}){const{t:r}=b("ticket");return e.length===0?t.jsx(d,{variant:"h4",sx:{textAlign:"center"},children:r("tickets.not_found")}):t.jsx(m,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:e.map(c=>t.jsx(K,{product:c,fmtCur:n,fmtDate:l,onViewDetails:u,onBuy:()=>o(c)},c.id))})}function Z(e,n){const[l,u]=p.useState([]),[o,r]=p.useState(0),[c,a]=p.useState(!1),[f,j]=p.useState(null),[x,h]=p.useState(null);return p.useEffect(()=>{a(!0),j(null),h(null);const g={name:"name",price:"price",date:"product_details->date"}[e.sortBy],_={per_page:Math.max(1,e.perPage),page:e.page,sort_by:g,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};B.get(`${C}/api/products`,{params:_,headers:{"Accept-Language":n}}).then(s=>{u(s.data.data),r(s.data.pagination.total)}).catch(s=>{var i;if(B.isAxiosError(s)){const y=(i=s.response)==null?void 0:i.status;if(y===422){h(s.response.data.errors);return}if(y===404){u([]),r(0);return}}j(s.code)}).finally(()=>a(!1))},[e,n]),{products:l,total:o,loading:c,error:f,validationErrors:x}}function L(){const e=v.getState().addItem,{notify:n}=Y(),{t:l}=b("cart");return async(u,o,r)=>{try{return v.getState().isLocked?(n(l("errors.cart_locked"),"warning"),!1):(await e(u,o,r),n(l("cart.add_success"),"success"),!0)}catch(c){return c.message.includes("exceeds")?n(l("cart.not_enough_stock",{count:r}),"warning"):n(l("errors.error_update"),"error"),!1}}}function tt({open:e,productId:n,lang:l,onClose:u}){const{t:o}=b(["ticket","cart"]),r=v(i=>i.items),c=L(),{product:a,loading:f,error:j}=X(e?n:null,l),x="product-title";if(f)return t.jsx(S,{open:e,onClose:u,children:t.jsx(I,{sx:{textAlign:"center",py:4},children:t.jsx(A,{})})});if(j||!a)return t.jsx(S,{open:e,onClose:u,children:t.jsx($,{title:o("ticket:errors.title"),message:o("ticket:errors.not_found"),showRetry:!1,showHome:!1})});const h=i=>M(i,l,"EUR"),k=q(a.product_details.date,l),g=a.stock_quantity===0,_=a.price*(1-a.sale),s=async()=>{const i=r.find(D=>D.id===a.id.toString()),y=((i==null?void 0:i.quantity)??0)+1;await c(a.id.toString(),y,a.stock_quantity)&&u()};return t.jsxs(S,{open:e,onClose:u,maxWidth:"sm",fullWidth:!0,"aria-labelledby":x,children:[t.jsx(V,{id:x,children:a.name}),t.jsx(I,{dividers:!0,children:a&&t.jsxs(m,{component:"div",children:[t.jsx(m,{component:"img",src:a.product_details.image?`${C}/products/images/${a.product_details.image}`:W,alt:a.name,loading:"lazy",sx:{width:"100%",height:200,objectFit:"cover",mb:2}}),t.jsxs(d,{variant:"body1",children:[k,a.product_details.time&&` – ${a.product_details.time}`]}),t.jsx(d,{variant:"body1",color:"text.secondary",sx:{mb:1},children:a.product_details.location}),t.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:1},children:o("tickets.category",{category:a.product_details.category})}),t.jsx(d,{variant:"body2",sx:{mb:1},children:a.product_details.description}),t.jsx(d,{variant:"body1",color:"text.secondary",children:o("ticket:tickets.places",{count:a.product_details.places})}),t.jsxs(m,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[a.sale>0&&t.jsx(d,{variant:"body2",sx:{textDecoration:"line-through"},children:h(a.price)}),t.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:h(_)}),a.sale>0&&t.jsx(T,{label:`–${Math.round(a.sale*100)}%`,size:"small"})]}),t.jsx(d,{variant:"body2",color:g?"error.main":"text.secondary",sx:{mt:1},children:g?o("ticket:tickets.out_of_stock"):o("ticket:tickets.available",{count:a.stock_quantity})})]})}),t.jsxs(G,{children:[t.jsx(w,{onClick:u,children:o("ticket:tickets.close")}),t.jsx(w,{variant:"contained",onClick:s,disabled:g,children:o(g?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})}function bt(){const{t:e}=b("ticket"),n=z(s=>s.lang),l=v(s=>s.items),u=L(),[o,r]=p.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:c,total:a,loading:f,error:j,validationErrors:x}=Z(o,n),[h,k]=p.useState(null);p.useEffect(()=>{if(x){const s={};x.sort_by&&(s.sortBy="name",s.order="asc"),x.date&&(s.date=""),x.name&&(s.name=""),x.category&&(s.category=""),x.location&&(s.location=""),x.places&&(s.places=0),r(i=>({...i,...s}))}},[x]);const g=s=>M(s,n,"EUR"),_=s=>q(s,n);return j?t.jsx(E,{children:t.jsx($,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>r(s=>({...s})),showHome:!0,homeButtonText:e("errors.home")})}):t.jsxs(t.Fragment,{children:[t.jsx(F,{title:e("tickets.seo_title"),description:e("tickets.seo_description")}),t.jsxs(E,{disableCard:!0,children:[t.jsx(d,{variant:"h4",sx:{px:2},children:e("tickets.title")}),t.jsxs(m,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(O,{filters:o,onChange:s=>r(i=>({...i,...s}))}),t.jsxs(m,{component:"main",flex:1,children:[f?t.jsx(m,{textAlign:"center",py:8,children:t.jsx(A,{})}):t.jsx(N,{products:c,fmtCur:g,fmtDate:_,onViewDetails:k,onBuy:async s=>{const i=l.find(R=>R.id===s.id.toString()),P=((i==null?void 0:i.quantity)??0)+1;await u(s.id.toString(),P,s.stock_quantity)&&k(null)}}),!f&&c.length>0&&t.jsx(m,{textAlign:"center",mt:4,children:t.jsx(J,{count:Math.ceil(a/o.perPage)||1,page:o.page,onChange:(s,i)=>r(y=>({...y,page:i}))})})]})]})]}),t.jsx(tt,{open:h!==null,productId:h,lang:n,onClose:()=>k(null)})]})}export{bt as default};
