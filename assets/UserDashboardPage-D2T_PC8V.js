import{r as c,j as e}from"./react-C0aVURRx.js";import{b as E,S as f,O as y,P as x}from"./index-q-ZiXizB.js";import{a as w}from"./axios-xsH4HHeE.js";import{N as S,E as U,P as T,T as A,f as F}from"./TwoFASection-DuTVZT5C.js";import{g}from"./AlertMessage-xi8xQYBK.js";import{E as P}from"./ErrorDisplay-Cpov-QS1.js";import{u as B}from"./i18n-react-CHYEX_9Z.js";import{q as h,t as j,N as k}from"./mui-CW5KTKiM.js";import{U as N}from"./vendor-1UMx7qFY.js";import"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-BKoPsIBf.js";import"./helmet-DqAb31yQ.js";import"./cookie-consent-DYVQHhqE.js";import"./validation-491qobvS.js";import"./PasswordWithConfirmation-BS2Y6Jv1.js";function X(){const{t:r}=B("userDashboard"),u=E(t=>t.authToken),[l,a]=c.useState(null),[b,d]=c.useState(!0),[p,m]=c.useState(null);return c.useEffect(()=>{if(!u){a(null),d(!1);return}const t=new AbortController,s=t.signal;return(async()=>{d(!0),m(null);try{const n=await F(u,{signal:s});if(s.aborted)return;const{status:i,data:o}=n;i===200&&o.user?a({firstname:o.user.firstname,lastname:o.user.lastname,email:o.user.email,twoFAEnabled:o.user.twofa_enabled}):m(r("errors.fetchProfile"))}catch(n){if(s.aborted)return;if(w.isAxiosError(n)&&n.response){const i=n.response.data,o=i==null?void 0:i.code;m(g(r,o??"generic_error"))}else m(g(r,"network_error"))}finally{s.aborted||d(!1)}})(),()=>{t.abort()}},[u,r]),b?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:r("seo.title"),description:r("seo.description")}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(y,{})})]}):p?e.jsx(x,{children:e.jsx(P,{title:r("errors.genericErrorTitle"),message:p,showRetry:!0,retryButtonText:r("errors.retry"),onRetry:()=>{window.location.reload()},showHome:!0,homeButtonText:r("errors.home")})}):l?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:r("seo.title"),description:r("seo.description")}),e.jsx(x,{children:e.jsxs(h,{sx:{maxWidth:600,mx:"auto",mt:4,mb:4},children:[e.jsx(j,{variant:"h4",gutterBottom:!0,align:"center",children:r("dashboard.title")}),e.jsx(j,{variant:"body1",gutterBottom:!0,align:"center",sx:{mb:4},children:r("dashboard.subtitle")}),e.jsxs(k,{spacing:2,children:[e.jsx(S,{user:l,onUpdate:t=>a(s=>({...s,...t}))}),e.jsx(U,{currentEmail:l.email,onUpdate:t=>a(s=>({...s,email:t}))}),e.jsx(T,{}),e.jsx(A,{enabled:l.twoFAEnabled,onToggle:t=>a(s=>({...s,twoFAEnabled:t}))})]})]})})]}):e.jsx(N,{to:"/login",replace:!0})}export{X as default};
