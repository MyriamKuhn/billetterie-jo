import{j as t,r as g}from"./react-C0aVURRx.js";import{A as C,u as I,O as T,a as Y,S as H}from"./index-BUXUlOD7.js";import{J as Q,N as B,O as J,j as N,M as X,Q as W,U as K,V as Z,W as V,q as h,X as z,Y as P,_ as tt,$ as et,u as st,t as m,G as at,a0 as rt,B as v,I as A,p as ot,r as nt,a1 as it,a2 as lt,a3 as ct,a4 as dt,a5 as $,a6 as w,a7 as M,a8 as ut,a9 as xt,aa as mt}from"./mui-Bv5YL-XP.js";import{d as pt}from"./dayjs-DMyafwSS.js";import{u as b}from"./i18n-react-DsoMXUU6.js";import{a as S}from"./axios-xsH4HHeE.js";import{P as ht}from"./PageWrapper-BZs1h3P6.js";import{E as L}from"./ErrorDisplay-qj7bh5TT.js";import{f as R,a as q}from"./format-BP4WpB1S.js";import{u as gt}from"./useCustomSnackbar-CsToXno5.js";import"./zustand-DgaMZn_z.js";import"./vendor-CluA6s6b.js";import"./i18n-Bhc83OLH.js";import"./emotion-BXBuUsh5.js";import"./helmet-BXAee230.js";import"./cookie-consent-Eepg6n4_.js";function D({label:e,value:o,onChange:s,type:c}){return t.jsx(Q,{label:e,type:c,size:"small",fullWidth:!0,value:o,onChange:a=>s(a.target.value),slotProps:{inputLabel:{shrink:!0}}})}function ft({label:e,value:o,options:s,onChange:c}){return t.jsxs(B,{size:"small",fullWidth:!0,children:[t.jsx(J,{children:e}),t.jsx(N,{label:e,value:o,onChange:a=>c(a.target.value),children:s.map(a=>t.jsx(X,{value:a,children:a},a))})]})}function jt({legend:e,value:o,options:s,onChange:c}){return t.jsxs(B,{component:"fieldset",children:[t.jsx(W,{component:"legend",children:e}),t.jsx(K,{row:!0,value:o,onChange:(a,i)=>c(i),children:s.map(a=>t.jsx(Z,{value:a.value,control:t.jsx(V,{size:"small"}),label:a.label},a.value))})]})}function yt({fields:e,sortBy:o,order:s,onSortChange:c,label:a}){const{t:i}=b(),d=(n,x)=>{x&&c(x,s)},r=(n,x)=>{x&&c(o,x)};return t.jsxs(B,{component:"fieldset",fullWidth:!0,children:[t.jsx(W,{component:"legend",sx:{mb:1},children:a}),t.jsxs(h,{sx:{display:"flex",gap:1},children:[t.jsx(z,{value:o,exclusive:!0,size:"small",onChange:d,"aria-label":i("sorting.title"),sx:{flex:1},children:e.map(({value:n,label:x})=>t.jsx(P,{value:n,"aria-label":String(n),children:x},n))}),t.jsxs(z,{value:s,exclusive:!0,size:"small",onChange:r,"aria-label":i("sorting.order"),children:[t.jsx(P,{value:"asc","aria-label":i("sorting.ascendant"),children:t.jsx(tt,{fontSize:"small"})}),t.jsx(P,{value:"desc","aria-label":i("sorting.descendant"),children:t.jsx(et,{fontSize:"small"})})]})]})]})}function bt({filters:e,onChange:o}){const{t:s}=b("ticket"),c=st(),[a,i]=g.useState(!1),d=[{value:"name",label:s("filters.name")},{value:"price",label:s("filters.price")},{value:"date",label:s("filters.date")}],r=t.jsxs(h,{sx:{width:260,py:2,px:1},children:[t.jsx(m,{variant:"h6",gutterBottom:!0,children:s("filters.title")}),t.jsxs(at,{spacing:2,sx:{mx:1},children:[t.jsx(D,{label:s("filters.name"),value:e.name,onChange:n=>o({name:n,page:1})}),t.jsx(D,{label:s("filters.category"),value:e.category,onChange:n=>o({category:n,page:1})}),t.jsx(D,{label:s("filters.location"),value:e.location,onChange:n=>o({location:n,page:1})}),t.jsx(rt,{label:s("filters.date"),value:e.date?pt(e.date):null,onChange:n=>o({date:(n==null?void 0:n.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(jt,{legend:s("filters.places"),value:e.places.toString(),options:[{value:"0",label:s("filters.all_places")},{value:"1",label:s("filters.one_place")},{value:"2",label:s("filters.two_places")},{value:"4",label:s("filters.four_places")}],onChange:n=>o({places:Number(n),page:1})}),t.jsx(yt,{fields:d,sortBy:e.sortBy,order:e.order,onSortChange:(n,x)=>o({sortBy:n,order:x,page:1}),label:s("filters.sort_by")}),t.jsx(ft,{label:s("filters.offers_per_page"),value:e.perPage,options:[1,5,10,15,25,50,100],onChange:n=>o({perPage:n,page:1})}),t.jsx(v,{variant:"outlined",fullWidth:!0,onClick:()=>o({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),children:s("filters.reset")})]})]});return t.jsxs(t.Fragment,{children:[t.jsx(h,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:c.mixins.toolbar.minHeight,bgcolor:"background.paper",border:n=>`1px solid ${n.palette.divider}`,borderRadius:1,width:260},children:r}),t.jsxs(h,{sx:{display:{xs:"block",md:"none"},mb:2},children:[t.jsx(A,{onClick:()=>i(!0),"aria-label":s("filters.title"),children:t.jsx(ot,{})}),t.jsx(nt,{open:a,onClose:()=>i(!1),keepMounted:!0,children:t.jsxs(h,{sx:{position:"relative"},children:[t.jsx(A,{onClick:()=>i(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":s("filters.close"),children:t.jsx(it,{})}),r]})})]})]})}const O="/assets/placeholder-CcHesTJP.png";function kt({product:e,fmtCur:o,fmtDate:s,onViewDetails:c,onBuy:a}){const{t:i}=b(["common","ticket"]),d=e.stock_quantity===0,r=e.price*(1-e.sale);return t.jsx(h,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:t.jsxs(lt,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[t.jsx(ct,{component:"img",image:e.product_details.image?`${C}/products/images/${e.product_details.image}`:O,alt:e.name,loading:"lazy",sx:{width:{xs:"100%",md:320},height:180,objectFit:"cover",alignSelf:{xs:"auto",md:"center"}}}),t.jsxs(dt,{sx:{flexGrow:1},children:[t.jsx(m,{variant:"h6",children:e.name}),t.jsxs(m,{variant:"body2",children:[s(e.product_details.date),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.product_details.location}),t.jsx(m,{variant:"body2",color:"text.secondary",children:i("ticket:tickets.places",{count:e.product_details.places})}),t.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[e.sale>0&&t.jsx(m,{variant:"body2",sx:{textDecoration:"line-through"},children:o(e.price)}),t.jsx(m,{variant:"subtitle1",fontWeight:"bold",children:o(r)}),e.sale>0&&t.jsx($,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]}),t.jsx(m,{variant:"body2",color:d?"error.main":"text.secondary",sx:{mt:1},children:d?i("ticket:tickets.out_of_stock"):i("ticket:tickets.available",{count:e.stock_quantity})})]}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"row",md:"column"},justifyContent:"center",alignItems:"center",gap:1,"& .MuiButton-root":{whiteSpace:"nowrap"}},children:[t.jsx(v,{size:"small",variant:"outlined",onClick:()=>c(e.id),children:i("ticket:tickets.more_info")}),t.jsx(v,{size:"small",variant:"contained",disabled:d,onClick:a,children:i(d?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})})}function _t({products:e,fmtCur:o,fmtDate:s,onViewDetails:c,onBuy:a}){const{t:i}=b("ticket");return e.length===0?t.jsx(m,{variant:"h4",sx:{textAlign:"center"},children:i("tickets.not_found")}):t.jsx(h,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:e.map(d=>t.jsx(kt,{product:d,fmtCur:o,fmtDate:s,onViewDetails:c,onBuy:()=>a(d)},d.id))})}function vt(e,o){const[s,c]=g.useState([]),[a,i]=g.useState(0),[d,r]=g.useState(!1),[n,x]=g.useState(null),[p,f]=g.useState(null);return g.useEffect(()=>{r(!0),x(null),f(null);const j={name:"name",price:"price",date:"product_details->date"}[e.sortBy],_={per_page:Math.max(1,e.perPage),page:e.page,sort_by:j,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};S.get(`${C}/api/products`,{params:_,headers:{"Accept-Language":o}}).then(l=>{c(l.data.data),i(l.data.pagination.total)}).catch(l=>{var u;if(S.isAxiosError(l)){const y=(u=l.response)==null?void 0:u.status;if(y===422){f(l.response.data.errors);return}if(y===404){c([]),i(0);return}}x(l.code)}).finally(()=>r(!1))},[e,o]),{products:s,total:a,loading:d,error:n,validationErrors:p}}function St(e,o){const[s,c]=g.useState(null),[a,i]=g.useState(!1),[d,r]=g.useState(null);return g.useEffect(()=>{if(e==null){c(null),r(null),i(!1);return}i(!0),r(null),c(null),S.get(`${C}/api/products/${e}`,{headers:{"Accept-Language":o}}).then(n=>{c(n.data.data)}).catch(n=>{var p,f;const x=S.isAxiosError(n)&&((f=(p=n.response)==null?void 0:p.data)!=null&&f.message)?n.response.data.message:n.message;r(x)}).finally(()=>{i(!1)})},[e,o]),{product:s,loading:a,error:d}}function G(){const e=I.getState().addItem,{notify:o}=gt(),{t:s}=b("cart");return async(c,a,i)=>{try{return await e(c,a,i),o(s("cart.add_success"),"success"),!0}catch(d){return d.message.includes("exceeds")?o(s("cart.not_enough_stock",{count:i}),"warning"):o(s("errors.error_update"),"error"),!1}}}function Ct({open:e,productId:o,lang:s,onClose:c}){const{t:a}=b(["ticket","cart"]),i=I(u=>u.items),d=G(),{product:r,loading:n,error:x}=St(e?o:null,s),p="product-title";if(n)return t.jsx(w,{open:e,onClose:c,children:t.jsx(M,{sx:{textAlign:"center",py:4},children:t.jsx(T,{})})});if(x||!r)return t.jsx(w,{open:e,onClose:c,children:t.jsx(L,{title:a("ticket:errors.title"),message:a("ticket:errors.not_found"),showRetry:!1,showHome:!1})});const f=u=>q(u,s,"EUR"),k=R(r.product_details.date,s),j=r.stock_quantity===0,_=r.price*(1-r.sale),l=async()=>{const u=i.find(F=>F.id===r.id.toString()),y=((u==null?void 0:u.quantity)??0)+1;await d(r.id.toString(),y,r.stock_quantity)&&c()};return t.jsxs(w,{open:e,onClose:c,maxWidth:"sm",fullWidth:!0,"aria-labelledby":p,children:[t.jsx(ut,{id:p,children:r.name}),t.jsx(M,{dividers:!0,children:r&&t.jsxs(h,{component:"div",children:[t.jsx(h,{component:"img",src:r.product_details.image?`${C}/products/images/${r.product_details.image}`:O,alt:r.name,loading:"lazy",sx:{width:"100%",height:200,objectFit:"cover",mb:2}}),t.jsxs(m,{variant:"body1",children:[k,r.product_details.time&&` – ${r.product_details.time}`]}),t.jsx(m,{variant:"body1",color:"text.secondary",sx:{mb:1},children:r.product_details.location}),t.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1},children:a("tickets.category",{category:r.product_details.category})}),t.jsx(m,{variant:"body2",sx:{mb:1},children:r.product_details.description}),t.jsx(m,{variant:"body1",color:"text.secondary",children:a("ticket:tickets.places",{count:r.product_details.places})}),t.jsxs(h,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[r.sale>0&&t.jsx(m,{variant:"body2",sx:{textDecoration:"line-through"},children:f(r.price)}),t.jsx(m,{variant:"subtitle1",fontWeight:"bold",children:f(_)}),r.sale>0&&t.jsx($,{label:`–${Math.round(r.sale*100)}%`,size:"small"})]}),t.jsx(m,{variant:"body2",color:j?"error.main":"text.secondary",sx:{mt:1},children:j?a("ticket:tickets.out_of_stock"):a("ticket:tickets.available",{count:r.stock_quantity})})]})}),t.jsxs(xt,{children:[t.jsx(v,{onClick:c,children:a("ticket:tickets.close")}),t.jsx(v,{variant:"contained",onClick:l,disabled:j,children:a(j?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})}function Ot(){const{t:e}=b("ticket"),o=Y(l=>l.lang),s=I(l=>l.items),c=G(),[a,i]=g.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:d,total:r,loading:n,error:x,validationErrors:p}=vt(a,o),[f,k]=g.useState(null);g.useEffect(()=>{if(p){const l={};p.sort_by&&(l.sortBy="name",l.order="asc"),p.date&&(l.date=""),p.name&&(l.name=""),p.category&&(l.category=""),p.location&&(l.location=""),p.places&&(l.places=0),i(u=>({...u,...l}))}},[p]);const j=l=>q(l,o,"EUR"),_=l=>R(l,o);return x?t.jsx(L,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>i(l=>({...l})),showHome:!0,homeButtonText:e("errors.home")}):t.jsxs(t.Fragment,{children:[t.jsx(H,{title:e("tickets.seo_title"),description:e("tickets.seo_description")}),t.jsxs(ht,{disableCard:!0,children:[t.jsx(m,{variant:"h4",sx:{px:2},children:e("tickets.title")}),t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(bt,{filters:a,onChange:l=>i(u=>({...u,...l}))}),t.jsxs(h,{component:"main",flex:1,children:[n?t.jsx(h,{textAlign:"center",py:8,children:t.jsx(T,{})}):t.jsx(_t,{products:d,fmtCur:j,fmtDate:_,onViewDetails:k,onBuy:async l=>{const u=s.find(U=>U.id===l.id.toString()),E=((u==null?void 0:u.quantity)??0)+1;await c(l.id.toString(),E,l.stock_quantity)&&k(null)}}),!n&&d.length>0&&t.jsx(h,{textAlign:"center",mt:4,children:t.jsx(mt,{count:Math.ceil(r/a.perPage)||1,page:a.page,onChange:(l,u)=>i(y=>({...y,page:u}))})})]})]})]}),t.jsx(Ct,{open:f!==null,productId:f,lang:o,onClose:()=>k(null)})]})}export{Ot as default};
