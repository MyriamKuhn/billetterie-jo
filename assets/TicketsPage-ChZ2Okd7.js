import{j as e,a as p}from"./react-AdBSR0xm.js";import{O as F,u as R}from"./index-C2FUFO80.js";import{S as T}from"./Seo-DWIcSNlv.js";import{A as L,b as $,M as U,C as q}from"./mui-icons-BrhLzDp9.js";import{ay as O,ao as Y}from"./vendor-Lrl0jC2L.js";import{i as G,h as S,I as N,S as H,M as Q,R as E,U as X,V as J,W as K,w as x,X as D,Y as _,l as Z,T as c,Q as V,B as y,k as B,y as ee,_ as te,$ as se,a0 as ae,C as I,n as re,a1 as oe,p as ne,D as ie,a2 as le}from"./mui-core-D1K4sBmA.js";import{u as b}from"./i18n-react-C7D2tZYK.js";import{a as k}from"./axios-xsH4HHeE.js";import{P as ce}from"./PageWrapper-BN-22R6Y.js";import"./helmet-Dw0XBPOz.js";import"./i18n-core-Bqx5x-IT.js";import"./zustand-fLAFRd69.js";function C({label:t,value:n,onChange:a,type:i}){return e.jsx(G,{label:t,type:i,size:"small",fullWidth:!0,value:n,onChange:r=>a(r.target.value),slotProps:{inputLabel:{shrink:!0}}})}function de({label:t,value:n,options:a,onChange:i}){return e.jsxs(S,{size:"small",fullWidth:!0,children:[e.jsx(N,{children:t}),e.jsx(H,{label:t,value:n,onChange:r=>i(r.target.value),children:a.map(r=>e.jsx(Q,{value:r,children:r},r))})]})}function ue({legend:t,value:n,options:a,onChange:i}){return e.jsxs(S,{component:"fieldset",children:[e.jsx(E,{component:"legend",children:t}),e.jsx(X,{row:!0,value:n,onChange:(r,s)=>i(s),children:a.map(r=>e.jsx(J,{value:r.value,control:e.jsx(K,{size:"small"}),label:r.label},r.value))})]})}function xe({fields:t,sortBy:n,order:a,onSortChange:i,label:r}){const{t:s}=b(),u=(o,d)=>{d&&i(d,a)},m=(o,d)=>{d&&i(n,d)};return e.jsxs(S,{component:"fieldset",fullWidth:!0,children:[e.jsx(E,{component:"legend",sx:{mb:1},children:r}),e.jsxs(x,{sx:{display:"flex",gap:1},children:[e.jsx(D,{value:n,exclusive:!0,size:"small",onChange:u,"aria-label":s("sorting.title"),sx:{flex:1},children:t.map(({value:o,label:d})=>e.jsx(_,{value:o,"aria-label":String(o),children:d},o))}),e.jsxs(D,{value:a,exclusive:!0,size:"small",onChange:m,"aria-label":s("sorting.order"),children:[e.jsx(_,{value:"asc","aria-label":s("sorting.ascendant"),children:e.jsx(L,{fontSize:"small"})}),e.jsx(_,{value:"desc","aria-label":s("sorting.descendant"),children:e.jsx($,{fontSize:"small"})})]})]})]})}function me({filters:t,onChange:n}){const{t:a}=b("ticket"),i=Z(),[r,s]=p.useState(!1),u=[{value:"name",label:a("filters.name")},{value:"price",label:a("filters.price")},{value:"date",label:a("filters.date")}],m=e.jsxs(x,{sx:{width:260,py:2,px:1},children:[e.jsx(c,{variant:"h6",gutterBottom:!0,children:a("filters.title")}),e.jsxs(V,{spacing:2,sx:{mx:1},children:[e.jsx(C,{label:a("filters.name"),value:t.name,onChange:o=>n({name:o,page:1})}),e.jsx(C,{label:a("filters.category"),value:t.category,onChange:o=>n({category:o,page:1})}),e.jsx(C,{label:a("filters.location"),value:t.location,onChange:o=>n({location:o,page:1})}),e.jsx(O,{label:a("filters.date"),value:t.date?Y(t.date):null,onChange:o=>n({date:(o==null?void 0:o.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),e.jsx(ue,{legend:a("filters.places"),value:t.places.toString(),options:[{value:"0",label:a("filters.all_places")},{value:"1",label:a("filters.one_place")},{value:"2",label:a("filters.two_places")},{value:"4",label:a("filters.four_places")}],onChange:o=>n({places:Number(o),page:1})}),e.jsx(xe,{fields:u,sortBy:t.sortBy,order:t.order,onSortChange:(o,d)=>n({sortBy:o,order:d,page:1}),label:a("filters.sort_by")}),e.jsx(de,{label:a("filters.offers_per_page"),value:t.perPage,options:[1,5,10,15,25,50,100],onChange:o=>n({perPage:o,page:1})}),e.jsx(y,{variant:"outlined",fullWidth:!0,onClick:()=>n({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),children:a("filters.reset")})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(x,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:i.mixins.toolbar.minHeight,bgcolor:"background.paper",border:o=>`1px solid ${o.palette.divider}`,borderRadius:1,width:260},children:m}),e.jsxs(x,{sx:{display:{xs:"block",md:"none"},mb:2},children:[e.jsx(B,{onClick:()=>s(!0),"aria-label":a("filters.title"),children:e.jsx(U,{})}),e.jsx(ee,{open:r,onClose:()=>s(!1),keepMounted:!0,children:e.jsxs(x,{sx:{position:"relative"},children:[e.jsx(B,{onClick:()=>s(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":a("filters.close"),children:e.jsx(q,{})}),m]})})]})]})}function pe({product:t,fmtCur:n,fmtDate:a,onViewDetails:i}){const{t:r}=b(["common","ticket"]),s=t.stock_quantity===0,u=t.price*(1-t.sale);return e.jsx(x,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:e.jsxs(te,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[e.jsx(se,{component:"img",image:t.product_details.image,alt:t.name,loading:"lazy",sx:{width:{xs:"100%",md:320},height:180,objectFit:"cover",alignSelf:{xs:"auto",md:"center"}}}),e.jsxs(ae,{sx:{flexGrow:1},children:[e.jsx(c,{variant:"h6",children:t.name}),e.jsxs(c,{variant:"body2",children:[a(t.product_details.date),t.product_details.time&&` – ${t.product_details.time}`]}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t.product_details.location}),e.jsx(c,{variant:"body2",color:"text.secondary",children:r("ticket:tickets.places",{count:t.product_details.places})}),e.jsxs(x,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[t.sale>0&&e.jsx(c,{variant:"body2",sx:{textDecoration:"line-through"},children:n(t.price)}),e.jsx(c,{variant:"subtitle1",fontWeight:"bold",children:n(u)}),t.sale>0&&e.jsx(I,{label:`–${Math.round(t.sale*100)}%`,size:"small"})]}),e.jsx(c,{variant:"body2",color:s?"error.main":"text.secondary",sx:{mt:1},children:s?r("ticket:tickets.out_of_stock"):r("ticket:tickets.available",{count:t.stock_quantity})})]}),e.jsxs(x,{sx:{display:"flex",flexDirection:{xs:"row",md:"column"},justifyContent:"center",alignItems:"center",gap:1,"& .MuiButton-root":{whiteSpace:"nowrap"}},children:[e.jsx(y,{size:"small",variant:"outlined",onClick:()=>i(t.id),children:r("ticket:tickets.more_info")}),e.jsx(y,{size:"small",variant:"contained",disabled:s,href:`/tickets/${t.id}`,children:r(s?"ticket:tickets.out_of_stock":"ticket:tickets.buy")})]})]})})}function he({products:t,fmtCur:n,fmtDate:a,onViewDetails:i}){const{t:r}=b("ticket");return t.length===0?e.jsx(c,{variant:"h4",sx:{textAlign:"center"},children:r("tickets.not_found")}):e.jsx(x,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:t.map(s=>e.jsx(pe,{product:s,fmtCur:n,fmtDate:a,onViewDetails:i},s.id))})}const M="https://api-jo2024.mkcodecreations.dev";function ge(t,n){const[a,i]=p.useState([]),[r,s]=p.useState(0),[u,m]=p.useState(!1),[o,d]=p.useState(null),[h,g]=p.useState(null);return p.useEffect(()=>{m(!0),d(null),g(null);const l={name:"name",price:"price",date:"product_details->date"}[t.sortBy],j={per_page:Math.max(1,t.perPage),page:t.page,sort_by:l,order:t.order,...t.name&&{name:t.name},...t.category&&{category:t.category},...t.location&&{location:t.location},...t.date&&{date:t.date},...t.places>0&&{places:t.places}};k.get(`${M}/api/products`,{params:j,headers:{"Accept-Language":n}}).then(f=>{i(f.data.data),s(f.data.pagination.total)}).catch(f=>{var w;if(k.isAxiosError(f)){const P=(w=f.response)==null?void 0:w.status;if(P===422){g(f.response.data.errors);return}if(P===404){i([]),s(0);return}}d(f.code)}).finally(()=>m(!1))},[t,n]),{products:a,total:r,loading:u,error:o,validationErrors:h}}function fe(t,n){const[a,i]=p.useState(null),[r,s]=p.useState(!1),[u,m]=p.useState(null);return p.useEffect(()=>{if(t==null){i(null),m(null),s(!1);return}s(!0),m(null),i(null),k.get(`${M}/api/products/${t}`,{headers:{"Accept-Language":n}}).then(o=>{i(o.data.data)}).catch(o=>{var h,g;const d=k.isAxiosError(o)&&((g=(h=o.response)==null?void 0:h.data)!=null&&g.message)?o.response.data.message:o.message;m(d)}).finally(()=>{s(!1)})},[t,n]),{product:a,loading:r,error:u}}function z({title:t,message:n,showRetry:a=!0,retryButtonText:i,onRetry:r,showHome:s=!0,homeButtonText:u}){return e.jsxs(x,{sx:{p:4,textAlign:"center"},children:[e.jsx(c,{variant:"h5",gutterBottom:!0,children:t}),e.jsx(c,{variant:"body1",sx:{mb:2},children:n}),a&&e.jsx(y,{variant:"text",onClick:r,children:i}),s&&e.jsx(y,{variant:"contained",onClick:()=>window.location.href="/",sx:{ml:2},children:u})]})}function A(t,n="en",a="EUR"){return new Intl.NumberFormat(n,{style:"currency",currency:a}).format(t)}function W(t,n="en",a={day:"numeric",month:"long",year:"numeric"}){if(!t)return"";const i=new Date(t);return isNaN(i.getTime())?"":new Intl.DateTimeFormat(n,a).format(i)}function je({open:t,productId:n,lang:a,onClose:i}){const{t:r}=b("ticket"),{product:s,loading:u,error:m}=fe(t?n:null,a),o=v=>A(v,a,"EUR"),d=s?W(s.product_details.date,a):"",h=(s==null?void 0:s.stock_quantity)===0,g=((s==null?void 0:s.price)??0)*(1-((s==null?void 0:s.sale)??0));return e.jsxs(re,{open:t,onClose:i,maxWidth:"sm",fullWidth:!0,children:[e.jsx(oe,{children:u?r("tickets.loading"):m?r("tickets.error"):s==null?void 0:s.name}),e.jsxs(ne,{dividers:!0,children:[u&&e.jsx(x,{sx:{textAlign:"center",py:4},children:e.jsx(F,{})}),m&&e.jsx(z,{title:r("errors.title"),message:r("errors.not_found"),showRetry:!1,showHome:!1}),s&&e.jsxs(x,{component:"div",children:[e.jsx(x,{component:"img",src:s.product_details.image,alt:s.name,loading:"lazy",sx:{width:"100%",height:200,objectFit:"cover",mb:2}}),e.jsxs(c,{variant:"body1",children:[d,s.product_details.time&&` – ${s.product_details.time}`]}),e.jsx(c,{variant:"body1",color:"text.secondary",sx:{mb:1},children:s.product_details.location}),e.jsx(c,{variant:"body2",color:"text.secondary",sx:{mb:1},children:r("tickets.category",{category:s.product_details.category})}),e.jsx(c,{variant:"body2",sx:{mb:1},children:s.product_details.description}),e.jsx(c,{variant:"body1",color:"text.secondary",children:r("tickets.places",{count:s.product_details.places})}),e.jsxs(x,{sx:{display:"flex",alignItems:"baseline",gap:1,mt:1},children:[s.sale>0&&e.jsx(c,{variant:"body2",sx:{textDecoration:"line-through"},children:o(s.price)}),e.jsx(c,{variant:"subtitle1",fontWeight:"bold",children:o(g)}),s.sale>0&&e.jsx(I,{label:`–${Math.round(s.sale*100)}%`,size:"small"})]}),e.jsx(c,{variant:"body2",color:h?"error.main":"text.secondary",sx:{mt:1},children:h?r("tickets.out_of_stock"):r("tickets.available",{count:s.stock_quantity})})]})]}),e.jsxs(ie,{children:[e.jsx(y,{onClick:i,children:r("tickets.close")}),e.jsx(y,{variant:"contained",disabled:(s==null?void 0:s.stock_quantity)===0||u||!!m,href:`/tickets/${n}`,children:r(h?"tickets.out_of_stock":"tickets.buy")})]})]})}function Ee(){const{t}=b("ticket"),n=R(l=>l.lang),[a,i]=p.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:r,total:s,loading:u,error:m,validationErrors:o}=ge(a,n),[d,h]=p.useState(null);p.useEffect(()=>{if(o){const l={};o.sort_by&&(l.sortBy="name",l.order="asc"),o.date&&(l.date=""),o.name&&(l.name=""),o.category&&(l.category=""),o.location&&(l.location=""),o.places&&(l.places=0),i(j=>({...j,...l}))}},[o]);const g=l=>A(l,n,"EUR"),v=l=>W(l,n);return m?e.jsx(z,{title:t("errors.title"),message:t("errors.unexpected"),showRetry:!0,retryButtonText:t("errors.retry"),onRetry:()=>i(l=>({...l})),showHome:!0,homeButtonText:t("errors.home")}):e.jsxs(e.Fragment,{children:[e.jsx(T,{title:t("tickets.seo_title"),description:t("tickets.seo_description")}),e.jsxs(ce,{disableCard:!0,children:[e.jsx(c,{variant:"h4",sx:{px:2},children:t("tickets.title")}),e.jsxs(x,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[e.jsx(me,{filters:a,onChange:l=>i(j=>({...j,...l}))}),e.jsxs(x,{component:"main",flex:1,children:[u?e.jsx(x,{textAlign:"center",py:8,children:e.jsx(F,{})}):e.jsx(he,{products:r,fmtCur:g,fmtDate:v,onViewDetails:h}),!u&&r.length>0&&e.jsx(x,{textAlign:"center",mt:4,children:e.jsx(le,{count:Math.ceil(s/a.perPage)||1,page:a.page,onChange:(l,j)=>i(f=>({...f,page:j}))})})]})]})]}),e.jsx(je,{open:d!==null,productId:d,lang:n,onClose:()=>h(null)})]})}export{Ee as default};
