import{r as g,j as e}from"./react-C0aVURRx.js";import{a as I,b as D,P as v,S as P,O as T}from"./index-DrEuU79R.js";import{E as F}from"./ErrorDisplay-CPpgxCLY.js";import{u as L,q as d,t as b,N as B,a2 as w,B as O,I as C,p as R,r as Y,a3 as M,x as W,ao as z,C as U,R as A,Q as N,U as G,_ as H}from"./mui-DvHa722-.js";import{d as S}from"./dayjs-DMyafwSS.js";import{F as k}from"./FilterSelect-BZIZCyjw.js";import{S as $}from"./SortControl-CkPxS0rS.js";import{u as j}from"./i18n-react-CLR_B6bE.js";import{f as q,a as J}from"./format-_gz818Hm.js";import{u as Q}from"./useDownloadInvoice-BrgeLClq.js";import{u as V}from"./useCustomSnackbar-BM_DdCE4.js";import{g as K}from"./billingService-D-S36CYI.js";import"./axios-xsH4HHeE.js";import"./zustand-DgaMZn_z.js";import"./vendor-BkFWaOq0.js";import"./i18n-Bhc83OLH.js";import"./emotion-BDhcDjNx.js";import"./helmet-OWuT_DBl.js";import"./cookie-consent-DmI9BIvn.js";function X({filters:t,onChange:r}){const{t:s}=j("invoices"),p=L(),[m,c]=g.useState(!1),u={"":s("filters.status_all"),pending:s("filters.status_pending"),paid:s("filters.status_paid"),failed:s("filters.status_failed"),refunded:s("filters.status_refunded")},_=Object.entries(u).reduce((a,[i,E])=>(a[E]=i,a),{}),o=Object.values(u),l=u[t.status],n={created_at:s("filters.sort_by_date"),amount:s("filters.sort_by_amount"),uuid:s("filters.sort_by_uuid")},f=Object.entries(n).map(([a,i])=>({value:a,label:i})),h=[5,10,15,25,50,100].map(a=>String(a)),x=String(t.per_page),y=e.jsxs(d,{sx:{width:260,py:2,px:1},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:s("filters.title")}),e.jsxs(B,{spacing:2,sx:{mx:1},children:[e.jsx(k,{label:s("filters.status_label"),value:l,options:o,onChange:a=>{const i=_[a]??"";r({status:i,page:1})}}),e.jsx(w,{label:s("filters.date_from_label"),value:t.date_from?S(t.date_from):null,onChange:a=>r({date_from:(a==null?void 0:a.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx(w,{label:s("filters.date_to_label"),value:t.date_to?S(t.date_to):null,onChange:a=>r({date_to:(a==null?void 0:a.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx($,{fields:f,sortBy:t.sort_by,order:t.sort_order,onSortChange:(a,i)=>{r({sort_by:a,sort_order:i,page:1})},label:s("filters.sort_by_label")}),e.jsx(k,{label:s("filters.per_page_label"),value:x,options:h,onChange:a=>{const i=parseInt(a,10)||15;r({per_page:i,page:1})}}),e.jsx(O,{variant:"outlined",fullWidth:!0,onClick:()=>r({status:"",date_from:"",date_to:"",sort_by:"created_at",sort_order:"desc",per_page:15,page:1}),children:s("filters.reset")})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(d,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:p.mixins.toolbar.minHeight,bgcolor:"background.paper",border:a=>`1px solid ${a.palette.divider}`,borderRadius:1,width:260},children:y}),e.jsxs(d,{sx:{display:{xs:"block",md:"none"},mb:2},children:[e.jsx(C,{onClick:()=>c(!0),"aria-label":s("filters.title"),children:e.jsx(R,{})}),e.jsx(Y,{open:m,onClose:()=>c(!1),keepMounted:!0,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx(C,{onClick:()=>c(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":s("filters.close"),children:e.jsx(M,{})}),y]})})]})]})}function Z(t){switch(t){case"paid":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"info";default:return"default"}}function ee({invoice:t}){const{t:r}=j("invoices"),s=I(x=>x.lang),{download:p,downloading:m}=Q(),{notify:c}=V(),u=q(t.created_at,s),_=J(t.amount,s,"EUR");let o;t.status==="paid"&&t.amount===0?o=r("card.free_ticket"):o=r(`card.status.${t.status}`);const l=Z(t.status),n=t.status==="paid"||t.status==="refunded";let f=r("card.download_invoice");n||(t.status==="pending"?f=r("card.download_not_ready"):t.status==="failed"?f=r("card.download_not_available"):f=r("card.download_not_available_generic"));const h=()=>{n?p(t.invoice_link):t.status==="pending"?c(r("snackbar.pending_message"),"warning"):t.status==="failed"?c(r("snackbar.failed_message"),"error"):c(r("snackbar.unavailable_message"),"info")};return e.jsx(e.Fragment,{children:e.jsx(d,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:e.jsxs(W,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[e.jsx(z,{title:f,children:e.jsx(d,{onClick:h,sx:{cursor:n?"pointer":"default",width:{xs:"100%",md:120},height:80,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",borderRadius:1,position:"relative","&:hover":n?{bgcolor:"action.hover"}:{}},children:m&&n?e.jsx(U,{size:24}):e.jsx(A,{fontSize:"large",color:n?"action":"disabled"})})}),e.jsxs(N,{sx:{flexGrow:1},children:[e.jsx(b,{variant:"h6",children:r("card.reference",{reference:t.uuid})}),e.jsx(b,{variant:"body2",sx:{mt:.5},children:r("card.date",{date:u})}),e.jsx(b,{variant:"body2",sx:{mt:.5},children:r("card.amount",{amount:_})}),e.jsx(d,{sx:{mt:1},children:e.jsx(G,{label:o,color:l,size:"small"})})]})]})})})}function te({invoices:t}){const{t:r}=j("invoices");return t.length===0?e.jsx(b,{variant:"h6",align:"center",children:r("invoices.no_found")}):e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:{xs:"center",md:"flex-start"}},children:t.map(s=>e.jsx(ee,{invoice:s},s.uuid))})}function se(t,r){const s=D(x=>x.authToken),[p,m]=g.useState([]),[c,u]=g.useState(0),[_,o]=g.useState(!1),[l,n]=g.useState(null),[f,h]=g.useState(null);return g.useEffect(()=>{let x=!1;return(async()=>{var a;if(o(!0),n(null),h(null),!s){n(new Error("User not authenticated")),m([]),u(0),o(!1);return}try{const i=await K(t,s);if(x)return;m(i.data.data),u(i.data.meta.total)}catch(i){if(x)return;((a=i.response)==null?void 0:a.status)===422?h(i.response.data.errors):n(i instanceof Error?i:new Error("Unknown error"))}finally{x||o(!1)}})(),()=>{x=!0}},[JSON.stringify(t),s,r]),{invoices:p,total:c,loading:_,error:l,validationErrors:f}}function ve(){const t=I(l=>l.lang),{t:r}=j("invoices"),[s,p]=g.useState({status:"",date_from:"",date_to:"",sort_by:"created_at",sort_order:"desc",per_page:15,page:1}),{invoices:m,total:c,loading:u,error:_,validationErrors:o}=se(s,t);return g.useEffect(()=>{if(!o)return;const l={...o.status&&{status:""},...o.date_from&&{date_from:""},...o.date_to&&{date_to:""},...o.sort_by&&{sort_by:"created_at"},...o.sort_order&&{sort_order:"desc"},...o.per_page&&{per_page:15},...o.page&&{page:1}};p(n=>({...n,...l}))},[o]),_?e.jsx(v,{children:e.jsx(F,{title:r("errors.title"),message:r("errors.message"),showRetry:!0,retryButtonText:r("invoices.retry"),onRetry:()=>p(l=>({...l})),showHome:!0,homeButtonText:r("invoices.go_home")})}):e.jsxs(e.Fragment,{children:[e.jsx(P,{title:r("seo.title"),description:r("seo.description")}),e.jsxs(v,{disableCard:!0,children:[e.jsx(b,{variant:"h4",sx:{px:2},children:r("invoices.title")}),e.jsxs(d,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[e.jsx(X,{filters:s,onChange:l=>p(n=>({...n,...l}))}),e.jsxs(d,{component:"main",flex:1,children:[u?e.jsx(d,{textAlign:"center",py:8,children:e.jsx(T,{})}):e.jsx(te,{invoices:m}),!u&&m.length>0&&e.jsx(d,{textAlign:"center",mt:4,children:e.jsx(H,{count:Math.ceil(c/s.per_page)||1,page:s.page,onChange:(l,n)=>p(f=>({...f,page:n}))})})]})]})]})]})}export{ve as default};
