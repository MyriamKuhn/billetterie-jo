import{r as n,j as e}from"./react-C0aVURRx.js";import{S as te}from"./Seo-CkXwJOyJ.js";import{P as se}from"./PageWrapper-otroOoLH.js";import{l as oe,A as R,g as u}from"./AlertMessage-DMKOtRGk.js";import{b as W,u as v,l as re,a as _,o as ne,r as ie,c as ae}from"./index-Q-gZHGuk.js";import{a as q}from"./axios-xsH4HHeE.js";import{q as d,t as f,G as A,J as k,am as le,I as de,an as ce,ao as ue,V as me,ah as ge,B as N,C as L,ab as h,i as xe}from"./mui-BwUJxCPm.js";import{u as fe}from"./i18n-react-u0paBAQg.js";import{O as he}from"./vendor-JT0P6-Ac.js";import"./dayjs-DMyafwSS.js";import"./helmet-8QjG9zRw.js";import"./i18n-Bhc83OLH.js";import"./zustand-DgaMZn_z.js";import"./emotion-Dvs1mEHu.js";import"./cookie-consent-B6r0YzHB.js";function ze(){const{t}=fe("login"),F=he(),[g,$]=n.useState(""),[P,D]=n.useState(""),[p,G]=n.useState(!1),[j,b]=n.useState(!1),[T,O]=n.useState(""),[c,x]=n.useState(!1),[I,i]=n.useState(null),[H,S]=n.useState(!1),[w,z]=n.useState(!1),[J,E]=n.useState(!1),[y,U]=n.useState(!1),K=()=>U(s=>!s),Q=W(s=>s.setToken),X=W(s=>s.clearToken),B=v(s=>s.setGuestCartId),Y=v(s=>s.guestCartId),V=v(s=>s.loadCart),M=async(s,m)=>{var l,r;s.preventDefault(),i(null),m||b(!1),S(!1),E(!1),x(!0);try{const a=await re(g,P,p,m?T:"",_.getState().lang,Y);if(a.token&&a.user){await ne(a.token,a.user.role,p,Q,B,V,F);return}}catch(a){if(q.isAxiosError(a)){const C=(l=a.response)==null?void 0:l.status,o=(r=a.response)==null?void 0:r.data;if(C===400&&(o==null?void 0:o.code)==="twofa_required"){b(!0),x(!1);return}if(C===400&&(o==null?void 0:o.code)==="email_not_verified"){i(t("errors.emailNotVerifiedSent")),S(!0),x(!1);return}C===404||o!=null&&o.code?i(u(t,o==null?void 0:o.code)):i(u(t,"generic_error"))}else i(u(t,"network_error"))}finally{x(!1)}},Z=async s=>{var m;s.preventDefault(),z(!0),i(null);try{const{status:l,data:r}=await ie(g,_.getState().lang);if(l===200&&r.message){E(!0),S(!1);return}}catch(l){if(q.isAxiosError(l)){const r=(m=l.response)==null?void 0:m.data;r!=null&&r.code?i(u(t,r==null?void 0:r.code)):i(u(t,"generic_error"))}else i(u(t,"network_error"))}finally{z(!1)}},ee=async()=>{b(!1),await ae(X,B,V,F,"/login")};return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:t("seo.title"),description:t("seo.description")}),e.jsx(se,{disableCard:!0,children:e.jsxs(d,{component:"form",onSubmit:j?s=>M(s,!0):s=>M(s,!1),sx:{maxWidth:400,mx:"auto",mt:{xs:1,sm:4,md:8},p:4,borderRadius:2,boxShadow:3,backgroundColor:"background.paper",border:s=>`1px solid ${s.palette.divider}`},children:[e.jsx(d,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(d,{component:"img",src:oe,alt:t("login.logoAlt"),sx:{height:150,width:"auto"}})}),e.jsx(f,{variant:"h4",gutterBottom:!0,align:"center",children:t("login.pageTitle")}),I&&e.jsx(R,{message:I,severity:"error"}),J&&e.jsx(R,{message:t("login.verificationEmailResent"),severity:"success"}),!j&&e.jsxs(A,{spacing:2,children:[e.jsx(k,{required:!0,fullWidth:!0,id:"email",label:t("login.emailLabel"),type:"email",value:g,onChange:s=>$(s.target.value),autoComplete:"email"}),e.jsx(k,{required:!0,fullWidth:!0,id:"password",label:t("login.passwordLabel"),type:y?"text":"password",value:P,onChange:s=>D(s.target.value),autoComplete:"current-password",slotProps:{input:{endAdornment:e.jsx(le,{position:"end",children:e.jsx(de,{"aria-label":t(y?"login.hidePassword":"login.showPassword"),onClick:K,edge:"end",children:y?e.jsx(ce,{}):e.jsx(ue,{})})})}}}),e.jsx(d,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(me,{control:e.jsx(ge,{checked:p,onChange:s=>G(s.target.checked),color:"primary"}),label:t("login.rememberMe"),sx:{".MuiFormControlLabel-label":{fontSize:"0.875rem"}}})}),e.jsx(N,{type:"submit",variant:"contained",fullWidth:!0,disabled:c,startIcon:c?e.jsx(L,{color:"inherit",size:16}):void 0,children:c?`${t("login.loginButtonLoad")}…`:t("login.loginButton")}),e.jsx(d,{sx:{mt:1,textAlign:"center"},children:e.jsxs(A,{direction:"row",spacing:1,justifyContent:"center",children:[e.jsx(h,{href:"/forgot-password",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:t("login.forgotPassword")}),e.jsx(f,{variant:"body2",sx:{fontSize:"0.8rem",mx:.5},children:"|"}),e.jsx(h,{href:"/signup",underline:"hover",variant:"body2",sx:{fontSize:"0.8rem"},children:t("login.noAccount")})]})}),H&&e.jsx(d,{sx:{mt:2,textAlign:"center"},children:e.jsxs(f,{variant:"body2",sx:{fontSize:"0.8rem"},children:[t("login.emailNotVerifiedHint")," ",e.jsxs(h,{component:"button",variant:"body2",onClick:Z,disabled:w||!/.+@.+\..+/.test(g),sx:{fontSize:"0.8rem"},children:[w?`${t("login.resendLinkText")}…`:t("login.resendLinkText"),w&&e.jsx(L,{color:"inherit",size:12,sx:{mr:.5}})]})]})})]}),j&&e.jsxs(d,{children:[e.jsx(f,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:t("login.twoFATitle")}),e.jsx(k,{required:!0,fullWidth:!0,id:"twoFACode",label:t("login.twoFACodeLabel"),type:"text",value:T,onChange:s=>O(s.target.value),autoComplete:"one-time-code"}),e.jsx(N,{type:"submit",variant:"contained",fullWidth:!0,sx:{mt:3},disabled:c,startIcon:c?e.jsx(L,{color:"inherit",size:16}):void 0,children:c?`${t("login.verify2FALoad")}…`:t("login.verify2FAButton")}),e.jsx(xe,{sx:{my:3}}),e.jsx(A,{direction:"row",justifyContent:"end",children:e.jsx(h,{component:"button",variant:"body2",onClick:ee,sx:{fontSize:"0.8rem"},children:t("login.cancelLogin")})})]})]})})]})}export{ze as default};
