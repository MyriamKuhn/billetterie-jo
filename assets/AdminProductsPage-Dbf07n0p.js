import{r as x,j as t}from"./react-C0aVURRx.js";import{A as $,b as z,F as H,O as W,a as N,P as B,S as J}from"./index-DXIYW5t8.js";import{P as Q}from"./ProductsFilters-NjM-9eGH.js";import{f as X,a as A}from"./format-BP4WpB1S.js";import{u as E}from"./useCustomSnackbar-GAr0oIXp.js";import{u as S}from"./i18n-react-CHYEX_9Z.js";import{x as L,Q as O,t as v,q as _,$ as P,U as D,B as F,C as Y,W as K,a0 as Z,a1 as tt,a2 as et,Y as at,V as T,X as q,_ as st}from"./mui-BWNuWX87.js";import{a as k}from"./axios-xsH4HHeE.js";import{E as I}from"./ErrorDisplay-DlFuKLFp.js";import{a0 as rt}from"./vendor-1UMx7qFY.js";import{d as nt}from"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-BKoPsIBf.js";import"./helmet-DqAb31yQ.js";import"./cookie-consent-DYVQHhqE.js";import"./FilterSelect-CbLK0-vt.js";import"./SortControl-DsrGQFkW.js";function ot({product:e,lang:s,onViewDetails:f,onSave:g,onRefresh:o,onDuplicate:u}){const{t:l}=S("adminProducts"),{notify:d}=E(),[m,y]=x.useState(e.price),[c,j]=x.useState(e.sale),[i,a]=x.useState(e.sale*100),[n,h]=x.useState(e.stock_quantity),[p,r]=x.useState(!1),b=m*(1-c),w=async()=>{r(!0);const C=await g(e.id,{price:m,sale:c,stock_quantity:n});r(!1),C?(d(l("products.success"),"success"),o()):d(l("errors.save_failed"),"error")};return t.jsxs(L,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:[t.jsxs(O,{children:[t.jsx(v,{variant:"h6",children:e.name}),t.jsxs(v,{variant:"body2",children:[X(e.product_details.date,s),e.product_details.time&&` – ${e.product_details.time}`]}),t.jsxs(v,{variant:"body2",color:"text.secondary",children:[e.product_details.location," - ",l("products.places",{count:e.product_details.places})]})]}),t.jsxs(_,{sx:{display:"flex",gap:2,flexWrap:"wrap",px:2},children:[t.jsx(P,{label:l("products.price"),type:"number",value:m,onChange:C=>y(parseFloat(C.target.value)),size:"small",slotProps:{input:{endAdornment:t.jsx(D,{label:"€",size:"small"})}}}),t.jsx(P,{label:l("products.sale"),type:"number",value:i,onChange:C=>{const M=parseFloat(C.target.value)||0;a(M),j(M/100)},slotProps:{input:{endAdornment:t.jsx(D,{label:"%",size:"small"})}},size:"small"}),t.jsx(P,{label:l("products.stock"),type:"number",value:n,onChange:C=>h(parseInt(C.target.value,10)),size:"small"})]}),t.jsxs(_,{sx:{px:2,display:"flex",alignItems:"baseline",justifyContent:{xs:"flex-start",md:"space-between"},flexDirection:{xs:"column",md:"row"},gap:1},children:[t.jsxs(_,{sx:{display:"flex",alignItems:"start",flexDirection:"column"},children:[t.jsxs(v,{variant:"body2",children:[l("products.currentPrice")," :"]}),t.jsx(v,{variant:"body2",sx:{textDecoration:e.sale>0?"line-through":"none"},children:A(e.price,s,"EUR")}),e.sale>0&&t.jsxs(_,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[t.jsx(v,{variant:"body2",fontWeight:"bold",children:A(e.price*(1-e.sale),s,"EUR")}),t.jsx(D,{label:`–${Math.round(e.sale*100)}%`,size:"small"})]})]}),t.jsxs(_,{sx:{display:"flex",alignItems:"start",flexDirection:"column"},children:[t.jsxs(v,{variant:"subtitle1",fontWeight:"bold",children:[l("products.newPrice")," :"]}),t.jsx(v,{variant:"body2",sx:{textDecoration:c>0?"line-through":"none"},children:A(m,s,"EUR")}),c>0&&t.jsxs(_,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[t.jsx(v,{variant:"subtitle1",fontWeight:"bold",children:A(b,s,"EUR")}),t.jsx(D,{label:`–${Math.round(c*100)}%`,size:"small"})]})]})]}),t.jsxs(_,{sx:{display:"flex",justifyContent:"center",flexDirection:{xs:"column",md:"row"},gap:1,mt:2},children:[t.jsx(F,{size:"small",variant:"outlined",onClick:()=>f(e.id),children:l("products.updateDetails")}),t.jsx(F,{size:"small",variant:"outlined",onClick:()=>u(e.id),children:l("products.duplicate")}),t.jsx(F,{size:"small",variant:"contained",disabled:p,onClick:w,startIcon:p?t.jsx(Y,{color:"inherit",size:16}):void 0,children:l(p?"products.saving":"products.save")})]})]})}function it({onCreate:e}){const{t:s}=S("adminProducts");return t.jsxs(L,{sx:{p:2,minWidth:240,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[t.jsxs(O,{children:[t.jsx(v,{variant:"h6",gutterBottom:!0,children:s("products.create_new")}),t.jsx(v,{variant:"body2",color:"text.secondary",children:s("products.create_intro")})]}),t.jsx(_,{sx:{p:2,pt:0},children:t.jsx(F,{fullWidth:!0,variant:"contained",onClick:e,children:s("products.create_button")})})]})}function lt({products:e,lang:s,onViewDetails:f,onSave:g,onRefresh:o,onDuplicate:u,onCreate:l}){const{t:d}=S("adminProducts");return e.length===0?t.jsx(v,{variant:"h4",sx:{textAlign:"center"},children:d("errors.not_found")}):t.jsxs(_,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:[t.jsx(it,{onCreate:l}),e.map(m=>t.jsx(ot,{product:m,lang:s,onViewDetails:f,onSave:g,onRefresh:o,onDuplicate:u},m.id))]})}function ct(e,s,f){const[g,o]=x.useState([]),[u,l]=x.useState(0),[d,m]=x.useState(!1),[y,c]=x.useState(null),[j,i]=x.useState(null);return x.useEffect(()=>{m(!0),c(null),i(null);const n={name:"name",price:"price",date:"product_details->date"}[e.sortBy],h={per_page:Math.max(1,e.perPage),page:e.page,sort_by:n,order:e.order,...e.name&&{name:e.name},...e.category&&{category:e.category},...e.location&&{location:e.location},...e.date&&{date:e.date},...e.places>0&&{places:e.places}};k.get(`${$}/api/products/all`,{params:h,headers:{Authorization:`Bearer ${f}`,"Accept-Language":s}}).then(p=>{o(p.data.data),l(p.data.pagination.total)}).catch(p=>{var r;if(k.isAxiosError(p)){const b=(r=p.response)==null?void 0:r.status;if(b===422){i(p.response.data.errors);return}if(b===404){o([]),l(0);return}}c(p.code)}).finally(()=>m(!1))},[e,s]),{products:g,total:u,loading:d,error:y,validationErrors:j}}function V(e,s){const[f,g]=x.useState(null),[o,u]=x.useState(!1),[l,d]=x.useState(null);return x.useEffect(()=>{if(e==null){g(null),d(null),u(!1);return}u(!0),d(null),Promise.all(s.map(m=>k.get(`${$}/api/products/${e}`,{headers:{"Accept-Language":m}}).then(y=>y.data.data))).then(m=>{const y=s.reduce((c,j,i)=>(c[j]=m[i],c),{});g(y)}).catch(m=>{var c,j;const y=k.isAxiosError(m)&&((j=(c=m.response)==null?void 0:c.data)!=null&&j.message)?m.response.data.message:m.message;d(y)}).finally(()=>u(!1))},[e,JSON.stringify(s)]),{data:f,loading:o,error:l}}function dt(){const e=z(s=>s.authToken);return async function(f,g){try{return await k.post(`${$}/api/products/${f}`,g,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),!0}catch{return!1}}}function ut({previewUrl:e,onFileSelected:s,label:f}){const{t:g}=S("adminProducts"),{getRootProps:o,getInputProps:u,isDragActive:l}=rt({onDrop:([d])=>s(d??null),accept:{"image/*":[]},multiple:!1});return t.jsxs(_,{sx:{textAlign:"center",mb:2},children:[e?t.jsx(_,{component:"img",src:e,sx:{maxWidth:"100%",maxHeight:200,objectFit:"cover",mb:1}}):t.jsx(v,{color:"text.secondary",sx:{mb:1},children:g("products.no_image")}),t.jsxs(_,{...o(),sx:{p:2,border:"2px dashed",borderColor:l?"primary.main":"grey.500",borderRadius:1,cursor:"pointer",bgcolor:l?"grey.100":"transparent"},children:[t.jsx("input",{...u()}),t.jsx(v,{children:l?g("products.image_here"):f})]})]})}const U=[{code:"fr",country:"FR"},{code:"en",country:"US"},{code:"de",country:"DE"}];function R({initialValues:e,saving:s,onSubmit:f,onCancel:g}){const{t:o}=S("adminProducts");x.useEffect(()=>{l(e),m(0)},[e]);const[u,l]=x.useState(e),[d,m]=x.useState(0),y=x.useMemo(()=>U[d].code,[d]),c=(i,a)=>{m(a)},j=async()=>{await f(u)&&g()};return t.jsxs(t.Fragment,{children:[t.jsxs(K,{dividers:!0,children:[t.jsxs(_,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[t.jsx(P,{label:o("products.price"),type:"number",value:u.price,onChange:i=>l(a=>({...a,price:parseFloat(i.target.value)})),slotProps:{input:{endAdornment:t.jsx(D,{label:"€",size:"small"})}},size:"small"}),t.jsx(P,{label:o("products.sale"),type:"number",value:u.sale*100,onChange:i=>l(a=>({...a,sale:(parseFloat(i.target.value)||0)/100})),slotProps:{input:{endAdornment:t.jsx(D,{label:"%",size:"small"})}},size:"small"}),t.jsx(P,{label:o("products.stock"),type:"number",value:u.stock_quantity,onChange:i=>l(a=>({...a,stock_quantity:parseInt(i.target.value,10)})),size:"small"})]}),t.jsx(_,{sx:{mb:2},children:t.jsx(ut,{previewUrl:u.imageFile?URL.createObjectURL(u.imageFile):u.translations.en.product_details.image?`${$}/products/images/${u.translations.en.product_details.image}`:void 0,label:o("products.image_here"),onFileSelected:i=>l(a=>({...a,imageFile:i??void 0}))})}),t.jsx(Z,{value:d,onChange:c,variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,children:U.map(i=>t.jsx(tt,{icon:t.jsx(H,{code:i.country,width:24,height:16}),"aria-label":i.code.toUpperCase()},i.code))}),(()=>{const i=y,a=u.translations[i];return t.jsxs(_,{component:"form",noValidate:!0,sx:{mt:2},children:[t.jsx(P,{fullWidth:!0,label:o("products.name"),value:a.name,onChange:n=>l(h=>({...h,translations:{...h.translations,[i]:{...a,name:n.target.value}}})),sx:{mb:2}}),t.jsx(P,{fullWidth:!0,multiline:!0,minRows:3,label:o("products.description"),value:a.product_details.description,onChange:n=>l(h=>({...h,translations:{...h.translations,[i]:{...a,product_details:{...a.product_details,description:n.target.value}}}})),sx:{mb:2}}),t.jsxs(_,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[t.jsx(P,{label:o("products.place"),type:"number",fullWidth:!0,value:a.product_details.places,onChange:n=>l(h=>({...h,translations:{...h.translations,[i]:{...a,product_details:{...a.product_details,places:parseInt(n.target.value,10)}}}})),size:"small"}),t.jsx(et,{label:o("products.date"),value:a.product_details.date?nt(a.product_details.date):null,onChange:n=>{const h=n?n.format("YYYY-MM-DD"):"";l(p=>({...p,translations:{...p.translations,[i]:{...a,product_details:{...a.product_details,date:h}}}}))},slotProps:{textField:{size:"small",fullWidth:!0,InputLabelProps:{shrink:!0}}}}),t.jsx(P,{label:o("products.time"),value:a.product_details.time,fullWidth:!0,onChange:n=>l(h=>({...h,translations:{...h.translations,[i]:{...a,product_details:{...a.product_details,time:n.target.value}}}})),slotProps:{inputLabel:{shrink:!0}},size:"small"})]}),t.jsx(P,{fullWidth:!0,label:o("products.location"),value:a.product_details.location,onChange:n=>l(h=>({...h,translations:{...h.translations,[i]:{...a,product_details:{...a.product_details,location:n.target.value}}}})),sx:{mb:2}}),t.jsx(P,{fullWidth:!0,label:o("products.category"),value:a.product_details.category,onChange:n=>l(h=>({...h,translations:{...h.translations,[i]:{...a,product_details:{...a.product_details,category:n.target.value}}}}))})]})})()]}),t.jsxs(at,{children:[t.jsx(F,{onClick:g,children:o("products.close")}),t.jsx(F,{variant:"contained",onClick:j,disabled:s,startIcon:s?t.jsx(Y,{size:16}):void 0,children:o(s?"products.saving":"products.save")})]})]})}function pt({open:e,productId:s,onClose:f,onRefresh:g}){const{t:o}=S("adminProducts"),{notify:u}=E(),l=dt(),{data:d,loading:m,error:y}=V(e?s:null,["fr","en","de"]),c=x.useMemo(()=>{if(!d)return null;const a=d.en;return{price:a.price,sale:a.sale,stock_quantity:a.stock_quantity,imageFile:void 0,translations:{fr:{name:d.fr.name,product_details:{...d.fr.product_details,imageFile:void 0}},en:{name:d.en.name,product_details:{...d.en.product_details,imageFile:void 0}},de:{name:d.de.name,product_details:{...d.de.product_details,imageFile:void 0}}}}},[d]),[j,i]=x.useState(!1);return t.jsxs(T,{open:e,onClose:f,maxWidth:"sm",fullWidth:!0,children:[t.jsx(q,{children:o("products.modification",{id:s})}),m&&t.jsx(_,{textAlign:"center",py:4,children:t.jsx(W,{})}),y&&t.jsx(I,{title:o("errors.title"),message:o("errors.not_found")}),!m&&!y&&c&&t.jsx(R,{initialValues:c,saving:j,onSubmit:async a=>{i(!0);const n=new FormData;n.append("price",a.price.toString()),n.append("sale",a.sale.toString()),n.append("stock_quantity",a.stock_quantity.toString()),["fr","en","de"].forEach(p=>{const r=a.translations[p];n.append(`translations[${p}][name]`,r.name),n.append(`translations[${p}][product_details][places]`,r.product_details.places.toString()),n.append(`translations[${p}][product_details][description]`,r.product_details.description),n.append(`translations[${p}][product_details][date]`,r.product_details.date),n.append(`translations[${p}][product_details][time]`,r.product_details.time),n.append(`translations[${p}][product_details][location]`,r.product_details.location),n.append(`translations[${p}][product_details][category]`,r.product_details.category)}),a.imageFile&&n.append("image",a.imageFile,a.imageFile.name);const h=await l(s,n);return i(!1),h?(u(o("products.success"),"success"),g(),!0):(u(o("errors.save_failed"),"error"),!1)},onCancel:f})]})}function mt(){const e=z(s=>s.authToken);return async function(f,g){try{return await k.patch(`${$}/api/products/${f}/pricing`,g,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),!0}catch{return!1}}}function G(){const e=z(s=>s.authToken);return async function(f){try{return await k.post(`${$}/api/products`,f,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e}`}}),!0}catch{return!1}}}function xt({open:e,productId:s,onClose:f,onRefresh:g}){const{t:o}=S("adminProducts"),{notify:u}=E(),l=G(),{data:d,loading:m,error:y}=V(e?s:null,["fr","en","de"]),c=x.useMemo(()=>{if(!d)return null;const a=d.en;return{price:a.price,sale:a.sale,stock_quantity:a.stock_quantity,imageFile:void 0,translations:{fr:{name:d.fr.name,product_details:{...d.fr.product_details,image:"",imageFile:void 0}},en:{name:d.en.name,product_details:{...d.en.product_details,image:"",imageFile:void 0}},de:{name:d.de.name,product_details:{...d.de.product_details,image:"",imageFile:void 0}}}}},[d]),[j,i]=x.useState(!1);return t.jsxs(T,{open:e,onClose:f,maxWidth:"sm",fullWidth:!0,children:[t.jsx(q,{children:o("products.duplication",{id:s})}),m&&t.jsx(_,{textAlign:"center",py:4,children:t.jsx(W,{})}),y&&t.jsx(I,{title:o("errors.title"),message:o("errors.not_found")}),!m&&!y&&c&&t.jsx(R,{initialValues:c,saving:j,onSubmit:async a=>{i(!0);const n=new FormData;n.append("price",a.price.toString()),n.append("sale",a.sale.toString()),n.append("stock_quantity",a.stock_quantity.toString()),["fr","en","de"].forEach(p=>{const r=a.translations[p];n.append(`translations[${p}][name]`,r.name),n.append(`translations[${p}][product_details][places]`,r.product_details.places.toString()),n.append(`translations[${p}][product_details][description]`,r.product_details.description),n.append(`translations[${p}][product_details][date]`,r.product_details.date),n.append(`translations[${p}][product_details][time]`,r.product_details.time),n.append(`translations[${p}][product_details][location]`,r.product_details.location),n.append(`translations[${p}][product_details][category]`,r.product_details.category)}),a.imageFile&&n.append("image",a.imageFile,a.imageFile.name);const h=await l(n);return i(!1),h?(u(o("products.success"),"success"),g(),!0):(u(o("errors.save_failed"),"error"),!1)},onCancel:f})]})}function gt({open:e,onClose:s,onRefresh:f}){const{t:g}=S("adminProducts"),{notify:o}=E(),u=G(),[l,d]=x.useState(!1),m=x.useMemo(()=>({price:0,sale:0,stock_quantity:0,imageFile:void 0,translations:{fr:{name:"",product_details:{places:0,description:"",date:"",time:"",location:"",category:"",image:"",imageFile:void 0}},en:{name:"",product_details:{places:0,description:"",date:"",time:"",location:"",category:"",image:"",imageFile:void 0}},de:{name:"",product_details:{places:0,description:"",date:"",time:"",location:"",category:"",image:"",imageFile:void 0}}}}),[]);return t.jsxs(T,{open:e,onClose:s,maxWidth:"sm",fullWidth:!0,children:[t.jsx(q,{children:g("products.create_new")}),t.jsx(R,{initialValues:m,saving:l,onSubmit:async y=>{d(!0);const c=new FormData;c.append("price",y.price.toString()),c.append("sale",y.sale.toString()),c.append("stock_quantity",y.stock_quantity.toString()),["fr","en","de"].forEach(i=>{const a=y.translations[i];c.append(`translations[${i}][name]`,a.name),c.append(`translations[${i}][product_details][places]`,a.product_details.places.toString()),c.append(`translations[${i}][product_details][description]`,a.product_details.description),c.append(`translations[${i}][product_details][date]`,a.product_details.date),c.append(`translations[${i}][product_details][time]`,a.product_details.time),c.append(`translations[${i}][product_details][location]`,a.product_details.location),c.append(`translations[${i}][product_details][category]`,a.product_details.category)}),y.imageFile&&c.append("image",y.imageFile,y.imageFile.name);const j=await u(c);return d(!1),j?(o(g("products.success"),"success"),f(),!0):(o(g("errors.save_failed"),"error"),!1)},onCancel:s})]})}function Wt(){const{t:e}=S("adminProducts"),s=N(r=>r.lang),f=z(r=>r.authToken),g=mt(),[o,u]=x.useState({name:"",category:"",location:"",date:"",places:0,sortBy:"name",order:"asc",perPage:15,page:1}),{products:l,total:d,loading:m,error:y,validationErrors:c}=ct(o,s,f),[j,i]=x.useState(null),[a,n]=x.useState(null),[h,p]=x.useState(!1);return x.useEffect(()=>{if(c){const r={};c.sort_by&&(r.sortBy="name",r.order="asc"),c.date&&(r.date=""),c.name&&(r.name=""),c.category&&(r.category=""),c.location&&(r.location=""),c.places&&(r.places=0),u(b=>({...b,...r}))}},[c]),y?t.jsx(B,{children:t.jsx(I,{title:e("errors.title"),message:e("errors.unexpected"),showRetry:!0,retryButtonText:e("errors.retry"),onRetry:()=>u(r=>({...r})),showHome:!0,homeButtonText:e("errors.home")})}):t.jsxs(t.Fragment,{children:[t.jsx(J,{title:e("seo.title"),description:e("seo.description")}),t.jsxs(B,{disableCard:!0,children:[t.jsx(v,{variant:"h4",sx:{px:2},children:e("products.title")}),t.jsxs(_,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[t.jsx(Q,{filters:o,onChange:r=>u(b=>({...b,...r}))}),t.jsxs(_,{component:"main",flex:1,children:[m?t.jsx(_,{textAlign:"center",py:8,children:t.jsx(W,{})}):t.jsx(lt,{products:l,lang:s,onViewDetails:i,onSave:async(r,b)=>await g(r,{price:b.price,sale:b.sale,stock_quantity:b.stock_quantity}),onRefresh:()=>u(r=>({...r})),onDuplicate:n,onCreate:()=>p(!0)}),!m&&l.length>0&&t.jsx(_,{textAlign:"center",mt:4,children:t.jsx(st,{count:Math.ceil(d/o.perPage)||1,page:o.page,onChange:(r,b)=>u(w=>({...w,page:b}))})})]})]})]}),t.jsx(pt,{open:j!==null,productId:j,lang:s,onClose:()=>i(null),onRefresh:()=>u(r=>({...r}))}),t.jsx(xt,{open:a!==null,productId:a,lang:s,onClose:()=>n(null),onRefresh:()=>u(r=>({...r}))}),t.jsx(gt,{open:h,lang:s,onClose:()=>p(!1),onRefresh:()=>u(r=>({...r}))})]})}export{Wt as default};
