import{r as l,j as r}from"./react-C0aVURRx.js";import{a as B,u as y,O as R}from"./index-0o0hW-SE.js";import{I as f,aB as O,aC as T,aD as A,q as p,t as x,e as P,aE as M,h as U,as as q,a8 as D,a9 as F,B as N}from"./mui-CaMhj-nn.js";import{a as w}from"./format-BP4WpB1S.js";import{u as G}from"./useReloadCart-Dh4Vxn_w.js";import{u as E}from"./useCustomSnackbar-KNVcHHHt.js";import{u as L}from"./i18n-react-2P1mIwau.js";import{a0 as H}from"./vendor-CknGL9X_.js";import"./dayjs-DMyafwSS.js";import"./axios-xsH4HHeE.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-VhTkku_q.js";import"./helmet-BJ5MjdLa.js";import"./cookie-consent-BKvNUUg0.js";function J(t,n){const i=l.useRef([]),{notify:o}=E(),{t:d}=L("cart");l.useEffect(()=>{if(!n){i.current=t;return}i.current.forEach(u=>{const e=t.find(h=>h.id===u.id);e?e.quantity<u.quantity&&o(d("cart.quantity_reduced",{name:e.name,count:e.quantity}),"warning"):o(d("cart.removed_unavailable",{name:u.name}),"warning")}),i.current=t},[t,n,o,d])}function ia(){const{t}=L(["common","cart"]),{notify:n}=E(),i=B(a=>a.lang),{loading:o,hasError:d,reload:m,isReloading:u}=G(),e=y(a=>a.items);J(e,u);const h=y.getState().addItem,s=y(a=>a.isLocked),[v,j]=l.useState(null),g=!!v,b=g?"cart-popover":void 0,S=e.reduce((a,c)=>a+c.quantity,0),z=e.reduce((a,c)=>a+c.quantity*c.price,0),I=l.useCallback(a=>{j(a.currentTarget),m()},[m]),C=l.useCallback(()=>j(null),[]),k=l.useCallback(async(a,c)=>{if(s){n(t("cart:errors.cart_locked"),"warning");return}const _=Math.max(0,a.quantity+c);if(_>a.availableQuantity){n(t("cart:cart.not_enough_stock",{count:a.availableQuantity}),"warning");return}try{await h(a.id,_,a.availableQuantity),c>0?n(t("cart:cart.add_success"),"success"):n(t("cart:cart.remove_success"),"success")}catch(Q){Q.message==="CartLocked"?n(t("cart:errors.cart_locked"),"warning"):n(t("cart:errors.error_update"),"error")}},[h,n,t,s]);return r.jsxs(r.Fragment,{children:[r.jsx(f,{"aria-describedby":b,onClick:I,color:"inherit","aria-label":t("common:navbar.cart"),children:r.jsx(O,{badgeContent:S,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:r.jsx(T,{})})}),r.jsxs(A,{id:b,open:g,anchorEl:v,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{width:300,p:1}},children:[s&&r.jsx(p,{sx:{p:1},children:r.jsx(x,{variant:"body2",color:"warning.main",children:t("cart:cart.payment_in_progress")})}),o?r.jsx(p,{sx:{p:2,textAlign:"center"},children:r.jsx(R,{})}):d?r.jsx(x,{sx:{p:2},variant:"body2",children:t("cart:cart.unavailable")}):e.length===0?r.jsx(x,{sx:{p:2},variant:"body2",children:t("cart:cart.empty")}):r.jsxs(p,{children:[r.jsx(P,{dense:!0,"aria-live":"polite",children:e.map(a=>r.jsx(M,{secondaryAction:r.jsxs(p,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(q,{title:t(s?"cart:errors.cart_locked":"cart:cart.remove_one"),children:r.jsx("span",{children:r.jsx(f,{size:"small",onClick:()=>k(a,-1),disabled:o||a.quantity<=0,sx:s?{opacity:.5}:void 0,children:r.jsx(D,{fontSize:"small"})})})}),r.jsx(x,{sx:{mx:.5},children:a.quantity}),r.jsx(q,{title:s?t("cart:errors.cart_locked"):a.quantity>=a.availableQuantity?t("cart:cart.max_reached",{count:a.availableQuantity}):t("cart:cart.add_one"),children:r.jsx("span",{children:r.jsx(f,{size:"small",onClick:()=>k(a,1),disabled:o||a.quantity>=a.availableQuantity,sx:s?{opacity:.5}:void 0,children:r.jsx(F,{fontSize:"small"})})})})]}),children:r.jsx(U,{primary:a.name,secondary:w(a.price,i,"EUR")})},a.id))}),r.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",p:1},children:[r.jsxs(x,{variant:"subtitle1",children:[t("cart:cart.total")," : ",w(z,i,"EUR")]}),r.jsx(N,{component:H,to:"/cart",variant:"contained",size:"small",onClick:C,disabled:o,children:t("cart:cart.view")})]})]})]})]})}export{ia as default};
