import{r as g,j as e}from"./react-C0aVURRx.js";import{a as I,b as D,P as v,S as P,O as T}from"./index-0o0hW-SE.js";import{E as F}from"./ErrorDisplay-C2nHG3XV.js";import{u as L,q as d,t as b,N as B,Y as w,B as O,I as C,p as Y,r as R,_ as M,x as W,as as z,C as A,R as N,a0 as U,a1 as G,a6 as H}from"./mui-CaMhj-nn.js";import{d as S}from"./dayjs-DMyafwSS.js";import{F as k}from"./FilterSelect-BJweXNQg.js";import{S as $}from"./SortControl-C5Ar46m_.js";import{u as j}from"./i18n-react-2P1mIwau.js";import{f as q,a as J}from"./format-BP4WpB1S.js";import{u as V,g as K}from"./useDownloadInvoice-Dl_9cZeg.js";import{u as Q}from"./useCustomSnackbar-KNVcHHHt.js";import"./axios-xsH4HHeE.js";import"./zustand-DgaMZn_z.js";import"./vendor-CknGL9X_.js";import"./i18n-Bhc83OLH.js";import"./emotion-VhTkku_q.js";import"./helmet-BJ5MjdLa.js";import"./cookie-consent-BKvNUUg0.js";function X({filters:t,onChange:r}){const{t:s}=j("invoices"),p=L(),[m,c]=g.useState(!1),u={"":s("filters.status_all"),pending:s("filters.status_pending"),paid:s("filters.status_paid"),failed:s("filters.status_failed"),refunded:s("filters.status_refunded")},_=Object.entries(u).reduce((a,[i,E])=>(a[E]=i,a),{}),n=Object.values(u),l=u[t.status],o={created_at:s("filters.sort_by_date"),amount:s("filters.sort_by_amount"),uuid:s("filters.sort_by_uuid")},f=Object.entries(o).map(([a,i])=>({value:a,label:i})),h=[5,10,15,25,50,100].map(a=>String(a)),x=String(t.per_page),y=e.jsxs(d,{sx:{width:260,py:2,px:1},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:s("filters.title")}),e.jsxs(B,{spacing:2,sx:{mx:1},children:[e.jsx(k,{label:s("filters.status_label"),value:l,options:n,onChange:a=>{const i=_[a]??"";r({status:i,page:1})}}),e.jsx(w,{label:s("filters.date_from_label"),value:t.date_from?S(t.date_from):null,onChange:a=>r({date_from:(a==null?void 0:a.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx(w,{label:s("filters.date_to_label"),value:t.date_to?S(t.date_to):null,onChange:a=>r({date_to:(a==null?void 0:a.format("YYYY-MM-DD"))||"",page:1}),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx($,{fields:f,sortBy:t.sort_by,order:t.sort_order,onSortChange:(a,i)=>{r({sort_by:a,sort_order:i,page:1})},label:s("filters.sort_by_label")}),e.jsx(k,{label:s("filters.per_page_label"),value:x,options:h,onChange:a=>{const i=parseInt(a,10)||15;r({per_page:i,page:1})}}),e.jsx(O,{variant:"outlined",fullWidth:!0,onClick:()=>r({status:"",date_from:"",date_to:"",sort_by:"created_at",sort_order:"desc",per_page:15,page:1}),children:s("filters.reset")})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(d,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:p.mixins.toolbar.minHeight,bgcolor:"background.paper",border:a=>`1px solid ${a.palette.divider}`,borderRadius:1,width:260},children:y}),e.jsxs(d,{sx:{display:{xs:"block",md:"none"},mb:2},children:[e.jsx(C,{onClick:()=>c(!0),"aria-label":s("filters.title"),children:e.jsx(Y,{})}),e.jsx(R,{open:m,onClose:()=>c(!1),keepMounted:!0,children:e.jsxs(d,{sx:{position:"relative"},children:[e.jsx(C,{onClick:()=>c(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":s("filters.close"),children:e.jsx(M,{})}),y]})})]})]})}function Z(t){switch(t){case"paid":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"info";default:return"default"}}function ee({invoice:t}){const{t:r}=j("invoices"),s=I(x=>x.lang),{download:p,downloading:m}=V(),{notify:c}=Q(),u=q(t.created_at,s),_=J(t.amount,s,"EUR"),n=r(`card.status.${t.status}`,t.status),l=Z(t.status),o=t.status==="paid"||t.status==="refunded";let f=r("card.download_invoice");o||(t.status==="pending"?f=r("card.download_not_ready"):t.status==="failed"?f=r("card.download_not_available"):f=r("card.download_not_available_generic"));const h=()=>{o?p(t.invoice_link):t.status==="pending"?c(r("snackbar.pending_message"),"warning"):t.status==="failed"?c(r("snackbar.failed_message"),"error"):c(r("snackbar.unavailable_message"),"info")};return e.jsx(e.Fragment,{children:e.jsx(d,{sx:{flex:{xs:"1 1 calc(33% - 32px)",md:"1 1 100%"},minWidth:{xs:280,md:"auto"},maxWidth:{xs:320,md:"100%"}},children:e.jsxs(W,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"stretch",md:"center"},p:2,gap:1},children:[e.jsx(z,{title:f,children:e.jsx(d,{onClick:h,sx:{cursor:o?"pointer":"default",width:{xs:"100%",md:120},height:80,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default",borderRadius:1,position:"relative","&:hover":o?{bgcolor:"action.hover"}:{}},children:m&&o?e.jsx(A,{size:24}):e.jsx(N,{fontSize:"large",color:o?"action":"disabled"})})}),e.jsxs(U,{sx:{flexGrow:1},children:[e.jsxs(b,{variant:"h6",children:[r("card.reference"),": ",t.uuid]}),e.jsxs(b,{variant:"body2",sx:{mt:.5},children:[r("card.date"),": ",u]}),e.jsxs(b,{variant:"body2",sx:{mt:.5},children:[r("card.amount"),": ",_]}),e.jsx(d,{sx:{mt:1},children:e.jsx(G,{label:n,color:l,size:"small"})})]})]})})})}function te({invoices:t}){const{t:r}=j("invoices");return t.length===0?e.jsx(b,{variant:"h6",align:"center",children:r("invoices.no_found")}):e.jsx(d,{sx:{display:"flex",flexWrap:"wrap",gap:2,justifyContent:{xs:"center",md:"flex-start"}},children:t.map(s=>e.jsx(ee,{invoice:s},s.uuid))})}function se(t,r){const s=D(x=>x.authToken),[p,m]=g.useState([]),[c,u]=g.useState(0),[_,n]=g.useState(!1),[l,o]=g.useState(null),[f,h]=g.useState(null);return g.useEffect(()=>{let x=!1;return(async()=>{var a;if(n(!0),o(null),h(null),!s){o(new Error("User not authenticated")),m([]),u(0),n(!1);return}try{const i=await K(t,s);if(x)return;m(i.data.data),u(i.data.meta.total)}catch(i){if(x)return;((a=i.response)==null?void 0:a.status)===422?h(i.response.data.errors):o(i instanceof Error?i:new Error("Unknown error"))}finally{x||n(!1)}})(),()=>{x=!0}},[JSON.stringify(t),s,r]),{invoices:p,total:c,loading:_,error:l,validationErrors:f}}function ye(){const t=I(l=>l.lang),{t:r}=j("invoices"),[s,p]=g.useState({status:"",date_from:"",date_to:"",sort_by:"created_at",sort_order:"desc",per_page:15,page:1}),{invoices:m,total:c,loading:u,error:_,validationErrors:n}=se(s,t);return g.useEffect(()=>{if(!n)return;const l={...n.status&&{status:""},...n.date_from&&{date_from:""},...n.date_to&&{date_to:""},...n.sort_by&&{sort_by:"created_at"},...n.sort_order&&{sort_order:"desc"},...n.per_page&&{per_page:15},...n.page&&{page:1}};p(o=>({...o,...l}))},[n]),_?e.jsx(v,{children:e.jsx(F,{title:r("errors.title"),message:r("errors.message"),showRetry:!0,retryButtonText:r("invoices.retry"),onRetry:()=>p(l=>({...l})),showHome:!0,homeButtonText:r("invoices.go_home")})}):e.jsxs(e.Fragment,{children:[e.jsx(P,{title:r("seo.title"),description:r("seo.description")}),e.jsxs(v,{disableCard:!0,children:[e.jsx(b,{variant:"h4",sx:{px:2},children:r("invoices.title")}),e.jsxs(d,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,p:2},children:[e.jsx(X,{filters:s,onChange:l=>p(o=>({...o,...l}))}),e.jsxs(d,{component:"main",flex:1,children:[u?e.jsx(d,{textAlign:"center",py:8,children:e.jsx(T,{})}):e.jsx(te,{invoices:m}),!u&&m.length>0&&e.jsx(d,{textAlign:"center",mt:4,children:e.jsx(H,{count:Math.ceil(c/s.per_page)||1,page:s.page,onChange:(l,o)=>p(f=>({...f,page:o}))})})]})]})]})]})}export{ye as default};
