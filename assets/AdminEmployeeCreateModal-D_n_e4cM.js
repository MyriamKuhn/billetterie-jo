import{r as n,j as e}from"./react-C0aVURRx.js";import{u as Y,q as v,t as f,N as J,B as C,I as M,p as Z,r as ee,a8 as ae,x as L,Q as V,U as B,$ as S,a6 as W,ar as P,C as O,V as R,X as q,W as I,Y as G}from"./mui-CW5KTKiM.js";import{F as U}from"./FilterField-CvqQz55q.js";import{F as te}from"./FilterSelect-usqmpckm.js";import{u as z}from"./i18n-react-CHYEX_9Z.js";import{b as E,f as T}from"./format-_gz818Hm.js";import{u as H}from"./useCustomSnackbar-Cg6BlIUS.js";import{a as k}from"./axios-xsH4HHeE.js";import{A,b as K,O as se}from"./index-q-ZiXizB.js";import{E as re}from"./ErrorDisplay-Cpov-QS1.js";import{P as ie}from"./PasswordWithConfirmation-BS2Y6Jv1.js";function ve({role:s,filters:t,onChange:l}){const{t:r}=z("users"),h=`filters.${s}_per_page`,u=Y(),[a,x]=n.useState(!1),o=e.jsxs(v,{sx:{width:260,py:2,px:1},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:r("filters.title")}),e.jsxs(J,{spacing:2,sx:{mx:1},children:[e.jsx(U,{label:r("filters.firstname"),value:t.firstname,onChange:d=>l({firstname:d,page:1})}),e.jsx(U,{label:r("filters.lastname"),value:t.lastname,onChange:d=>l({lastname:d,page:1})}),e.jsx(U,{label:r("filters.email"),value:t.email,onChange:d=>l({email:d,page:1})}),e.jsx(te,{label:r(h),value:t.perPage,options:[5,10,15,20,25,50,100],onChange:d=>l({perPage:d,page:1})}),e.jsx(C,{variant:"outlined",fullWidth:!0,onClick:()=>l({firstname:"",lastname:"",email:"",perPage:10,page:1}),children:r("filters.reset")})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(v,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:u.mixins.toolbar.minHeight,bgcolor:"background.paper",border:d=>`1px solid ${d.palette.divider}`,borderRadius:1,width:260},children:o}),e.jsxs(v,{sx:{display:{xs:"block",md:"none"},mb:2},children:[e.jsx(M,{onClick:()=>x(!0),"aria-label":r("filters.title"),children:e.jsx(Z,{})}),e.jsx(ee,{open:a,onClose:()=>x(!1),keepMounted:!0,children:e.jsxs(v,{sx:{position:"relative"},children:[e.jsx(M,{onClick:()=>x(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":r("filters.close"),children:e.jsx(ae,{})}),o]})})]})]})}function ne({lang:s,user:t,onViewDetails:l,onSave:r,onRefresh:h,isEmployee:u}){const{t:a}=z("users"),{notify:x}=H(),[o,d]=n.useState(t.is_active),[p,w]=n.useState(t.twofa_enabled),[g,i]=n.useState(t.firstname),[c,y]=n.useState(t.lastname),[b,D]=n.useState(t.email),j=u?"employee":"user",[m,N]=n.useState(!!t.email_verified_at),[$,F]=n.useState(!1),Q=n.useMemo(()=>o!==t.is_active||p!==t.twofa_enabled||g!==t.firstname||c!==t.lastname||b!==t.email||m!==!!t.email_verified_at,[o,p,g,c,b,m,t]),X=async()=>{F(!0);const _=await r(t.id,{is_active:o,twofa_enabled:p,firstname:g,lastname:c,email:b,role:j,verify_email:m});F(!1),_?(x(a(u?"user.success_employee":"user.success"),"success"),h()):x(a("errors.save_failed"),"error")};return e.jsxs(L,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(V,{children:[e.jsx(f,{variant:"h6",children:u?a("user.title_employee",{id:t.id}):a("user.title",{id:t.id})}),e.jsx(B,{label:a(o?"user.active":"user.inactive"),color:o?"success":"default",size:"small",sx:{mr:1,mb:1}}),e.jsx(B,{label:a(p?"user.twofa_enabled":"user.twofa_disabled"),color:p?"info":"default",size:"small",sx:{mr:1,mb:1}}),e.jsx(B,{label:a(m?"user.email_verified":"user.email_not_verified"),color:m?"primary":"default",size:"small",sx:{mr:1,mb:1}}),e.jsx(f,{variant:"body2",sx:{mt:2},children:a("user.created_on",{date:T(t.created_at,s),time:E(t.created_at,s)})}),t.updated_at&&e.jsx(f,{variant:"body2",color:"text.secondary",children:a("user.updated_on",{date:T(t.updated_at,s),time:E(t.updated_at,s)})})]}),e.jsxs(v,{sx:{display:"flex",gap:2,flexWrap:"wrap",px:2},children:[e.jsx(S,{label:a("user.firstname"),type:"text",value:g,onChange:_=>i(_.target.value),size:"small"}),e.jsx(S,{label:a("user.lastname"),type:"text",value:c,onChange:_=>y(_.target.value),size:"small"}),e.jsx(S,{label:a("user.email"),type:"text",value:b,onChange:_=>D(_.target.value),size:"small"})]}),e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2,px:2},children:[e.jsx(W,{control:e.jsx(P,{checked:o,onChange:_=>d(_.target.checked),size:"small"}),label:a("user.toggle_active")}),e.jsx(W,{control:e.jsx(P,{checked:p||!1,onChange:_=>w(_.target.checked),disabled:!p,size:"small"}),label:a("user.toggle_twofa")}),e.jsx(W,{control:e.jsx(P,{checked:m,onChange:_=>N(_.target.checked),disabled:m,size:"small"}),label:a("user.toggle_verify_email")})]}),e.jsxs(v,{sx:{display:"flex",justifyContent:"center",flexDirection:{xs:"column",md:"row"},gap:1,mt:2},children:[e.jsx(C,{size:"small",variant:"outlined",onClick:()=>l(t.id),children:a("user.see_details")}),e.jsx(C,{size:"small",variant:"contained",disabled:$||!Q,onClick:X,startIcon:$?e.jsx(O,{color:"inherit",size:16}):void 0,children:a($?"user.saving":"user.save")})]})]})}function le({onCreate:s}){const{t}=z("users");return e.jsxs(L,{sx:{p:2,minWidth:240,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs(V,{children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:t("employee.create_new")}),e.jsx(f,{variant:"body2",color:"text.secondary",children:t("employee.create_intro")})]}),e.jsx(v,{sx:{p:2,pt:0},children:e.jsx(C,{fullWidth:!0,variant:"contained",onClick:s,children:t("employee.create_button")})})]})}function ye({lang:s,users:t,onViewDetails:l,onSave:r,onRefresh:h,isEmployee:u,onCreate:a}){const{t:x}=z("users");return t.length===0?e.jsx(f,{variant:"h4",sx:{textAlign:"center"},children:x(u?"errors.not_found_employee":"errors.not_found")}):e.jsxs(v,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:[u&&e.jsx(le,{onCreate:a}),t.map(o=>e.jsx(ne,{lang:s,user:o,onViewDetails:()=>l(o.id),onSave:r,onRefresh:h,isEmployee:u},o.id))]})}function be(s,t,l){const[r,h]=n.useState([]),[u,a]=n.useState(0),[x,o]=n.useState(!1),[d,p]=n.useState(null),[w,g]=n.useState(null);return n.useEffect(()=>{o(!0),p(null),g(null);const i={per_page:Math.max(1,s.perPage),page:s.page,role:l,...s.firstname&&{firstname:s.firstname},...s.lastname&&{lastname:s.lastname},...s.email&&{email:s.email}};k.get(`${A}/api/users`,{params:i,headers:{Authorization:`Bearer ${t}`}}).then(c=>{h(c.data.data.users),a(c.data.meta.total)}).catch(c=>{var y;if(k.isAxiosError(c)){const b=(y=c.response)==null?void 0:y.status;if(b===422){g(c.response.data.errors);return}if(b===404){h([]),a(0);return}}p(c.code)}).finally(()=>o(!1))},[s,t,l]),{users:r,total:u,loading:x,error:d,validationErrors:w}}function we(){const s=K(t=>t.authToken);return async function(l,r){try{return await k.patch(`${A}/api/users/${l}`,r,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}}),!0}catch{return!1}}}function Ce({lang:s,open:t,userId:l,token:r,onClose:h,isEmployee:u}){const{t:a}=z("users"),[x,o]=n.useState(!1),[d,p]=n.useState(null),[w,g]=n.useState(null),[i,c]=n.useState(null);return n.useEffect(()=>{if(!t||l===null)return;o(!0),p(null);const y={Authorization:`Bearer ${r}`};Promise.all([k.get(`${A}/api/users/${l}`,{headers:y}),k.get(`${A}/api/users/email/${l}`,{headers:y})]).then(([b,D])=>{g(b.data.user),c(D.data.data)}).catch(b=>{p(a(u?"errors.not_found_employee":"errors.not_found"))}).finally(()=>o(!1))},[t,l,r,a]),e.jsxs(R,{open:t,onClose:h,maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{sx:{p:2},children:e.jsx(f,{variant:"h6",component:"div",children:u?a("user.details_title_employee",{id:l}):a("user.details_title",{id:l})})}),x&&e.jsx(v,{textAlign:"center",py:4,children:e.jsx(se,{})}),d&&e.jsx(re,{title:a("errors.title"),message:a(u?"errors.error_employee":"errors.error_user")}),!x&&!d&&w&&e.jsx(I,{dividers:!0,children:e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:.5,px:2},children:[e.jsxs(f,{variant:"subtitle1",children:[e.jsx("strong",{children:a("user.name")})," ",w.firstname," ",w.lastname]}),e.jsxs(f,{variant:"subtitle1",children:[e.jsx("strong",{children:a("user.details_email")})," ",w.email]}),i?e.jsxs(v,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[e.jsx(f,{variant:"subtitle2",children:a("user.pending_email_change")}),e.jsxs(f,{variant:"body2",children:[a("user.old_email"),": ",i.old_email]}),e.jsxs(f,{variant:"body2",children:[a("user.new_email"),": ",i.new_email]}),e.jsx(f,{variant:"body2",children:a("user.requested_on",{date:T(i.created_at,s),time:E(i.created_at,s)})}),e.jsx(f,{variant:"body2",color:"text.secondary",children:a("user.updated_on",{date:T(i.updated_at,s),time:E(i.updated_at,s)})})]}):e.jsx(f,{variant:"body2",sx:{mt:2,p:2},children:a("user.no_pending_email")})]})}),e.jsx(G,{children:e.jsx(C,{onClick:h,size:"small",children:a("user.close")})})]})}function oe(){const s=K(t=>t.authToken);return async function(l){try{return await k.post(`${A}/api/users/employees`,l,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}}),!0}catch{return!1}}}function Se({open:s,onClose:t,onRefresh:l}){const{t:r}=z("users"),{notify:h}=H(),u=oe(),[a,x]=n.useState(!1),[o,d]=n.useState(!1),[p,w]=n.useState(!1),g=n.useMemo(()=>({firstname:"",lastname:"",email:"",password:"",password_confirmation:""}),[]),[i,c]=n.useState(g);n.useEffect(()=>{s&&(c(g),d(!1),w(!1))},[s,g]);const y=n.useMemo(()=>/^\S+@\S+\.\S+$/.test(i.email),[i.email]),b=n.useMemo(()=>i.firstname.trim()!==""&&i.lastname.trim()!==""&&i.email.trim()!==""&&y&&i.password!==""&&i.password===i.password_confirmation,[i,y]),D=async()=>{x(!0);const j={firstname:i.firstname,lastname:i.lastname,email:i.email,password:i.password,password_confirmation:i.password_confirmation},m=await u(j);x(!1),m?(h(r("employee.success"),"success"),l(),t()):h(r("errors.creation_failed"),"error")};return e.jsxs(R,{open:s,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{children:r("employee.create_new")}),e.jsx(I,{dividers:!0,children:e.jsxs(v,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(S,{label:r("user.lastname"),value:i.lastname,onChange:j=>c(m=>({...m,lastname:j.target.value})),fullWidth:!0}),e.jsx(S,{label:r("user.firstname"),value:i.firstname,onChange:j=>c(m=>({...m,firstname:j.target.value})),fullWidth:!0}),e.jsx(S,{label:r("user.email"),type:"email",value:i.email,onChange:j=>c(m=>({...m,email:j.target.value})),onBlur:()=>w(!0),error:p&&!y,helperText:p&&!y?r("employee.invalid_email"):"",fullWidth:!0}),e.jsx(ie,{password:i.password,onPasswordChange:j=>c(m=>({...m,password:j})),confirmPassword:i.password_confirmation,onConfirmChange:j=>c(m=>({...m,password_confirmation:j})),touched:o,onBlur:()=>d(!0)})]})}),e.jsxs(G,{children:[e.jsx(C,{onClick:t,disabled:a,children:r("user.close")}),e.jsx(C,{variant:"contained",onClick:D,disabled:!b||a,startIcon:a?e.jsx(O,{size:16}):void 0,children:r(a?"employee.creation":"employee.create")})]})]})}export{ye as A,ve as U,be as a,Ce as b,Se as c,we as u};
