import{r as c,j as e}from"./react-C0aVURRx.js";import{b,S as f,O as E,P as x}from"./index-C8vFMK_G.js";import{a as w}from"./axios-Dq7h7Pqt.js";import{N as S,E as T,P as U,T as _,f as A}from"./TwoFASection-CWh1F913.js";import{g}from"./AlertMessage-Div13Ill.js";import{E as F}from"./ErrorDisplay-Zu0HG1b7.js";import{u as P}from"./i18n-react-InMECBPB.js";import{q as h,v as j,O as B}from"./mui-uHutCCHi.js";import{U as k}from"./vendor-DWEXA6-K.js";import"./dayjs-DMyafwSS.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-BfGcg3ty.js";import"./helmet-BZ3LMwLd.js";import"./cookie-consent-DtjjNNxi.js";import"./validation-491qobvS.js";import"./PasswordWithConfirmation-BLLWGUvq.js";function X(){const{t:r}=P("userDashboard"),u=b(t=>t.authToken),[l,a]=c.useState(null),[y,d]=c.useState(!0),[p,m]=c.useState(null);return c.useEffect(()=>{if(!u){a(null),d(!1);return}const t=new AbortController,o=t.signal;return(async()=>{d(!0),m(null);try{const n=await A(u,{signal:o});if(o.aborted)return;const{status:i,data:s}=n;i===200&&s.user?a({firstname:s.user.firstname,lastname:s.user.lastname,email:s.user.email,twoFAEnabled:s.user.twofa_enabled}):m(r("errors.fetchProfile"))}catch(n){if(o.aborted)return;if(w.isAxiosError(n)&&n.response){const i=n.response.data,s=i==null?void 0:i.code;m(g(r,s??"generic_error"))}else m(g(r,"network_error"))}finally{o.aborted||d(!1)}})(),()=>{t.abort()}},[u,r]),y?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:r("seo.title_employee"),description:r("seo.description_employee")}),e.jsx(h,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(E,{})})]}):p?e.jsx(x,{children:e.jsx(F,{title:r("errors.genericErrorTitle"),message:p,showRetry:!0,retryButtonText:r("errors.retry"),onRetry:()=>{window.location.reload()},showHome:!0,homeButtonText:r("errors.home")})}):l?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:r("seo.title_employee"),description:r("seo.description_employee")}),e.jsx(x,{children:e.jsxs(h,{sx:{maxWidth:600,mx:"auto",mt:4,mb:4},children:[e.jsx(j,{variant:"h4",gutterBottom:!0,align:"center",children:r("dashboard.title_employee")}),e.jsx(j,{variant:"body1",gutterBottom:!0,align:"center",sx:{mb:4},children:r("dashboard.subtitle_employee")}),e.jsxs(B,{spacing:2,children:[e.jsx(S,{user:l,onUpdate:t=>a(o=>({...o,...t}))}),e.jsx(T,{currentEmail:l.email,onUpdate:t=>a(o=>({...o,email:t}))}),e.jsx(U,{}),e.jsx(_,{enabled:l.twoFAEnabled,onToggle:t=>a(o=>({...o,twoFAEnabled:t}))})]})]})})]}):e.jsx(k,{to:"/login",replace:!0})}export{X as default};
