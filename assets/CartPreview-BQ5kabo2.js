import{r as i,j as t}from"./react-C0aVURRx.js";import{a as Q,u as q,O as B}from"./index-JrA3fJ57.js";import{I as m,ax as R,ay as L,az as O,q as p,t as h,e as A,aA as T,h as P,aB as k,ac as M,ad as U,B as F}from"./mui-Dl6HORPF.js";import{a as _}from"./format-BP4WpB1S.js";import{u as N}from"./useReloadCart-P54pFwdc.js";import{u as w}from"./useCustomSnackbar-CwD0a6HH.js";import{u as z}from"./i18n-react-ZsqOCTOc.js";import{a0 as D}from"./vendor-B9PkVD2_.js";import"./dayjs-DMyafwSS.js";import"./axios-xsH4HHeE.js";import"./zustand-DgaMZn_z.js";import"./i18n-Bhc83OLH.js";import"./emotion-QUM7EFga.js";import"./helmet-DwkNRAhC.js";import"./cookie-consent-BI82O-I0.js";function G(r,e){const c=i.useRef([]),{notify:s}=w(),{t:l}=z("cart");i.useEffect(()=>{if(!e){c.current=r;return}c.current.forEach(u=>{const n=r.find(d=>d.id===u.id);n?n.quantity<u.quantity&&s(l("cart.quantity_reduced",{name:n.name,count:n.quantity}),"warning"):s(l("cart.removed_unavailable",{name:u.name}),"warning")}),c.current=r},[r,e,s,l])}function oa(){const{t:r}=z(["common","cart"]),{notify:e}=w(),c=Q(a=>a.lang),{loading:s,hasError:l,reload:x,isReloading:u}=N(),n=q(a=>a.items);G(n,u);const d=q.getState().addItem,[y,f]=i.useState(null),j=!!y,v=j?"cart-popover":void 0,E=n.reduce((a,o)=>a+o.quantity,0),S=n.reduce((a,o)=>a+o.quantity*o.price,0),I=i.useCallback(a=>{f(a.currentTarget),x()},[x]),b=i.useCallback(()=>f(null),[]),g=i.useCallback(async(a,o)=>{const C=Math.max(0,a.quantity+o);if(C>a.availableQuantity){e(r("cart:cart.not_enough_stock",{count:a.availableQuantity}),"warning");return}try{await d(a.id,C,a.availableQuantity),o>0?e(r("cart:cart.add_success"),"success"):e(r("cart:cart.remove_success"),"success")}catch{e(r("cart:errors.error_update"),"error")}},[d,e,r]);return t.jsxs(t.Fragment,{children:[t.jsx(m,{"aria-describedby":v,onClick:I,color:"inherit","aria-label":r("common:navbar.cart"),children:t.jsx(R,{badgeContent:E,color:"info",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(L,{})})}),t.jsx(O,{id:v,open:j,anchorEl:y,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPopover-paper":{width:300,p:1}},children:s?t.jsx(p,{sx:{p:2,textAlign:"center"},children:t.jsx(B,{})}):l?t.jsx(h,{sx:{p:2},variant:"body2",children:r("cart:cart.unavailable")}):n.length===0?t.jsx(h,{sx:{p:2},variant:"body2",children:r("cart:cart.empty")}):t.jsxs(p,{children:[t.jsx(A,{dense:!0,"aria-live":"polite",children:n.map(a=>t.jsx(T,{secondaryAction:t.jsxs(p,{sx:{display:"flex",alignItems:"center"},children:[t.jsx(k,{title:r("cart:cart.remove_one"),children:t.jsx("span",{children:t.jsx(m,{size:"small",onClick:()=>g(a,-1),disabled:a.quantity<=0||s,children:t.jsx(M,{fontSize:"small"})})})}),t.jsx(h,{sx:{mx:.5},children:a.quantity}),t.jsx(k,{title:a.quantity>=a.availableQuantity?r("cart:cart.max_reached",{count:a.availableQuantity}):r("cart:cart.add_one"),children:t.jsx("span",{children:t.jsx(m,{size:"small",onClick:()=>g(a,1),disabled:s||a.quantity>=a.availableQuantity,children:t.jsx(U,{fontSize:"small"})})})})]}),children:t.jsx(P,{primary:a.name,secondary:_(a.price,c,"EUR")})},a.id))}),t.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",p:1},children:[t.jsxs(h,{variant:"subtitle1",children:[r("cart:cart.total")," : ",_(S,c,"EUR")]}),t.jsx(F,{component:D,to:"/cart",variant:"contained",size:"small",onClick:b,disabled:s,children:r("cart:cart.view")})]})]})})]})}export{oa as default};
