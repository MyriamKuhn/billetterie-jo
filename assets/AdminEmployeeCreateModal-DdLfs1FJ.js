import{r as n,j as e}from"./react-C0aVURRx.js";import{u as Y,q as _,t as m,N as J,B as C,I as M,p as Z,r as ee,a3 as se,x as L,Q as V,U as B,$ as S,ai as E,an as F,C as R,V as O,X as q,W as I,Y as G}from"./mui-pYozd6Ue.js";import{F as P}from"./FilterField-XQB9fMSP.js";import{F as te}from"./FilterSelect-D6K1oIzj.js";import{u as k}from"./i18n-react-CHYEX_9Z.js";import{b as z,f as A}from"./format-_gz818Hm.js";import{u as H}from"./useCustomSnackbar-H5kbubpM.js";import{a as T}from"./axios-xsH4HHeE.js";import{b as K,A as W,O as ae}from"./index-CXZF4oSR.js";import{E as re}from"./ErrorDisplay-CCUrHHSf.js";import{P as ie}from"./PasswordWithConfirmation-Bhoh0gNT.js";function ve({role:i,filters:t,onChange:l}){const{t:a}=k("users"),g=`filters.${i}_per_page`,u=Y(),[s,x]=n.useState(!1),c=e.jsxs(_,{sx:{width:260,py:2,px:1},children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:a("filters.title")}),e.jsxs(J,{spacing:2,sx:{mx:1},children:[e.jsx(P,{label:a("filters.firstname"),value:t.firstname,onChange:d=>l({firstname:d,page:1})}),e.jsx(P,{label:a("filters.lastname"),value:t.lastname,onChange:d=>l({lastname:d,page:1})}),e.jsx(P,{label:a("filters.email"),value:t.email,onChange:d=>l({email:d,page:1})}),e.jsx(te,{label:a(g),value:t.perPage,options:[5,10,15,20,25,50,100],onChange:d=>l({perPage:d,page:1})}),e.jsx(C,{variant:"outlined",fullWidth:!0,onClick:()=>l({firstname:"",lastname:"",email:"",perPage:10,page:1}),children:a("filters.reset")})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(_,{component:"aside",sx:{display:{xs:"none",md:"block"},position:"sticky",top:u.mixins.toolbar.minHeight,bgcolor:"background.paper",border:d=>`1px solid ${d.palette.divider}`,borderRadius:1,width:260},children:c}),e.jsxs(_,{sx:{display:{xs:"block",md:"none"},mb:2},children:[e.jsx(M,{onClick:()=>x(!0),"aria-label":a("filters.title"),children:e.jsx(Z,{})}),e.jsx(ee,{open:s,onClose:()=>x(!1),keepMounted:!0,children:e.jsxs(_,{sx:{position:"relative"},children:[e.jsx(M,{onClick:()=>x(!1),size:"small",sx:{position:"absolute",top:8,right:8},"aria-label":a("filters.close"),children:e.jsx(se,{})}),c]})})]})]})}function le({lang:i,user:t,onViewDetails:l,onSave:a,onRefresh:g,isEmployee:u}){const{t:s}=k("users"),{notify:x}=H(),[c,d]=n.useState(t.is_active),[p,y]=n.useState(t.twofa_enabled),[v,r]=n.useState(t.firstname),[h,b]=n.useState(t.lastname),[w,D]=n.useState(t.email),f=u?"employee":"user",[o,N]=n.useState(!!t.email_verified_at),[$,U]=n.useState(!1),Q=n.useMemo(()=>c!==t.is_active||p!==t.twofa_enabled||v!==t.firstname||h!==t.lastname||w!==t.email||o!==!!t.email_verified_at,[c,p,v,h,w,o,t]),X=async()=>{U(!0);const j=await a(t.id,{is_active:c,twofa_enabled:p,firstname:v,lastname:h,email:w,role:f,verify_email:o});U(!1),j?(x(s(u?"user.success_employee":"user.success"),"success"),g()):x(s("errors.save_failed"),"error")};return e.jsxs(L,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(V,{children:[e.jsx(m,{variant:"h6",children:u?s("user.title_employee",{id:t.id}):s("user.title",{id:t.id})}),e.jsx(B,{label:s(c?"user.active":"user.inactive"),color:c?"success":"default",size:"small",sx:{mr:1,mb:1}}),e.jsx(B,{label:s(p?"user.twofa_enabled":"user.twofa_disabled"),color:p?"info":"default",size:"small",sx:{mr:1,mb:1}}),e.jsx(B,{label:s(o?"user.email_verified":"user.email_not_verified"),color:o?"primary":"default",size:"small",sx:{mr:1,mb:1}}),e.jsx(m,{variant:"body2",sx:{mt:2},children:s("user.created_on",{date:A(t.created_at,i),time:z(t.created_at,i)})}),t.updated_at&&e.jsx(m,{variant:"body2",color:"text.secondary",children:s("user.updated_on",{date:A(t.updated_at,i),time:z(t.updated_at,i)})})]}),e.jsxs(_,{sx:{display:"flex",gap:2,flexWrap:"wrap",px:2},children:[e.jsx(S,{label:s("user.firstname"),type:"text",value:v,onChange:j=>r(j.target.value),size:"small"}),e.jsx(S,{label:s("user.lastname"),type:"text",value:h,onChange:j=>b(j.target.value),size:"small"}),e.jsx(S,{label:s("user.email"),type:"text",value:w,onChange:j=>D(j.target.value),size:"small"})]}),e.jsxs(_,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2,px:2},children:[e.jsx(E,{control:e.jsx(F,{checked:c,onChange:j=>d(j.target.checked),size:"small"}),label:s("user.toggle_active")}),e.jsx(E,{control:e.jsx(F,{checked:p||!1,onChange:j=>y(j.target.checked),disabled:!p,size:"small"}),label:s("user.toggle_twofa")}),e.jsx(E,{control:e.jsx(F,{checked:o,onChange:j=>N(j.target.checked),disabled:o,size:"small"}),label:s("user.toggle_verify_email")})]}),e.jsxs(_,{sx:{display:"flex",justifyContent:"center",flexDirection:{xs:"column",md:"row"},gap:1,mt:2},children:[e.jsx(C,{size:"small",variant:"outlined",onClick:()=>l(t.id),children:s("user.see_details")}),e.jsx(C,{size:"small",variant:"contained",disabled:$||!Q,onClick:X,startIcon:$?e.jsx(R,{color:"inherit",size:16}):void 0,children:s($?"user.saving":"user.save")})]})]})}function ne({onCreate:i}){const{t}=k("users");return e.jsxs(L,{sx:{p:2,minWidth:240,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs(V,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:t("employee.create_new")}),e.jsx(m,{variant:"body2",color:"text.secondary",children:t("employee.create_intro")})]}),e.jsx(_,{sx:{p:2,pt:0},children:e.jsx(C,{fullWidth:!0,variant:"contained",onClick:i,children:t("employee.create_button")})})]})}function ye({lang:i,users:t,onViewDetails:l,onSave:a,onRefresh:g,isEmployee:u,onCreate:s}){const{t:x}=k("users");return t.length===0?e.jsx(m,{variant:"h4",sx:{textAlign:"center"},children:x(u?"errors.not_found_employee":"errors.not_found")}):e.jsxs(_,{sx:{display:"flex",gap:4,justifyContent:{xs:"center",md:"flex-start"},flexWrap:{xs:"wrap",md:"nowrap"},flexDirection:{xs:"row",md:"column"}},children:[u&&e.jsx(ne,{onCreate:s}),t.map(c=>e.jsx(le,{lang:i,user:c,onViewDetails:()=>l(c.id),onSave:a,onRefresh:g,isEmployee:u},c.id))]})}function be(){const i=K(t=>t.authToken);return async function(l,a){try{return await T.patch(`${W}/api/users/${l}`,a,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),!0}catch{return!1}}}function we({lang:i,open:t,userId:l,token:a,onClose:g,isEmployee:u}){const{t:s}=k("users"),[x,c]=n.useState(!1),[d,p]=n.useState(null),[y,v]=n.useState(null),[r,h]=n.useState(null);return n.useEffect(()=>{if(!t||l===null)return;c(!0),p(null);const b={Authorization:`Bearer ${a}`};Promise.all([T.get(`${W}/api/users/${l}`,{headers:b}),T.get(`${W}/api/users/email/${l}`,{headers:b})]).then(([w,D])=>{v(w.data.user),h(D.data.data)}).catch(w=>{p(s(u?"errors.not_found_employee":"errors.not_found"))}).finally(()=>c(!1))},[t,l,a,s]),e.jsxs(O,{open:t,onClose:g,maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{sx:{p:2},children:e.jsx(m,{variant:"h6",component:"div",children:u?s("user.details_title_employee",{id:l}):s("user.details_title",{id:l})})}),x&&e.jsx(_,{textAlign:"center",py:4,children:e.jsx(ae,{})}),d&&e.jsx(re,{title:s("errors.title"),message:s(u?"errors.error_employee":"errors.error_user")}),!x&&!d&&y&&e.jsx(I,{dividers:!0,children:e.jsxs(_,{sx:{display:"flex",flexDirection:"column",gap:.5,px:2},children:[e.jsxs(m,{variant:"subtitle1",children:[e.jsx("strong",{children:s("user.name")})," ",y.firstname," ",y.lastname]}),e.jsxs(m,{variant:"subtitle1",children:[e.jsx("strong",{children:s("user.details_email")})," ",y.email]}),r?e.jsxs(_,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[e.jsx(m,{variant:"subtitle2",children:s("user.pending_email_change")}),e.jsxs(m,{variant:"body2",children:[s("user.old_email"),": ",r.old_email]}),e.jsxs(m,{variant:"body2",children:[s("user.new_email"),": ",r.new_email]}),e.jsx(m,{variant:"body2",children:s("user.requested_on",{date:A(r.created_at,i),time:z(r.created_at,i)})}),e.jsx(m,{variant:"body2",color:"text.secondary",children:s("user.updated_on",{date:A(r.updated_at,i),time:z(r.updated_at,i)})})]}):e.jsx(m,{variant:"body2",sx:{mt:2,p:2},children:s("user.no_pending_email")})]})}),e.jsx(G,{children:e.jsx(C,{onClick:g,size:"small",children:s("user.close")})})]})}function oe(){const i=K(t=>t.authToken);return async function(l){try{return await T.post(`${W}/api/users/employees`,l,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}}),!0}catch{return!1}}}function Ce({open:i,onClose:t,onRefresh:l}){const{t:a}=k("users"),{notify:g}=H(),u=oe(),[s,x]=n.useState(!1),[c,d]=n.useState(!1),[p,y]=n.useState(!1),v=n.useMemo(()=>({firstname:"",lastname:"",email:"",password:"",password_confirmation:""}),[]),[r,h]=n.useState(v);n.useEffect(()=>{i&&(h(v),d(!1),y(!1))},[i,v]);const b=n.useMemo(()=>/^\S+@\S+\.\S+$/.test(r.email),[r.email]),w=n.useMemo(()=>r.firstname.trim()!==""&&r.lastname.trim()!==""&&r.email.trim()!==""&&b&&r.password!==""&&r.password===r.password_confirmation,[r,b]),D=async()=>{x(!0);const f={firstname:r.firstname,lastname:r.lastname,email:r.email,password:r.password,password_confirmation:r.password_confirmation},o=await u(f);x(!1),o?(g(a("employee.success"),"success"),l(),t()):g(a("errors.creation_failed"),"error")};return e.jsxs(O,{open:i,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(q,{children:a("employee.create_new")}),e.jsx(I,{dividers:!0,children:e.jsxs(_,{component:"form",sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(S,{label:a("user.lastname"),value:r.lastname,onChange:f=>h(o=>({...o,lastname:f.target.value})),fullWidth:!0}),e.jsx(S,{label:a("user.firstname"),value:r.firstname,onChange:f=>h(o=>({...o,firstname:f.target.value})),fullWidth:!0}),e.jsx(S,{label:a("user.email"),type:"email",value:r.email,onChange:f=>h(o=>({...o,email:f.target.value})),onBlur:()=>y(!0),error:p&&!b,helperText:p&&!b?a("employee.invalid_email"):"",fullWidth:!0}),e.jsx(ie,{password:r.password,onPasswordChange:f=>h(o=>({...o,password:f})),confirmPassword:r.password_confirmation,onConfirmChange:f=>h(o=>({...o,password_confirmation:f})),touched:c,onBlur:()=>d(!0)})]})}),e.jsxs(G,{children:[e.jsx(C,{onClick:t,disabled:s,children:a("user.close")}),e.jsx(C,{variant:"contained",onClick:D,disabled:!w||s,startIcon:s?e.jsx(R,{size:16}):void 0,children:a(s?"employee.creation":"employee.create")})]})]})}export{ye as A,ve as U,we as a,Ce as b,be as u};
